# é˜¿é‡Œäº‘èµ„æºåˆ†æå·¥å…·

## ğŸš€ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„é˜¿é‡Œäº‘èµ„æºåˆ©ç”¨ç‡åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è¯†åˆ«å’Œä¼˜åŒ–å„ç§äº‘èµ„æºçš„é—²ç½®æƒ…å†µï¼Œé™ä½äº‘æˆæœ¬ã€‚

## ğŸ“‹ æ”¯æŒçš„èµ„æºç±»å‹

| èµ„æºç±»å‹ | çŠ¶æ€ | æè¿° |
|---------|------|------|
| **ECS** | âœ… å·²å®Œæˆ | å¼¹æ€§è®¡ç®—æœåŠ¡ - äº‘æœåŠ¡å™¨å®ä¾‹åˆ†æ |
| **RDS** | âœ… å·²å®Œæˆ | äº‘æ•°æ®åº“RDS - å…³ç³»å‹æ•°æ®åº“åˆ†æ |
| **Redis** | âœ… å·²å®Œæˆ | äº‘æ•°æ®åº“Redis - ç¼“å­˜æ•°æ®åº“åˆ†æ |
| **MongoDB** | âœ… å·²å®Œæˆ | äº‘æ•°æ®åº“MongoDB - æ–‡æ¡£æ•°æ®åº“åˆ†æ |
| **ClickHouse** | âœ… å·²å®Œæˆ | äº‘æ•°æ®åº“ClickHouse - åˆ†æå‹æ•°æ®åº“åˆ†æ |
| **OSS** | âœ… å·²å®Œæˆ | å¯¹è±¡å­˜å‚¨æœåŠ¡ - æ–‡ä»¶å­˜å‚¨åˆ†æ |
| **SLB** | âœ… å·²å®Œæˆ | è´Ÿè½½å‡è¡¡ - æµé‡åˆ†å‘åˆ†æ |
| **EIP** | âœ… å·²å®Œæˆ | å¼¹æ€§å…¬ç½‘IP - å…¬ç½‘è®¿é—®åˆ†æ |
| **NAS** | ğŸ“‹ è®¡åˆ’ä¸­ | æ–‡ä»¶å­˜å‚¨NAS - å…±äº«æ–‡ä»¶ç³»ç»Ÿåˆ†æ |
| **ACK** | ğŸ“‹ è®¡åˆ’ä¸­ | å®¹å™¨æœåŠ¡Kubernetesç‰ˆ - å®¹å™¨ç¼–æ’åˆ†æ |
| **ECI** | ğŸ“‹ è®¡åˆ’ä¸­ | å¼¹æ€§å®¹å™¨å®ä¾‹ - æ— æœåŠ¡å™¨å®¹å™¨åˆ†æ |
| **EMR** | ğŸ“‹ è®¡åˆ’ä¸­ | å¤§æ•°æ®æœåŠ¡ - å¤§æ•°æ®è®¡ç®—åˆ†æ |
| **ARMS** | ğŸ“‹ è®¡åˆ’ä¸­ | åº”ç”¨ç›‘æ§ - åº”ç”¨æ€§èƒ½ç›‘æ§åˆ†æ |
| **SLS** | ğŸ“‹ è®¡åˆ’ä¸­ | æ—¥å¿—æœåŠ¡ - æ—¥å¿—æ”¶é›†åˆ†æ |

## ğŸ› ï¸ å®‰è£…å’Œä½¿ç”¨

### 1. ç¯å¢ƒè¦æ±‚

```bash
# Python 3.7+
pip install -r requirements.txt
```

### 2. é…ç½®æ–‡ä»¶

åˆ›å»º `config.json` æ–‡ä»¶ï¼Œæ”¯æŒå¤šç§Ÿæˆ·é…ç½®ï¼š

```json
{
  "default_tenant": "your_tenant",
  "tenants": {
    "your_tenant": {
      "access_key_id": "your_access_key_id",
      "access_key_secret": "your_access_key_secret",
      "display_name": "ç§Ÿæˆ·æ˜¾ç¤ºåç§°"
    }
  }
}
```

**ä½¿ç”¨Keyringå®‰å…¨å­˜å‚¨å‡­è¯ï¼ˆæ¨èï¼‰**:

```bash
# äº¤äº’å¼è®¾ç½®å‡­è¯ï¼ˆä¿å­˜åˆ°ç³»ç»Ÿå¯†é’¥ç¯ï¼‰
python main.py setup-credentials

# åˆ—å‡ºå·²é…ç½®çš„ç§Ÿæˆ·
python main.py list-credentials
```

é…ç½®æ–‡ä»¶ä¸­åªéœ€æ ‡è®°ä½¿ç”¨Keyringï¼š

```json
{
  "default_tenant": "your_tenant",
  "tenants": {
    "your_tenant": {
      "use_keyring": true,
      "keyring_key": "aliyun_your_tenant",
      "display_name": "ç§Ÿæˆ·æ˜¾ç¤ºåç§°"
    }
  }
}
```

### 3. ä½¿ç”¨æ–¹æ³•

**å‘½ä»¤æ ¼å¼**: `python main.py [ç§Ÿæˆ·] [æ“ä½œ] [èµ„æºç±»å‹]`

#### èµ„æºåˆ©ç”¨ç‡åˆ†æï¼ˆCRUï¼‰

```bash
# åˆ†ææŒ‡å®šç§Ÿæˆ·çš„æ‰€æœ‰èµ„æº
python main.py your_tenant cru all

# åˆ†æé»˜è®¤ç§Ÿæˆ·çš„ECSå®ä¾‹
python main.py cru ecs

# åˆ†ææŒ‡å®šç§Ÿæˆ·çš„RDSæ•°æ®åº“
python main.py your_tenant cru rds

# åˆ†æRedisç¼“å­˜
python main.py cru redis

# åˆ†æMongoDBæ•°æ®åº“
python main.py cru mongodb

# åˆ†æClickHouseæ•°æ®åº“
python main.py cru clickhouse

# åˆ†æOSSå¯¹è±¡å­˜å‚¨
python main.py cru oss

# åˆ†æSLBè´Ÿè½½å‡è¡¡
python main.py cru slb

# åˆ†æEIPå¼¹æ€§å…¬ç½‘IP
python main.py cru eip

# åˆ†ææ‰€æœ‰èµ„æº
python main.py cru all
```

#### æŠ˜æ‰£åˆ†æï¼ˆDiscountï¼‰

```bash
# åˆ†ææŒ‡å®šç§Ÿæˆ·çš„ECSæŠ˜æ‰£
python main.py your_tenant discount ecs

# åˆ†ææŒ‡å®šç§Ÿæˆ·çš„RDSæŠ˜æ‰£
python main.py your_tenant discount rds

# åˆ†æé»˜è®¤ç§Ÿæˆ·çš„ECSæŠ˜æ‰£
python main.py discount ecs
```

#### å…¶ä»–å‘½ä»¤

```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
python main.py --help

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
python main.py --version
```

## ğŸ“Š åˆ†ææ ‡å‡†

### ECSå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- CPUåˆ©ç”¨ç‡ < 5%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- Load Average < vCPU * 5%
- ç£ç›˜IOPS < 100
- EIPå¸¦å®½ä½¿ç”¨ç‡ < å³°å€¼ * 10%

### RDSå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- CPUåˆ©ç”¨ç‡ < 10%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- è¿æ¥æ•°ä½¿ç”¨ç‡ < 20%
- QPS < 100
- TPS < 10
- è¿æ¥çº¿ç¨‹æ•° < 10
- è¿è¡Œçº¿ç¨‹æ•° < 5

### Rediså®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- CPUåˆ©ç”¨ç‡ < 10%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- è¿æ¥æ•°ä½¿ç”¨ç‡ < 20%
- å†…ç½‘å…¥æµé‡ < 100KB/s
- å†…ç½‘å‡ºæµé‡ < 100KB/s
- å·²ä½¿ç”¨å†…å­˜ < 10MB

### MongoDBå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- CPUåˆ©ç”¨ç‡ < 10%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- ç£ç›˜åˆ©ç”¨ç‡ < 20%
- è¿æ¥æ•°ä½¿ç”¨ç‡ < 20%
- QPS < 100
- IOPS < 100
- ç½‘ç»œå…¥æµé‡ < 1KB/s
- ç½‘ç»œå‡ºæµé‡ < 1KB/s

### ClickHouseå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- CPUåˆ©ç”¨ç‡ < 10%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- ç£ç›˜åˆ©ç”¨ç‡ < 20%
- è¿æ¥æ•° < 10
- æŸ¥è¯¢æ•° < 100
- æ’å…¥æ•° < 50
- ç½‘ç»œå…¥æµé‡ < 1KB/s
- ç½‘ç»œå‡ºæµé‡ < 1KB/s
- ç£ç›˜è¯»IOPS < 100
- ç£ç›˜å†™IOPS < 100

### OSSå­˜å‚¨æ¡¶é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- å­˜å‚¨å®¹é‡ < 1GB
- å¯¹è±¡æ•°é‡ < 100ä¸ª
- æ€»è¯·æ±‚æ•° < 100æ¬¡
- GETè¯·æ±‚æ•° < 50æ¬¡
- PUTè¯·æ±‚æ•° < 10æ¬¡

### SLBå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- åç«¯æœåŠ¡å™¨æ•° <= 0
- æ—¥å‡æµé‡ < 10MB
- æ´»è·ƒè¿æ¥æ•° < 10
- æ—¥å‡æ–°å»ºè¿æ¥ < 100

### EIPå®ä¾‹é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- æœªç»‘å®šä»»ä½•å®ä¾‹
- ç»‘å®šå®ä¾‹å·²åœæ­¢/åˆ é™¤
- 14å¤©æ€»æµé‡ < 1MB
- å¸¦å®½ä½¿ç”¨ç‡ < 5%
- å‡ ä¹æ— æµé‡ï¼ˆå‡ºå¸¦å®½ < 1Mbps ä¸”æ€»æµé‡ < 0.1MBï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
aliyunidle/
â”œâ”€â”€ main.py                          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ check_ecs_idle_fixed.py         # ECSåˆ†ææ¨¡å—
â”œâ”€â”€ core/                            # æ ¸å¿ƒæ¡†æ¶å±‚
â”‚   â”œâ”€â”€ base_analyzer.py            # èµ„æºåˆ†æå™¨æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ cache_manager.py           # ç»Ÿä¸€ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ db_manager.py              # ç»Ÿä¸€æ•°æ®åº“ç®¡ç†
â”‚   â”œâ”€â”€ config_manager.py          # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ threshold_manager.py        # é˜ˆå€¼ç®¡ç†
â”œâ”€â”€ resource_modules/                # èµ„æºåˆ†ææ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ rds_analyzer.py             # RDSåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ redis_analyzer.py           # Redisåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ mongodb_analyzer.py         # MongoDBåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ oss_analyzer.py             # OSSåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ slb_analyzer.py             # SLBåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ eip_analyzer.py             # EIPåˆ†ææ¨¡å—
â”‚   â””â”€â”€ discount_analyzer.py        # æŠ˜æ‰£åˆ†ææ¨¡å—
â”œâ”€â”€ utils/                           # å·¥å…·å±‚
â”‚   â”œâ”€â”€ concurrent_helper.py       # å¹¶å‘å¤„ç†è¾…åŠ©
â”‚   â”œâ”€â”€ retry_helper.py             # APIé‡è¯•æœºåˆ¶
â”‚   â”œâ”€â”€ logger.py                   # æ—¥å¿—ç³»ç»Ÿ
â”‚   â””â”€â”€ credential_manager.py      # å‡­è¯ç®¡ç†ï¼ˆKeyringï¼‰
â”œâ”€â”€ config.json                     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt                # ä¾èµ–åŒ…
â””â”€â”€ reports/                        # æŠ¥å‘Šè¾“å‡ºç›®å½•
    â”œâ”€â”€ ecs_idle_report_*.html
    â”œâ”€â”€ ecs_idle_report_*.xlsx
    â”œâ”€â”€ rds_idle_report_*.html
    â”œâ”€â”€ rds_idle_report_*.xlsx
    â”œâ”€â”€ redis_idle_report_*.html
    â”œâ”€â”€ redis_idle_report_*.xlsx
    â”œâ”€â”€ mongodb_idle_report_*.html
    â”œâ”€â”€ mongodb_idle_report_*.xlsx
    â”œâ”€â”€ clickhouse_idle_report_*.html
    â””â”€â”€ clickhouse_idle_report_*.xlsx
```

## ğŸ”§ å¼€å‘æ–°æ¨¡å—

### 1. åˆ›å»ºåˆ†æå™¨ç±»

```python
class ResourceAnalyzer:
    def __init__(self, access_key_id, access_key_secret):
        # åˆå§‹åŒ–
    
    def analyze_resources(self):
        # åˆ†æèµ„æº
    
    def generate_report(self, idle_instances):
        # ç”ŸæˆæŠ¥å‘Š
```

### 2. å®ç°æ ‡å‡†æ¥å£

- `get_all_regions()` - è·å–æ‰€æœ‰åŒºåŸŸ
- `get_resource_instances(region)` - è·å–èµ„æºå®ä¾‹
- `get_monitoring_data(region, instance_id)` - è·å–ç›‘æ§æ•°æ®
- `is_resource_idle(metrics)` - åˆ¤æ–­æ˜¯å¦é—²ç½®
- `get_optimization_suggestion(metrics)` - è·å–ä¼˜åŒ–å»ºè®®

### 3. æ³¨å†Œåˆ°ä¸»ç¨‹åº

åœ¨ `main.py` ä¸­æ·»åŠ æ–°çš„èµ„æºç±»å‹ï¼š

```python
def run_new_resource_analysis(args):
    # å®ç°åˆ†æé€»è¾‘
    pass
```

### OSSå­˜å‚¨æ¡¶é—²ç½®æ ‡å‡†ï¼ˆæˆ–å…³ç³»ï¼‰
- å­˜å‚¨å®¹é‡ < 1GB
- å¯¹è±¡æ•°é‡ < 100ä¸ª
- æ€»è¯·æ±‚æ•° < 100æ¬¡
- GETè¯·æ±‚æ•° < 50æ¬¡
- PUTè¯·æ±‚æ•° < 10æ¬¡

## ğŸ’° æŠ˜æ‰£åˆ†æ

### æ”¯æŒçš„èµ„æºç±»å‹
- âœ… **ECS**: åˆ†æåŒ…å¹´åŒ…æœˆå®ä¾‹çš„ç»­è´¹æŠ˜æ‰£
- âœ… **RDS**: åˆ†æåŒ…å¹´åŒ…æœˆå®ä¾‹çš„ç»­è´¹æŠ˜æ‰£
- âœ… **Redis**: åˆ†æåŒ…å¹´åŒ…æœˆå®ä¾‹çš„ç»­è´¹æŠ˜æ‰£
- âš ï¸ **MongoDB**: éƒ¨åˆ†å®Œæˆï¼ˆAPIè°ƒç”¨é—®é¢˜ï¼Œå¾…ä¿®å¤ï¼‰

### åˆ†æå†…å®¹
- åŸºå‡†ä»·æ ¼ vs å®é™…ç»­è´¹ä»·æ ¼
- æŠ˜æ‰£ç‡ç»Ÿè®¡ï¼ˆå¹³å‡/æœ€ä½/æœ€é«˜ï¼‰
- æˆæœ¬èŠ‚çœé‡‘é¢è®¡ç®—ï¼ˆæœˆåº¦/å¹´åº¦ï¼‰
- é«˜æŠ˜æ‰£å®ä¾‹è¯†åˆ«

### æŠ¥å‘Šæ ¼å¼
- **HTMLæŠ¥å‘Š**: å¯è§†åŒ–æŠ˜æ‰£æ˜ç»†è¡¨æ ¼
- **PDFæŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆçš„PDFæ–‡æ¡£ï¼ˆå¦‚æœç³»ç»Ÿæ”¯æŒï¼‰

## ğŸ“ˆ æŠ¥å‘Šæ ¼å¼

### èµ„æºåˆ©ç”¨ç‡åˆ†ææŠ¥å‘Š
æ¯ä¸ªèµ„æºåˆ†æéƒ½ä¼šç”Ÿæˆï¼š

1. **ExcelæŠ¥å‘Š** - è¯¦ç»†çš„æ•°æ®è¡¨æ ¼
2. **HTMLæŠ¥å‘Š** - å¯è§†åŒ–çš„ç½‘é¡µæŠ¥å‘Š
3. **ç»Ÿè®¡ä¿¡æ¯** - æˆæœ¬èŠ‚çœä¼°ç®—

### æŠ˜æ‰£åˆ†ææŠ¥å‘Š
- **HTMLæŠ¥å‘Š** - æŠ˜æ‰£æ˜ç»†è¡¨æ ¼ï¼ˆæŒ‰æŠ˜æ‰£ç‡æ’åºï¼‰
- **PDFæŠ¥å‘Š** - æ‰“å°å‹å¥½çš„PDFæ–‡æ¡£
- **ç»Ÿè®¡æ‘˜è¦** - æŠ˜æ‰£ç‡ç»Ÿè®¡å’Œæˆæœ¬èŠ‚çœ

## ğŸ¯ ä¼˜åŒ–å»ºè®®

å·¥å…·ä¼šæ ¹æ®èµ„æºä½¿ç”¨æƒ…å†µæä¾›ä¼˜åŒ–å»ºè®®ï¼š

- **é™é…å»ºè®®** - é™ä½å®ä¾‹è§„æ ¼
- **åˆå¹¶å»ºè®®** - åˆå¹¶å°å®ä¾‹
- **åˆ é™¤å»ºè®®** - åˆ é™¤å®Œå…¨é—²ç½®çš„èµ„æº
- **é…ç½®è°ƒæ•´** - è°ƒæ•´èµ„æºé…ç½®å‚æ•°

## ğŸ” å‡­è¯ç®¡ç†

### ä½¿ç”¨Keyringå­˜å‚¨å‡­è¯ï¼ˆæ¨èï¼‰

å‡­è¯ä¸ä¼šæ˜æ–‡å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨ç³»ç»Ÿå¯†é’¥ç¯ä¸­ï¼š

```bash
# è®¾ç½®å‡­è¯
python main.py setup-credentials

# åˆ—å‡ºå·²é…ç½®çš„ç§Ÿæˆ·
python main.py list-credentials
```

### é…ç½®æ–‡ä»¶æ ¼å¼

ä½¿ç”¨Keyringæ—¶ï¼Œ`config.json`åªéœ€åŒ…å«ç§Ÿæˆ·å…ƒæ•°æ®ï¼š

```json
{
  "default_tenant": "your_tenant",
  "tenants": {
    "your_tenant": {
      "use_keyring": true,
      "keyring_key": "aliyun_your_tenant",
      "display_name": "ç§Ÿæˆ·æ˜¾ç¤ºåç§°"
    }
  }
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å¼€å‘æ—¥å¿—**: [DEVELOPMENT_LOG.md](DEVELOPMENT_LOG.md) - è¯¦ç»†çš„å¼€å‘è®°å½•å’Œé—®é¢˜è§£å†³
- **é‡æ„æŒ‡å—**: [REFACTORING_GUIDE.md](REFACTORING_GUIDE.md) - æ¶æ„ä¼˜åŒ–å’Œæ‰©å±•è§„åˆ’
- **é¡¹ç›®æ€»ç»“**: [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md) - å®Œæ•´çš„äº§å“å’ŒæŠ€æœ¯æ–‡æ¡£æ€»ç»“
- **äº§å“æŠ€æœ¯è§„åˆ’**: [PRODUCT_TECH_PLAN.md](PRODUCT_TECH_PLAN.md) - äº§å“åŠŸèƒ½ç°çŠ¶ã€æ”¹è¿›å»ºè®®å’Œå¼€å‘è®¡åˆ’
- **å¾…å¼€å‘åŠŸèƒ½**: [TODO_FEATURES.md](TODO_FEATURES.md) - è¯¦ç»†çš„åŠŸèƒ½æ¸…å•å’Œä¼˜å…ˆçº§

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤Issueåˆ°é¡¹ç›®ä»“åº“
- å‘é€é‚®ä»¶åˆ°æŠ€æœ¯æ”¯æŒé‚®ç®±

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚
