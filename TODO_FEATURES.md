# 待开发功能清单

> **最后更新**: 2025-10-29  
> **当前版本**: v2.0.0

---

## 📋 功能完成度总览

### ✅ 已完成功能（生产可用）

#### 资源利用率分析（CRU）
- ✅ **ECS** - 弹性计算服务（18个监控指标）
- ✅ **RDS** - 云数据库RDS（8个监控指标）
- ✅ **Redis** - 云数据库Redis（6个监控指标）
- ✅ **MongoDB** - 云数据库MongoDB（7个监控指标）
- ✅ **OSS** - 对象存储服务（13个监控指标）
- ✅ **SLB** - 负载均衡（6个监控指标）
- ✅ **EIP** - 弹性公网IP（4个监控指标）

**完成度**: 7/8 = **87.5%**（ClickHouse标记为计划中但未实现）

#### 折扣分析（Discount）
- ✅ **ECS** - 包年包月实例续费折扣查询
- ✅ **RDS** - 包年包月实例续费折扣查询
- ✅ **Redis** - 包年包月实例续费折扣查询（刚刚完成）

**完成度**: 3/4 = **75%**（MongoDB有API调用问题）

#### 基础设施
- ✅ 多租户支持
- ✅ Keyring凭证管理
- ✅ 可配置阈值（YAML）
- ✅ 缓存管理（24h TTL）
- ✅ 数据库管理（SQLite）
- ✅ 重试机制（网络错误）
- ✅ 日志系统
- ✅ HTML+Excel+PDF报告生成

---

## 🚧 待开发功能

### 1. 折扣分析功能扩展

#### 1.1 MongoDB折扣分析修复 ⚠️ **高优先级**
- **状态**: 部分完成，API调用有网络连接问题
- **问题**: `DescribeRenewalPrice` API连接失败（Connection aborted）
- **解决方案**:
  - 修复MongoDB API调用（可能需要使用HTTPS或不同域名）
  - 参考Redis的实现方式，使用`DescribePrice` API
  - 添加重试机制和错误处理

#### 1.2 其他资源类型折扣分析
- **OSS**: ❌ 不支持（按量付费模式）
- **SLB**: ❌ 不支持（按量付费模式）
- **EIP**: ❌ 不支持（按量付费模式）
- **说明**: 这些服务通常采用按量付费，不支持包年包月，无法进行折扣分析

---

### 2. 资源利用率分析扩展

#### 2.1 ClickHouse分析器 ❌ **高优先级**
- **状态**: README标记为"已完成"，但代码中未找到实现
- **需要**:
  - 创建 `resource_modules/clickhouse_analyzer.py`
  - 实现ClickHouse实例获取
  - 实现监控数据采集
  - 实现闲置判断逻辑
  - 生成HTML+Excel报告
  - 更新`main.py`添加ClickHouse分析入口
  - 更新`thresholds.yaml`添加ClickHouse阈值

#### 2.2 NAS（文件存储）分析器 ❌ **中优先级**
- **需要**:
  - 创建 `resource_modules/nas_analyzer.py`
  - 分析NAS文件系统的使用情况
  - 监控指标：存储容量、IOPS、吞吐量等
  - 判断闲置标准：存储容量小、IOPS低、无访问等

#### 2.3 ACK（容器服务Kubernetes版）分析器 ❌ **中优先级**
- **需要**:
  - 创建 `resource_modules/ack_analyzer.py`
  - 分析ACK集群的资源使用情况
  - 监控指标：CPU、内存、Pod数量、节点数等
  - 判断闲置标准：集群资源利用率低、Pod数量少等

#### 2.4 ECI（弹性容器实例）分析器 ❌ **低优先级**
- **需要**:
  - 创建 `resource_modules/eci_analyzer.py`
  - 分析ECI实例的使用情况
  - 监控指标：CPU、内存、运行时长等
  - 判断闲置标准：实例运行时间短、资源利用率低等

#### 2.5 EMR（大数据服务）分析器 ❌ **低优先级**
- **需要**:
  - 创建 `resource_modules/emr_analyzer.py`
  - 分析EMR集群的资源使用情况
  - 监控指标：CPU、内存、存储、任务数等
  - 判断闲置标准：集群资源利用率低、任务数量少等

#### 2.6 ARMS（应用监控）分析器 ❌ **低优先级**
- **需要**:
  - 创建 `resource_modules/arms_analyzer.py`
  - 分析ARMS监控的应用数量和使用情况
  - 监控指标：应用数量、监控数据量、告警数量等
  - 判断闲置标准：应用数量少、监控数据量小等

#### 2.7 SLS（日志服务）分析器 ❌ **低优先级**
- **需要**:
  - 创建 `resource_modules/sls_analyzer.py`
  - 分析SLS日志库的使用情况
  - 监控指标：日志存储量、写入量、查询量等
  - 判断闲置标准：存储量小、写入量低、无查询等

---

### 3. 代码质量优化

#### 3.1 ECS分析器重构 🔧 **中优先级**
- **当前状态**: ECS分析器独立实现（`check_ecs_idle_fixed.py`）
- **目标**: 使用`BaseResourceAnalyzer`基类重构
- **好处**: 
  - 统一架构
  - 减少代码重复
  - 提高可维护性
- **注意**: 需要保持向后兼容

#### 3.2 统一架构使用 🔧 **中优先级**
- **当前状态**: 部分分析器未完全基于`BaseResourceAnalyzer`
- **目标**: 统一所有分析器使用基类
- **好处**: 代码一致性，便于维护

---

### 4. 性能优化

#### 4.1 折扣分析性能优化 🔧 **中优先级**
- **当前问题**: 串行查询，速度较慢
- **优化方案**:
  - 批量查询（如果API支持）
  - 并发处理（多线程）
  - 缓存优化

#### 4.2 并发处理优化 🔧 **低优先级**
- **当前状态**: 部分功能使用并发，部分串行
- **优化方案**: 统一使用并发处理，提升整体性能

---

### 5. 功能增强

#### 5.1 折扣对比功能 🔧 **中优先级**
- **功能**: 对比不同时间段的折扣情况
- **实现**:
  - 存储历史折扣数据
  - 生成对比报告
  - 显示折扣变化趋势

#### 5.2 报告合并功能 🔧 **低优先级**
- **功能**: 合并多个租户的报告
- **实现**:
  - 多租户汇总报告
  - 跨租户对比分析

#### 5.3 邮件通知功能 🔧 **低优先级**
- **功能**: 自动发送分析报告到邮箱
- **实现**:
  - 邮件发送功能
  - 报告附件
  - 定时任务支持

#### 5.4 Web界面 🔧 **低优先级**（可选）
- **功能**: 提供Web界面查看报告
- **实现**:
  - Flask/FastAPI后端
  - Vue.js前端
  - 报告可视化

#### 5.5 API接口 🔧 **低优先级**（可选）
- **功能**: 提供RESTful API接口
- **实现**:
  - RESTful API
  - OpenAPI文档
  - API认证

---

### 6. 测试覆盖

#### 6.1 单元测试 ❌ **高优先级**
- **当前状态**: 缺少单元测试
- **目标**: 测试覆盖率 > 60%
- **需要测试**:
  - 核心功能模块
  - API调用逻辑
  - 数据解析逻辑
  - 报告生成逻辑

#### 6.2 集成测试 ❌ **中优先级**
- **功能**: 端到端测试
- **测试场景**:
  - 完整分析流程
  - 多租户场景
  - 错误处理场景

#### 6.3 性能测试 ❌ **低优先级**
- **功能**: 性能基准测试
- **测试指标**:
  - 分析速度
  - 内存使用
  - API调用次数

---

### 7. 文档完善

#### 7.1 README.md完善 📝 **中优先级**
- [ ] 折扣分析使用说明（已部分完成）
- [ ] 多租户配置详细教程（已部分完成）
- [ ] 常见问题FAQ
- [ ] 故障排查指南
- [ ] 性能优化建议

#### 7.2 新增文档 📝 **中优先级**
- [ ] **CHANGELOG.md** - 版本变更记录
- [ ] **API.md** - 内部API文档
- [ ] **FAQ.md** - 常见问题
- [ ] **DEPLOYMENT.md** - 部署文档
- [ ] **CONTRIBUTING.md** - 贡献指南

#### 7.3 文档更新 📝 **低优先级**
- [ ] 更新PROJECT_SUMMARY.md（标记Redis折扣分析已完成）
- [ ] 更新DEVELOPMENT_LOG.md（记录Redis折扣分析完成）

---

## 📊 开发优先级建议

### P0 - 高优先级（立即处理）
1. ✅ **Redis折扣分析** - 已完成
2. ⚠️ **MongoDB折扣分析修复** - API调用问题需要修复
3. ❌ **ClickHouse分析器** - README标记为已完成但代码缺失，需要实现或更正状态

### P1 - 中优先级（近期处理）
1. ❌ **NAS分析器** - 文件存储资源分析
2. ❌ **ACK分析器** - Kubernetes集群分析
3. 🔧 **ECS分析器重构** - 统一架构
4. 📝 **文档完善** - FAQ、CHANGELOG等

### P2 - 低优先级（按需处理）
1. ❌ **其他资源分析器** - ECI、EMR、ARMS、SLS
2. 🔧 **性能优化** - 并发处理、批量查询
3. 🔧 **功能增强** - 对比分析、报告合并、邮件通知
4. ❌ **测试覆盖** - 单元测试、集成测试

---

## 📈 功能完成度统计

### 资源利用率分析（CRU）
- **已完成**: 7个（ECS、RDS、Redis、MongoDB、OSS、SLB、EIP）
- **待实现**: 1个（ClickHouse-状态不明确）
- **计划中**: 6个（NAS、ACK、ECI、EMR、ARMS、SLS）
- **完成度**: **87.5%**（8个计划中的资源）

### 折扣分析（Discount）
- **已完成**: 3个（ECS、RDS、Redis）
- **部分完成**: 1个（MongoDB-需要修复）
- **不支持**: 3个（OSS、SLB、EIP-按量付费）
- **完成度**: **75%**（4个支持包年包月的资源）

### 基础设施
- **完成度**: **100%** ✅
  - 多租户 ✅
  - 凭证管理 ✅
  - 阈值配置 ✅
  - 缓存管理 ✅
  - 数据库管理 ✅
  - 重试机制 ✅
  - 日志系统 ✅

---

## 🎯 建议的开发顺序

### 阶段1：补齐核心功能（1-2周）
1. 修复MongoDB折扣分析API调用问题
2. 实现ClickHouse分析器（或修正README状态）
3. 实现NAS分析器

### 阶段2：代码质量提升（1周）
1. ECS分析器重构
2. 统一架构使用
3. 添加单元测试（核心功能）

### 阶段3：功能扩展（2-3周）
1. 实现ACK分析器
2. 折扣对比功能
3. 性能优化

### 阶段4：文档和测试（1周）
1. 完善文档
2. 增加测试覆盖
3. 性能测试

---

## 📝 备注

- **Redis折扣分析**: 刚刚完成，使用`DescribePrice` API，支持RENEW和BUY两种订单类型
- **MongoDB折扣分析**: API调用存在网络连接问题，需要进一步调试
- **ClickHouse**: README中标记为"已完成"，但代码中未找到实现文件，需要确认
- **OSS/SLB/EIP**: 这些服务不支持包年包月模式，无法进行折扣分析，这是正常的

---

**最后更新**: 2025-10-29  
**维护者**: 项目开发团队

