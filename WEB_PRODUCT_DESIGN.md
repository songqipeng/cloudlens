# CloudLens Web - 产品设计方案

> **版本**: v1.0  
> **设计时间**: 2025-12  
> **目标**: 打造企业级多云资源治理Web平台

---

## 📋 目录

1. [产品定位](#产品定位)
2. [现有功能分析](#现有功能分析)
3. [产品功能设计](#产品功能设计)
4. [UI/UX设计](#uiux设计)
5. [技术架构](#技术架构)
6. [API设计](#api设计)
7. [实施路线图](#实施路线图)
8. [优先级排序](#优先级排序)

---

## 🎯 产品定位

### 核心价值

**CloudLens Web** 是一个现代化的多云资源治理平台，提供：
- 📊 **统一视图** - 一个界面管理所有云资源
- 💰 **成本优化** - 智能识别闲置资源，预测成本趋势
- 🔒 **安全合规** - 自动化安全巡检，CIS合规检查
- 🤖 **自动化** - 批量修复，减少人工干预

### 目标用户

1. **运维工程师** - 日常资源管理、成本优化
2. **财务/成本团队** - 成本分析、预算管理
3. **安全团队** - 安全合规检查、审计
4. **技术负责人** - 资源概览、决策支持

### 与CLI的关系

- **CLI**: 适合自动化、CI/CD集成、批量操作
- **Web**: 适合可视化、日常管理、团队协作

两者互补，共享核心业务逻辑。

---

## 📊 现有功能分析

### ✅ 已实现功能

#### 后端API（FastAPI）
- ✅ `/api/accounts` - 账号列表
- ✅ `/api/config/rules` - 规则配置（GET/POST）
- ✅ `/api/analyze/trigger` - 触发闲置资源分析
- ✅ `/api/dashboard/summary` - 仪表盘摘要
- ✅ `/api/dashboard/trend` - 成本趋势数据
- ✅ `/api/dashboard/idle` - 闲置资源列表

#### 前端界面（Next.js）
- ✅ Dashboard主页面
  - 成本摘要卡片（总成本、趋势、闲置数量）
  - 成本趋势图表（Recharts，30天）
  - 闲置资源表格（可滚动）
- ✅ Settings设置页面
  - 规则配置（CPU阈值、排除标签）
- ✅ "Scan Now"按钮
  - 触发分析并刷新数据

#### 技术栈
- 后端：FastAPI + uvicorn
- 前端：Next.js 16 + React 19 + TypeScript
- UI：Tailwind CSS + Lucide Icons
- 图表：Recharts

### ⚠️ 待改进点

1. **功能不完整**
   - 缺少资源详情页面
   - 缺少多账号切换
   - 缺少其他资源类型展示（只有ECS闲置分析）
   - 缺少安全合规页面
   - 缺少报告生成功能

2. **交互体验**
   - 缺少实时刷新（需要手动点击Scan Now）
   - 缺少加载状态提示
   - 缺少错误处理UI
   - 缺少数据筛选和搜索

3. **可视化**
   - 图表类型单一（只有成本趋势）
   - 缺少资源分布图
   - 缺少区域分布图
   - 缺少资源拓扑图

4. **文档**
   - 缺少启动文档
   - 缺少使用教程
   - 缺少API文档

---

## 🎨 产品功能设计

### 1. Dashboard（仪表盘）⭐⭐⭐⭐⭐

#### 1.1 概览卡片（已实现，需增强）

**当前**：
- 总预估成本
- 成本趋势（上升/下降）
- 闲置资源数量

**增强**：
- 📊 **资源总数** - 按类型统计（ECS、RDS、Redis等）
- 💰 **月度成本** - 当前月、上月、同比
- ⚠️ **告警数量** - 安全告警、即将到期资源
- 🏷️ **标签覆盖率** - 资源标签完整度
- 📈 **成本节省潜力** - 基于闲置资源估算

#### 1.2 成本趋势图表（已实现，需增强）

**当前**：
- 30天成本趋势（Area Chart）

**增强**：
- 📅 **时间范围选择** - 7天/30天/90天/自定义
- 📊 **多维度对比** - 按资源类型、区域、项目分组
- 📈 **预测线** - AI预测未来成本（虚线）
- 🔍 **交互式** - 点击查看详情、缩放
- 📉 **同比/环比** - 对比去年同期或上月

#### 1.3 资源分布（新增）

**新增组件**：
- 🥧 **资源类型分布饼图** - ECS、RDS、Redis等占比
- 🗺️ **区域分布图** - 各区域资源数量
- 📊 **资源状态统计** - Running、Stopped、Expired等
- 💰 **成本构成饼图** - 各资源类型成本占比

#### 1.4 闲置资源表格（已实现，需增强）

**当前**：
- 表格展示闲置ECS实例
- 显示ID、名称、规格、区域、原因

**增强**：
- 🔍 **搜索和筛选** - 按名称、区域、规格筛选
- 📊 **排序** - 按成本、闲置时长排序
- 🔗 **详情链接** - 点击查看资源详情
- ⚡ **批量操作** - 批量打标签、导出
- 📈 **成本估算** - 显示每个闲置资源的月度成本

#### 1.5 快速操作（新增）

**新增组件**：
- 🔄 **刷新数据** - 手动触发分析
- 📊 **生成报告** - 快速生成Excel/PDF报告
- 🔔 **告警设置** - 配置告警规则
- ⚙️ **设置** - 快速进入设置页面

### 2. Resources（资源管理）⭐⭐⭐⭐⭐

#### 2.1 资源列表页面（新增）

**功能**：
- 📋 **多资源类型** - ECS、RDS、Redis、OSS、VPC等
- 🔍 **高级搜索** - 按名称、标签、状态、区域搜索
- 📊 **筛选器** - 状态、区域、类型、标签筛选
- 📈 **排序** - 按创建时间、成本、状态排序
- 📄 **分页** - 支持大量资源展示
- 📥 **导出** - 导出为CSV/JSON/Excel

**列表字段**：
- 资源ID/名称
- 资源类型
- 状态（Running/Stopped等）
- 区域
- 规格/配置
- 成本（月度估算）
- 标签
- 创建时间
- 操作（查看详情、编辑标签等）

#### 2.2 资源详情页面（新增）

**功能**：
- 📊 **基本信息** - ID、名称、类型、状态、区域、规格
- 💰 **成本信息** - 当前成本、历史成本、预测成本
- 📈 **监控数据** - CPU、内存、网络、磁盘使用率（图表）
- 🏷️ **标签管理** - 查看、编辑、添加标签
- 🔒 **安全信息** - 公网IP、安全组、加密状态
- 📝 **操作历史** - 创建、修改、标签变更历史
- ⚡ **快速操作** - 打标签、生成报告、查看拓扑

**监控图表**：
- CPU使用率（7天/30天）
- 内存使用率
- 网络流量
- 磁盘IOPS

#### 2.3 资源拓扑图（新增）

**功能**：
- 🗺️ **可视化拓扑** - 使用D3.js或Cytoscape.js
- 🔗 **关系展示** - VPC、子网、实例、负载均衡关系
- 🔍 **交互式** - 点击查看详情、拖拽、缩放
- 📊 **筛选** - 按区域、类型筛选
- 💾 **导出** - 导出为PNG/SVG

### 3. Cost Analysis（成本分析）⭐⭐⭐⭐⭐

#### 3.1 成本概览（新增）

**功能**：
- 💰 **总成本** - 当前月、上月、同比
- 📊 **成本趋势** - 日/周/月趋势图
- 🥧 **成本构成** - 按资源类型、区域、项目
- 📈 **预测** - AI预测未来90天成本
- ⚠️ **异常检测** - 成本突增预警

#### 3.2 成本详情（新增）

**功能**：
- 📋 **资源成本列表** - 每个资源的详细成本
- 🔍 **筛选** - 按类型、区域、项目筛选
- 📊 **排序** - 按成本降序
- 📈 **趋势** - 单个资源的成本趋势
- 💾 **导出** - 导出成本报告

#### 3.3 预算管理（新增）

**功能**：
- 💰 **预算设置** - 月度/年度预算
- 📊 **预算使用率** - 当前使用率、剩余预算
- ⚠️ **预算告警** - 80%、90%、100%告警
- 📈 **预测** - 基于当前趋势预测是否超预算
- 📝 **预算历史** - 历史预算和实际支出对比

#### 3.4 成本优化建议（新增）

**功能**：
- 💡 **优化建议** - 基于闲置资源、折扣等
- 💰 **节省潜力** - 预估可节省金额
- 📊 **优先级排序** - 按节省金额排序
- ✅ **执行状态** - 已执行、待执行、已忽略
- 📝 **执行历史** - 优化操作历史

### 4. Security（安全合规）⭐⭐⭐⭐

#### 4.1 安全概览（新增）

**功能**：
- 🔒 **安全评分** - 综合安全评分（0-100）
- ⚠️ **告警统计** - 高危、中危、低危告警数量
- 📊 **合规状态** - CIS Benchmark合规度
- 🔍 **公网暴露** - 公网暴露资源数量
- 🏷️ **标签合规** - 标签覆盖率

#### 4.2 安全检查（新增）

**功能**：
- 🔍 **公网暴露检测** - 列出所有公网暴露资源
- 🔒 **安全组分析** - 不安全的安全组规则
- 🏷️ **标签检查** - 缺失标签的资源
- 🔐 **加密检查** - 未加密的磁盘
- ⚡ **抢占式实例** - 生产环境不推荐

#### 4.3 CIS合规检查（新增）

**功能**：
- 📋 **检查项列表** - 10+ CIS检查项
- ✅ **合规状态** - 通过/失败/警告
- 📊 **合规度** - 总体合规百分比
- 📝 **详细报告** - 每个检查项的详细结果
- 💡 **修复建议** - 如何修复不合规项

#### 4.4 权限审计（新增）

**功能**：
- 🔐 **权限概览** - 当前凭证权限
- ⚠️ **高危权限** - 检测到的危险权限
- 📋 **权限清单** - 所需的最小权限
- 📝 **权限建议** - 如何优化权限

### 5. Optimization（优化建议）⭐⭐⭐⭐

#### 5.1 优化建议列表（新增）

**功能**：
- 💡 **建议类型** - 闲置资源、折扣优化、安全修复
- 💰 **节省潜力** - 预估可节省金额
- 📊 **优先级** - 高/中/低优先级
- ✅ **执行状态** - 待执行/已执行/已忽略
- 📝 **详细说明** - 每个建议的详细说明

#### 5.2 批量操作（新增）

**功能**：
- 🏷️ **批量打标签** - 为多个资源打标签
- 🔒 **批量安全修复** - 批量修复安全问题
- 📊 **批量导出** - 批量导出资源信息
- ⚠️ **确认机制** - 操作前确认，防止误操作

#### 5.3 优化历史（新增）

**功能**：
- 📝 **操作历史** - 所有优化操作记录
- 📊 **节省统计** - 累计节省金额
- 🔍 **筛选** - 按时间、类型筛选
- 💾 **导出** - 导出优化历史报告

### 6. Reports（报告生成）⭐⭐⭐⭐

#### 6.1 报告生成（新增）

**功能**：
- 📊 **报告类型** - 资源清单、成本分析、安全报告、综合报告
- 📅 **时间范围** - 选择报告时间范围
- 📋 **内容选择** - 选择包含的内容（资源、成本、安全等）
- 📄 **格式选择** - Excel、PDF、HTML
- ⚡ **生成** - 一键生成报告
- 💾 **下载** - 下载生成的报告

#### 6.2 报告模板（新增）

**功能**：
- 📋 **预设模板** - 周报、月报、季报模板
- 🎨 **自定义模板** - 自定义报告模板
- 📊 **模板预览** - 预览报告效果
- 💾 **模板管理** - 保存、编辑、删除模板

#### 6.3 报告历史（新增）

**功能**：
- 📝 **历史记录** - 所有生成的报告
- 🔍 **搜索** - 按时间、类型搜索
- 💾 **下载** - 重新下载历史报告
- 🗑️ **删除** - 删除不需要的报告

### 7. Settings（设置）⭐⭐⭐

#### 7.1 账号管理（增强）

**当前**：
- 规则配置

**增强**：
- 👤 **账号列表** - 显示所有配置的账号
- ➕ **添加账号** - 添加新账号
- ✏️ **编辑账号** - 编辑账号信息
- 🗑️ **删除账号** - 删除账号
- 🔄 **切换默认账号** - 设置默认账号

#### 7.2 规则配置（已实现，需增强）

**当前**：
- CPU阈值
- 排除标签

**增强**：
- 📊 **闲置检测规则** - CPU、内存、网络、磁盘阈值
- 🏷️ **标签规则** - 必需标签、标签格式
- 🔒 **安全规则** - 安全组规则、加密要求
- 💰 **成本规则** - 预算告警阈值
- 📝 **规则模板** - 预设规则模板

#### 7.3 告警设置（新增）

**功能**：
- 🔔 **告警渠道** - 邮件、钉钉、企业微信、Webhook
- ⚠️ **告警规则** - 成本超预算、安全告警、资源到期
- 📊 **告警阈值** - 设置告警阈值
- 📝 **告警历史** - 查看告警历史

#### 7.4 系统设置（新增）

**功能**：
- 🌐 **语言设置** - 中文/英文
- 🎨 **主题设置** - 深色/浅色主题
- ⏰ **时区设置** - 选择时区
- 📊 **数据刷新** - 自动刷新间隔
- 💾 **数据保留** - 数据保留时间

---

## 🎨 UI/UX设计

### 设计原则

1. **简洁明了** - 信息层次清晰，不冗余
2. **响应式** - 支持桌面、平板、移动端
3. **一致性** - 统一的交互模式和视觉风格
4. **可访问性** - 支持键盘导航、屏幕阅读器
5. **性能优先** - 快速加载，流畅交互

### 设计系统

#### 颜色方案

**深色主题（当前）**：
- 背景：`#09090b`（深黑）
- 前景：`#fafafa`（浅灰）
- 主色：`#3b82f6`（蓝色）
- 成功：`#10b981`（绿色）
- 警告：`#f59e0b`（橙色）
- 错误：`#ef4444`（红色）

**浅色主题（新增）**：
- 背景：`#ffffff`（白色）
- 前景：`#1f2937`（深灰）
- 主色：`#3b82f6`（蓝色）
- 成功：`#10b981`（绿色）
- 警告：`#f59e0b`（橙色）
- 错误：`#ef4444`（红色）

#### 组件库

基于现有组件扩展：
- ✅ Card（已实现）
- ➕ Table（新增，支持排序、筛选、分页）
- ➕ Modal（新增，用于详情、确认）
- ➕ Dropdown（新增，用于筛选、操作）
- ➕ Tabs（新增，用于多标签页）
- ➕ Tooltip（新增，用于提示）
- ➕ Badge（新增，用于状态标签）
- ➕ Progress（新增，用于加载进度）

#### 布局设计

**侧边栏导航**（已实现，需增强）：
```
CloudLens
├── 📊 Dashboard（仪表盘）
├── 📦 Resources（资源管理）
│   ├── ECS
│   ├── RDS
│   ├── Redis
│   └── ...
├── 💰 Cost（成本分析）
│   ├── Overview（概览）
│   ├── Details（详情）
│   ├── Budget（预算）
│   └── Optimization（优化）
├── 🔒 Security（安全合规）
│   ├── Overview（概览）
│   ├── Checks（检查）
│   ├── CIS（合规）
│   └── Audit（审计）
├── ⚡ Optimization（优化建议）
├── 📄 Reports（报告）
└── ⚙️ Settings（设置）
```

**主内容区**：
- 顶部：面包屑导航、账号选择器、刷新按钮
- 内容：根据页面显示不同内容
- 底部：页脚（版本信息、帮助链接）

### 交互设计

#### 加载状态

- **骨架屏** - 数据加载时显示骨架屏
- **进度条** - 长时间操作显示进度条
- **加载动画** - 短时间操作显示加载动画

#### 错误处理

- **错误提示** - Toast通知显示错误
- **空状态** - 友好的空状态提示
- **重试机制** - 失败操作提供重试按钮

#### 反馈机制

- **操作反馈** - 所有操作都有明确的反馈
- **成功提示** - Toast通知显示成功
- **确认对话框** - 危险操作需要确认

---

## 🏗️ 技术架构

### 前端架构

#### 技术栈（保持现有）

- **框架**: Next.js 16（App Router）
- **UI库**: React 19 + TypeScript
- **样式**: Tailwind CSS 4
- **图表**: Recharts（扩展更多图表类型）
- **图标**: Lucide React
- **状态管理**: React Context + Hooks（或考虑Zustand）
- **数据获取**: Fetch API（或考虑React Query）

#### 目录结构

```
web/frontend/
├── app/                    # Next.js App Router
│   ├── layout.tsx          # 根布局
│   ├── page.tsx            # Dashboard首页
│   ├── resources/           # 资源管理
│   │   ├── page.tsx        # 资源列表
│   │   └── [id]/page.tsx   # 资源详情
│   ├── cost/               # 成本分析
│   ├── security/           # 安全合规
│   ├── optimization/       # 优化建议
│   ├── reports/            # 报告生成
│   └── settings/           # 设置
├── components/             # 组件
│   ├── ui/                 # 基础UI组件
│   ├── charts/             # 图表组件
│   ├── tables/             # 表格组件
│   └── layout/             # 布局组件
├── lib/                    # 工具函数
│   ├── api.ts             # API调用封装
│   ├── utils.ts           # 工具函数
│   └── hooks/             # 自定义Hooks
└── types/                  # TypeScript类型定义
```

#### 新增组件

1. **Table组件** - 支持排序、筛选、分页
2. **Modal组件** - 详情、确认对话框
3. **Dropdown组件** - 筛选、操作菜单
4. **Tabs组件** - 多标签页
5. **Tooltip组件** - 提示信息
6. **Badge组件** - 状态标签
7. **Progress组件** - 加载进度

### 后端架构

#### 技术栈（保持现有）

- **框架**: FastAPI
- **ASGI服务器**: Uvicorn
- **数据验证**: Pydantic
- **CORS**: FastAPI CORS Middleware

#### API设计原则

1. **RESTful** - 遵循REST规范
2. **统一响应格式** - 所有API返回统一格式
3. **错误处理** - 统一的错误处理机制
4. **分页** - 列表API支持分页
5. **筛选排序** - 支持筛选和排序
6. **缓存** - 合理使用缓存

#### 新增API端点

**资源管理**：
- `GET /api/resources` - 资源列表（支持筛选、排序、分页）
- `GET /api/resources/{id}` - 资源详情
- `GET /api/resources/{id}/metrics` - 资源监控数据
- `POST /api/resources/{id}/tags` - 更新资源标签

**成本分析**：
- `GET /api/cost/overview` - 成本概览
- `GET /api/cost/details` - 成本详情
- `GET /api/cost/budget` - 预算信息
- `POST /api/cost/budget` - 设置预算
- `GET /api/cost/predict` - 成本预测

**安全合规**：
- `GET /api/security/overview` - 安全概览
- `GET /api/security/checks` - 安全检查结果
- `GET /api/security/cis` - CIS合规检查
- `GET /api/security/audit` - 权限审计

**优化建议**：
- `GET /api/optimization/suggestions` - 优化建议列表
- `POST /api/optimization/execute` - 执行优化操作
- `GET /api/optimization/history` - 优化历史

**报告生成**：
- `POST /api/reports/generate` - 生成报告
- `GET /api/reports` - 报告列表
- `GET /api/reports/{id}` - 报告详情
- `GET /api/reports/{id}/download` - 下载报告

**设置**：
- `GET /api/settings/accounts` - 账号列表
- `POST /api/settings/accounts` - 添加账号
- `PUT /api/settings/accounts/{id}` - 更新账号
- `DELETE /api/settings/accounts/{id}` - 删除账号
- `GET /api/settings/alerts` - 告警设置
- `POST /api/settings/alerts` - 更新告警设置

### 数据流

```
前端 (Next.js)
    ↓ HTTP Request
后端 (FastAPI)
    ↓ 调用Core模块
业务逻辑 (Core)
    ↓ 调用Provider
云API (Aliyun/Tencent)
    ↓ 返回数据
业务逻辑处理
    ↓ 缓存
返回JSON响应
    ↓ HTTP Response
前端渲染
```

---

## 📡 API设计

### 统一响应格式

```typescript
// 成功响应
{
  "success": true,
  "data": {...},
  "message": "操作成功"
}

// 错误响应
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误信息",
    "details": {...}
  }
}
```

### 分页响应格式

```typescript
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

### 筛选和排序

**查询参数**：
- `page`: 页码（默认1）
- `pageSize`: 每页数量（默认20）
- `sortBy`: 排序字段
- `sortOrder`: 排序方向（asc/desc）
- `filter`: 筛选条件（JSON字符串）

**示例**：
```
GET /api/resources?page=1&pageSize=20&sortBy=cost&sortOrder=desc&filter={"status":"Running","region":"cn-hangzhou"}
```

---

## 🚀 实施路线图

### Phase 1: 基础增强（2-3周）

**目标**：完善现有功能，提升用户体验

1. **Dashboard增强**
   - ✅ 添加资源总数卡片
   - ✅ 添加告警数量卡片
   - ✅ 成本图表时间范围选择
   - ✅ 闲置资源表格搜索和筛选

2. **资源管理基础**
   - ✅ 资源列表页面（ECS、RDS、Redis）
   - ✅ 资源详情页面（基本信息、监控数据）
   - ✅ 资源搜索和筛选

3. **UI组件完善**
   - ✅ Table组件（排序、筛选、分页）
   - ✅ Modal组件（详情、确认）
   - ✅ 加载状态和错误处理

4. **文档**
   - ✅ 启动文档
   - ✅ 使用教程

### Phase 2: 核心功能（3-4周）

**目标**：实现核心业务功能

1. **成本分析**
   - ✅ 成本概览页面
   - ✅ 成本详情页面
   - ✅ 成本预测（集成AI）
   - ✅ 预算管理

2. **安全合规**
   - ✅ 安全概览页面
   - ✅ 安全检查页面
   - ✅ CIS合规检查
   - ✅ 权限审计

3. **优化建议**
   - ✅ 优化建议列表
   - ✅ 批量操作
   - ✅ 优化历史

### Phase 3: 高级功能（2-3周）

**目标**：实现高级功能和可视化

1. **报告生成**
   - ✅ 报告生成页面
   - ✅ 报告模板
   - ✅ 报告历史

2. **资源拓扑**
   - ✅ 拓扑图可视化
   - ✅ 交互式操作

3. **实时刷新**
   - ✅ WebSocket集成
   - ✅ 实时数据更新

4. **多账号管理**
   - ✅ 账号切换
   - ✅ 多账号对比

### Phase 4: 优化和扩展（持续）

**目标**：持续优化和扩展

1. **性能优化**
   - ✅ 代码分割
   - ✅ 懒加载
   - ✅ 缓存优化

2. **移动端优化**
   - ✅ 响应式布局优化
   - ✅ 移动端专用视图

3. **国际化**
   - ✅ 多语言支持

4. **PWA**
   - ✅ 离线支持
   - ✅ 安装提示

---

## 📊 优先级排序

### P0 - 必须实现（Phase 1）

1. **Dashboard增强** - 完善现有功能
2. **资源列表和详情** - 核心功能
3. **UI组件完善** - 基础组件
4. **文档** - 启动和使用文档

### P1 - 高优先级（Phase 2）

1. **成本分析** - 核心业务功能
2. **安全合规** - 核心业务功能
3. **优化建议** - 核心业务功能

### P2 - 中优先级（Phase 3）

1. **报告生成** - 重要功能
2. **资源拓扑** - 可视化功能
3. **实时刷新** - 体验提升

### P3 - 低优先级（Phase 4）

1. **移动端优化** - 体验提升
2. **国际化** - 扩展功能
3. **PWA** - 高级功能

---

## 💡 总结

### 核心改进方向

1. **功能完整性** - 补齐缺失的核心功能
2. **用户体验** - 提升交互体验和可视化
3. **性能优化** - 提升加载速度和响应速度
4. **文档完善** - 提供完整的文档

### 预期收益

- **用户覆盖** - 提升50%+（Web界面更易用）
- **使用频率** - 提升3倍（可视化更直观）
- **效率提升** - 节省80%时间（批量操作、自动化）
- **用户满意度** - 显著提升（功能完整、体验好）

---

**设计完成时间**: 2025-12  
**下一步**: 开始Phase 1实施





