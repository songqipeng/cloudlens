# CloudLens é¡¹ç›®æ·±åº¦æ¢³ç†æŠ¥å‘Š

> **æ¢³ç†æ—¶é—´**: 2025-12-15  
> **ç‰ˆæœ¬**: v2.1.0  
> **ç›®æ ‡**: å…¨é¢æ¢³ç†é¡¹ç›®æ¶æ„ã€æ•°æ®æµã€åŠŸèƒ½æ¨¡å—ä¸æŠ€æœ¯å€ºåŠ¡

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®å®šä½ä¸æ ¸å¿ƒä»·å€¼](#é¡¹ç›®å®šä½ä¸æ ¸å¿ƒä»·å€¼)
2. [æŠ€æœ¯æ¶æ„å…¨æ™¯å›¾](#æŠ€æœ¯æ¶æ„å…¨æ™¯å›¾)
3. [æ ¸å¿ƒæ¨¡å—èŒè´£åˆ’åˆ†](#æ ¸å¿ƒæ¨¡å—èŒè´£åˆ’åˆ†)
4. [å…³é”®æ•°æ®æµåˆ†æ](#å…³é”®æ•°æ®æµåˆ†æ)
5. [å­˜å‚¨ä¸ç¼“å­˜ä½“ç³»](#å­˜å‚¨ä¸ç¼“å­˜ä½“ç³»)
6. [é…ç½®ä¸è¿è¡Œæ–¹å¼](#é…ç½®ä¸è¿è¡Œæ–¹å¼)
7. [æ–°å¢åŠŸèƒ½: æŠ˜æ‰£è¶‹åŠ¿åˆ†æ](#æ–°å¢åŠŸèƒ½-æŠ˜æ‰£è¶‹åŠ¿åˆ†æ)
8. [æŠ€æœ¯å€ºåŠ¡ä¸é£é™©ç‚¹](#æŠ€æœ¯å€ºåŠ¡ä¸é£é™©ç‚¹)
9. [é‡æ„è·¯çº¿å›¾](#é‡æ„è·¯çº¿å›¾)
10. [æ€§èƒ½ä¸æ‰©å±•æ€§è¯„ä¼°](#æ€§èƒ½ä¸æ‰©å±•æ€§è¯„ä¼°)

---

## ğŸ¯ é¡¹ç›®å®šä½ä¸æ ¸å¿ƒä»·å€¼

### ä¸€å¥è¯å®šä½

**CloudLens** æ˜¯ä¸€ä¸ªä»¥ **CLI ä¸ºä¸»ã€Web ä¸ºè¾…** çš„ä¼ä¸šçº§å¤šäº‘èµ„æºæ²»ç†å·¥å…·ï¼šé€šè¿‡ **Provider æŠ½è±¡å±‚**æ‹‰å–äº‘èµ„æºã€ç›‘æ§æ•°æ®ä¸è´¦å•æ•°æ®ï¼Œåœ¨æœ¬åœ°è¿›è¡Œ**é—²ç½®è¯†åˆ«ã€æˆæœ¬åˆ†æ/è¶‹åŠ¿ã€å®‰å…¨åˆè§„æ£€æŸ¥ä¸ä¼˜åŒ–å»ºè®®**ï¼Œå¹¶æä¾›æŸ¥è¯¢ã€æŠ¥è¡¨ä¸ï¼ˆéƒ¨åˆ†ï¼‰è‡ªåŠ¨ä¿®å¤èƒ½åŠ›ã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

```
ç»Ÿä¸€è§†å›¾ Â· æ™ºèƒ½åˆ†æ Â· å®‰å…¨åˆè§„ Â· é™æœ¬å¢æ•ˆ
```

- **é™æœ¬å¢æ•ˆ**: è¯†åˆ«é—²ç½®èµ„æºï¼ŒèŠ‚çœ30%+äº‘æˆæœ¬ï¼›AIé¢„æµ‹ï¼Œé¿å…è¶…æ”¯
- **å®‰å…¨åˆè§„**: CIS Benchmarkã€å…¬ç½‘æš´éœ²æ£€æµ‹ã€æƒé™å®¡è®¡
- **ç»Ÿä¸€ç®¡ç†**: ä¸€ä¸ªå·¥å…·ç®¡ç†é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å¤šå¹³å°èµ„æº
- **æ•°æ®é©±åŠ¨**: æˆæœ¬è¶‹åŠ¿ã€æŠ˜æ‰£åˆ†æã€ä¼˜åŒ–å»ºè®®ï¼Œæ”¯æŒå†³ç­–

### æŠ•èµ„å›æŠ¥ï¼ˆROIï¼‰

å‡è®¾ä¼ä¸šäº‘æˆæœ¬ï¼š**100ä¸‡å…ƒ/å¹´**

| ä¼˜åŒ–é¡¹ | èŠ‚çœæ¯”ä¾‹ | å¹´åº¦ä»·å€¼ |
|--------|----------|----------|
| é—²ç½®èµ„æºä¼˜åŒ– | 25% | 25ä¸‡å…ƒ |
| æŠ˜æ‰£ä¼˜åŒ–ï¼ˆå•†åŠ¡è°ˆåˆ¤ï¼‰ | 5% | 5ä¸‡å…ƒ |
| æ—¶é—´æˆæœ¬èŠ‚çœï¼ˆäººå·¥æŠ¥è¡¨ï¼‰ | - | 10ä¸‡å…ƒ |
| **æ€»è®¡** | - | **40ä¸‡å…ƒ/å¹´** |
| **å·¥å…·æˆæœ¬** | - | 0å…ƒï¼ˆå¼€æºï¼‰ |
| **ROI** | - | **âˆ** |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„å…¨æ™¯å›¾

### ç³»ç»Ÿåˆ†å±‚æ¶æ„ï¼ˆæ–‡å­—ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Interface Layer (äº¤äº’å±‚)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   CLI (Click)       â”‚      â”‚   Web API (FastAPI)     â”‚  â”‚
â”‚  â”‚ - query             â”‚      â”‚ - /api/resources        â”‚  â”‚
â”‚  â”‚ - analyze           â”‚      â”‚ - /api/cost             â”‚  â”‚
â”‚  â”‚ - config            â”‚      â”‚ - /api/security         â”‚  â”‚
â”‚  â”‚ - remediate         â”‚      â”‚ - /api/discounts âœ¨     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚                    Web Frontend (Next.js)                   â”‚
â”‚              Dashboard / Resources / Cost / Security        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Service Layer (ä¸šåŠ¡æœåŠ¡å±‚)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  core/services/                                      â”‚  â”‚
â”‚  â”‚  - analysis_service.py (é—²ç½®åˆ†æèšåˆæœåŠ¡)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Configuration & Rules Layer (é…ç½®å±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  core/config.py      - è´¦å·é…ç½®ï¼ˆå¤šæºåŠ è½½ï¼‰          â”‚  â”‚
â”‚  â”‚  core/context.py     - CLIä¸Šä¸‹æ–‡ï¼ˆä¸Šæ¬¡è´¦å·ï¼‰         â”‚  â”‚
â”‚  â”‚  core/rules_manager.py - é—²ç½®é˜ˆå€¼/ç™½åå•è§„åˆ™        â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  å­˜å‚¨ä½ç½®:                                           â”‚  â”‚
â”‚  â”‚  - ~/.cloudlens/config.json                         â”‚  â”‚
â”‚  â”‚  - ~/.cloudlens/credentials                         â”‚  â”‚
â”‚  â”‚  - ~/.cloudlens/rules.json                          â”‚  â”‚
â”‚  â”‚  - ç³»ç»Ÿ Keyring (å¯†é’¥)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Analyzer Layer (åˆ†æå™¨å±‚)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  core/idle_detector.py        - é—²ç½®æ£€æµ‹            â”‚  â”‚
â”‚  â”‚  core/cost_trend_analyzer.py  - æˆæœ¬è¶‹åŠ¿ï¼ˆå¿«ç…§ï¼‰    â”‚  â”‚
â”‚  â”‚  core/cost_analyzer.py        - æˆæœ¬åˆ†æï¼ˆç»­è´¹ï¼‰    â”‚  â”‚
â”‚  â”‚  core/discount_analyzer.py âœ¨ - æŠ˜æ‰£è¶‹åŠ¿ï¼ˆè´¦å•CSVï¼‰ â”‚  â”‚
â”‚  â”‚  core/security_compliance.py  - å®‰å…¨åˆè§„            â”‚  â”‚
â”‚  â”‚  core/optimization_engine.py  - ä¼˜åŒ–å»ºè®®            â”‚  â”‚
â”‚  â”‚  core/cis_compliance.py       - CIS Benchmark       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Provider Abstraction Layer (äº‘æŠ½è±¡å±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  core/provider.py (BaseProvider Interface)          â”‚  â”‚
â”‚  â”‚  - list_instances() / list_rds() / list_redis()     â”‚  â”‚
â”‚  â”‚  - list_vpcs() / get_metric() / check_permissions() â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  providers/aliyun/provider.py (AliyunProvider)      â”‚  â”‚
â”‚  â”‚  providers/tencent/provider.py (TencentProvider)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data & Cache Layer (æ•°æ®ä¸ç¼“å­˜å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âš ï¸ åŒç¼“å­˜ä½“ç³»ï¼ˆéœ€ç»Ÿä¸€ï¼‰:                            â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [ä¸»è·¯å¾„] core/cache.py (CacheManager)              â”‚  â”‚
â”‚  â”‚  - SQLiteç¼“å­˜: ~/.cloudlens/cache.db                â”‚  â”‚
â”‚  â”‚  - TTL: 5åˆ†é’Ÿï¼ˆèµ„æºæŸ¥è¯¢ï¼‰/ 24å°æ—¶ï¼ˆåˆ†æç»“æœï¼‰       â”‚  â”‚
â”‚  â”‚  - ä½¿ç”¨è€…: CLI query, Web API, analysis_service     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [æ—§è·¯å¾„] core/cache_manager.py (CacheManager) âš ï¸   â”‚  â”‚
â”‚  â”‚  - msgpackæ–‡ä»¶ç¼“å­˜: ./data/cache/*.pkl              â”‚  â”‚
â”‚  â”‚  - TTL: 24å°æ—¶                                      â”‚  â”‚
â”‚  â”‚  - ä½¿ç”¨è€…: core/base_analyzer.py (æ—§åˆ†æå™¨åŸºç±»)     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  æˆæœ¬å†å²: ./data/cost/cost_history.json            â”‚  â”‚
â”‚  â”‚  æŠ˜æ‰£ç¼“å­˜: ~/.cloudlens/discount_cache/*.json âœ¨    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloud API Layer (äº‘APIå±‚)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é˜¿é‡Œäº‘ SDK:                                         â”‚  â”‚
â”‚  â”‚  - ECS API (DescribeInstances)                      â”‚  â”‚
â”‚  â”‚  - RDS API (DescribeDBInstances)                    â”‚  â”‚
â”‚  â”‚  - CloudMonitor API (DescribeMetricData)            â”‚  â”‚
â”‚  â”‚  - BSS API (QueryBillOverview, QueryInstanceBill)   â”‚  â”‚
â”‚  â”‚  - STS/RAM API (æƒé™æ£€æŸ¥)                           â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  è…¾è®¯äº‘ SDK:                                         â”‚  â”‚
â”‚  â”‚  - CVM API, CDB API, Monitor API                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â¬‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Data Sources (å¤–éƒ¨æ•°æ®æº)              â”‚
â”‚  - é˜¿é‡Œäº‘è´¦å•CSVæ–‡ä»¶ï¼ˆæ¶ˆè´¹æ˜ç»†ï¼‰âœ¨                           â”‚
â”‚  - æœ¬åœ°SQLiteæ•°æ®åº“ï¼ˆ*_monitoring_data.dbï¼‰âš ï¸ æ—§æ¶æ„        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾ä¾‹è¯´æ˜**:
- âœ¨ æ–°å¢åŠŸèƒ½/è·¯å¾„
- âš ï¸ å­˜åœ¨æŠ€æœ¯å€ºåŠ¡/éœ€è¦é‡æ„

---

## ğŸ” æ ¸å¿ƒæ¨¡å—èŒè´£åˆ’åˆ†

### 1. Interface Layerï¼ˆäº¤äº’å±‚ï¼‰

#### CLI (`cli/main.py` + `cli/commands/*`)

**èŒè´£**: å‘½ä»¤è¡Œäº¤äº’å…¥å£

**å‘½ä»¤ç»„**:
- `config` - è´¦å·ç®¡ç†ï¼ˆæ·»åŠ ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
- `query` - èµ„æºæŸ¥è¯¢ï¼ˆECSã€RDSã€Redisã€VPCç­‰ï¼‰
- `analyze` - åˆ†æåŠŸèƒ½ï¼ˆidleã€costã€forecastã€securityã€discount âœ¨ï¼‰
- `remediate` - è‡ªåŠ¨ä¿®å¤ï¼ˆtagsã€securityï¼‰
- `cache` - ç¼“å­˜ç®¡ç†ï¼ˆstatusã€clearã€cleanupï¼‰
- `dashboard` - TUIä»ªè¡¨ç›˜
- `repl` - äº¤äº’å¼REPL

**ä¾èµ–**:
- `core/config.py` - é…ç½®ç®¡ç†
- `core/context.py` - ä¸Šä¸‹æ–‡ï¼ˆè®°å¿†ä¸Šæ¬¡è´¦å·ï¼‰
- `cli/utils.py` - å·¥å…·å‡½æ•°ï¼ˆget_provider, smart_resolve_accountï¼‰

#### Web API (`web/backend/main.py` + `web/backend/api.py`)

**èŒè´£**: RESTful APIæœåŠ¡

**ä¸»è¦ç«¯ç‚¹**:
- `/api/accounts` - è´¦å·åˆ—è¡¨
- `/api/resources` - èµ„æºç®¡ç†ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ç›‘æ§ï¼‰
- `/api/dashboard/*` - ä»ªè¡¨ç›˜æ•°æ®ï¼ˆsummaryã€trendã€idleï¼‰
- `/api/cost/*` - æˆæœ¬åˆ†æï¼ˆoverviewã€breakdownã€budgetï¼‰
- `/api/security/*` - å®‰å…¨åˆ†æï¼ˆoverviewã€checksã€cisï¼‰
- `/api/optimization/*` - ä¼˜åŒ–å»ºè®®
- `/api/billing/*` - è´¦å•æŸ¥è¯¢ï¼ˆBSS APIï¼‰
- `/api/discounts/*` âœ¨ - æŠ˜æ‰£è¶‹åŠ¿åˆ†æ
- `/api/reports/*` - æŠ¥å‘Šç”Ÿæˆ

**è®¾è®¡ç‰¹ç‚¹**:
- 24å°æ—¶ç¼“å­˜ï¼ˆ`core/cache.py`ï¼‰
- ä¼˜å…ˆä½¿ç”¨BSSè´¦å•å£å¾„ï¼ˆæ›´å‡†ç¡®ï¼‰
- ç»Ÿä¸€å“åº”æ ¼å¼
- CORSæ”¯æŒï¼ˆå¼€å‘ç¯å¢ƒï¼‰

#### Web Frontend (`web/frontend/`)

**æŠ€æœ¯æ ˆ**: Next.js 16 + React 19 + TypeScript + Tailwind CSS

**é¡µé¢ç»“æ„**:
```
app/
â”œâ”€â”€ page.tsx                    # Dashboard
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ page.tsx               # èµ„æºåˆ—è¡¨
â”‚   â””â”€â”€ [id]/page.tsx          # èµ„æºè¯¦æƒ…
â”œâ”€â”€ cost/
â”‚   â”œâ”€â”€ page.tsx               # æˆæœ¬æ¦‚è§ˆ
â”‚   â””â”€â”€ budget/page.tsx        # é¢„ç®—ç®¡ç†
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ page.tsx               # å®‰å…¨æ¦‚è§ˆ
â”‚   â””â”€â”€ cis/page.tsx           # CISåˆè§„
â”œâ”€â”€ discounts/page.tsx âœ¨      # æŠ˜æ‰£åˆ†æ
â”œâ”€â”€ optimization/page.tsx      # ä¼˜åŒ–å»ºè®®
â”œâ”€â”€ reports/page.tsx           # æŠ¥å‘Šç”Ÿæˆ
â””â”€â”€ settings/
    â”œâ”€â”€ page.tsx               # è®¾ç½®
    â””â”€â”€ accounts/page.tsx      # è´¦å·ç®¡ç†
```

---

### 2. Business Service Layerï¼ˆä¸šåŠ¡æœåŠ¡å±‚ï¼‰

#### `core/services/analysis_service.py`

**èŒè´£**: é—²ç½®èµ„æºåˆ†æçš„èšåˆæœåŠ¡

**æ ¸å¿ƒæµç¨‹**:
```python
analyze_idle_resources(account, days, force_refresh)
  â†“
1. æ£€æŸ¥ç¼“å­˜ï¼ˆ24h TTLï¼‰
2. åŠ è½½è§„åˆ™ï¼ˆRulesManagerï¼‰
3. è·å–èµ„æºåˆ—è¡¨ï¼ˆAliyunProviderï¼‰
4. è·å–ç›‘æ§æŒ‡æ ‡ï¼ˆIdleDetector.fetch_ecs_metricsï¼‰
5. åˆ¤å®šé—²ç½®ï¼ˆIdleDetector.is_ecs_idleï¼‰
6. ä¿å­˜ç¼“å­˜
  â†“
è¿”å›: (idle_instances, is_cached)
```

**ç‰¹ç‚¹**:
- å°è£…å®Œæ•´çš„åˆ†ææµç¨‹
- ç»Ÿä¸€ç¼“å­˜ç®¡ç†
- æ”¯æŒç™½åå•æ ‡ç­¾è±å…

---

### 3. Configuration & Rules Layerï¼ˆé…ç½®ä¸è§„åˆ™å±‚ï¼‰

#### `core/config.py` (ConfigManager)

**èŒè´£**: å¤šæºè´¦å·é…ç½®åŠ è½½

**é…ç½®æºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰**:
1. ç¯å¢ƒå˜é‡ (`CLOUDLENS_ACCESS_KEY_ID`)
2. credentialsæ–‡ä»¶ (`~/.cloudlens/credentials`)
3. config.json + Keyring (`~/.cloudlens/config.json`)

**è®¾è®¡äº®ç‚¹**:
- å¯†é’¥å­˜å‚¨åœ¨ç³»ç»ŸKeyringï¼Œé…ç½®æ–‡ä»¶ä¸åŒ…å«æ˜æ–‡å¯†é’¥
- æ”¯æŒAWS CLIå…¼å®¹çš„credentialsæ ¼å¼
- å¤šè´¦å·ç®¡ç†

**é…ç½®ç»“æ„**:
```python
CloudAccount:
  - name: str           # è´¦å·åˆ«å
  - provider: str       # aliyun/tencent
  - access_key_id: str
  - access_key_secret: str  # ä»KeyringåŠ è½½
  - region: str         # é»˜è®¤åŒºåŸŸ
```

#### `core/context.py` (ContextManager)

**èŒè´£**: CLIä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆè®°å¿†ç”¨æˆ·æ“ä½œï¼‰

**åŠŸèƒ½**:
- è®°å½•ä¸Šæ¬¡ä½¿ç”¨çš„è´¦å·ï¼ˆ`last_account`ï¼‰
- é»˜è®¤äº‘å‚å•†ï¼ˆ`default_provider`ï¼‰

**å­˜å‚¨**: `~/.cloudlens/context.json`

#### `core/rules_manager.py` (RulesManager)

**èŒè´£**: èµ„æºä¼˜åŒ–è§„åˆ™ç®¡ç†

**è§„åˆ™ç±»å‹**:
```json
{
  "version": "1.0",
  "idle_rules": {
    "ecs": {
      "cpu_threshold_percent": 5,
      "network_threshold_bytes_sec": 1000,
      "exclude_tags": ["k8s.io", "ack.aliyun.com"]
    }
  }
}
```

**å­˜å‚¨**: `~/.cloudlens/rules.json`

---

### 4. Analyzer Layerï¼ˆåˆ†æå™¨å±‚ï¼‰

#### `core/idle_detector.py` (IdleDetector)

**èŒè´£**: åˆ¤æ–­èµ„æºæ˜¯å¦é—²ç½®

**æ£€æµ‹æ ‡å‡†**ï¼ˆæˆ–å…³ç³»ï¼Œæ»¡è¶³2é¡¹å³åˆ¤å®šä¸ºé—²ç½®ï¼‰:
- CPUåˆ©ç”¨ç‡ < 5%
- å†…å­˜åˆ©ç”¨ç‡ < 20%
- å…¬ç½‘æµé‡ < 1KB/s
- ç£ç›˜IOPS < 100

**æ•°æ®æ¥æº**: CloudMonitor APIï¼ˆ7-14å¤©å†å²æ•°æ®ï¼‰

**æ”¯æŒç‰¹æ€§**:
- ç™½åå•æ ‡ç­¾è±å…ï¼ˆå¦‚ï¼š`k8s.io`ã€`ack.aliyun.com`ï¼‰
- å¯é…ç½®é˜ˆå€¼

**æ ¸å¿ƒæ–¹æ³•**:
```python
is_ecs_idle(metrics, instance_tags) -> (is_idle, reasons)
fetch_ecs_metrics(provider, instance_id, days) -> Dict[metric_name, avg_value]
```

#### `core/cost_trend_analyzer.py` (CostTrendAnalyzer)

**èŒè´£**: æˆæœ¬è¶‹åŠ¿åˆ†æï¼ˆåŸºäºå¿«ç…§ï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `record_cost_snapshot()` - è®°å½•æˆæœ¬å¿«ç…§
- `get_cost_trend()` - è·å–è¶‹åŠ¿æ•°æ®
- `generate_trend_report()` - ç”Ÿæˆè¶‹åŠ¿æŠ¥å‘Š

**æ•°æ®å­˜å‚¨**: `./data/cost/cost_history.json`

**åˆ†ææŒ‡æ ‡**:
- æ€»æˆæœ¬å˜åŒ–ï¼ˆç¯æ¯”MoMã€åŒæ¯”YoYï¼‰
- æŒ‰èµ„æºç±»å‹åˆ†å¸ƒ
- æŒ‰åŒºåŸŸåˆ†å¸ƒ
- è¶‹åŠ¿æ–¹å‘ï¼ˆä¸Šå‡/ä¸‹é™/å¹³ç¨³ï¼‰

**æˆæœ¬æ¥æº**:
- **ä¼°ç®—**: åŸºäºè§„æ ¼ï¼ˆfamilyã€sizeã€generationï¼‰
- **âš ï¸ å£å¾„é—®é¢˜**: ä¸BSSè´¦å•å®é™…é‡‘é¢å¯èƒ½ä¸ä¸€è‡´

#### `core/discount_analyzer.py` âœ¨ (DiscountTrendAnalyzer) **NEW**

**èŒè´£**: æŠ˜æ‰£è¶‹åŠ¿åˆ†æï¼ˆåŸºäºè´¦å•CSVï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
1. **è´¦å•è§£æ**
   - è§£æé˜¿é‡Œäº‘è´¦å•CSVæ–‡ä»¶ï¼ˆæ¶ˆè´¹æ˜ç»†ï¼‰
   - æ”¯æŒå¤šæ–‡ä»¶åˆå¹¶ï¼ˆdetail_1, detail_2...ï¼‰
   - è‡ªåŠ¨æŸ¥æ‰¾è´¦å•ç›®å½•

2. **å¤šç»´åº¦èšåˆ**
   - æŒ‰æœˆèšåˆï¼ˆæœ€è¿‘6ä¸ªæœˆï¼‰
   - æŒ‰äº§å“èšåˆï¼ˆTOP 20ï¼‰
   - æŒ‰åˆåŒèšåˆï¼ˆå•†åŠ¡æŠ˜æ‰£ï¼‰
   - æŒ‰å®ä¾‹èšåˆï¼ˆTOP 50é«˜æŠ˜æ‰£å®ä¾‹ï¼‰

3. **è¶‹åŠ¿åˆ†æ**
   - æŠ˜æ‰£ç‡å˜åŒ–è¶‹åŠ¿
   - æŠ˜æ‰£é‡‘é¢å˜åŒ–
   - äº§å“çº§æŠ˜æ‰£å¯¹æ¯”
   - åˆåŒæ•ˆæœè¯„ä¼°

4. **æŠ¥å‘Šç”Ÿæˆ**
   - HTMLæŠ¥å‘Šï¼ˆäº¤äº’å¼å›¾è¡¨ï¼‰
   - ExcelæŠ¥å‘Šï¼ˆå¤šSheetï¼‰
   - JSONæ•°æ®ï¼ˆAPIé›†æˆï¼‰

**æ•°æ®æº**: 
- è´¦å•CSVç›®å½•ï¼ˆå¦‚ï¼š`1844634015852583-ydzn/`ï¼‰
- ç¼“å­˜ï¼š`~/.cloudlens/discount_cache/*.json`ï¼ˆ24h TTLï¼‰

**å…³é”®å­—æ®µ**:
- å®˜ç½‘ä»· - æœªæŠ˜æ‰£å‰çš„åŸä»·
- ä¼˜æƒ é‡‘é¢ - æŠ˜æ‰£é‡‘é¢
- åº”ä»˜é‡‘é¢ - æŠ˜æ‰£åé‡‘é¢
- ä¼˜æƒ åç§° - æŠ˜æ‰£æ´»åŠ¨åç§°
- åˆåŒç¼–å· - å•†åŠ¡åˆåŒç¼–å·

**ä½¿ç”¨åœºæ™¯**:
- å•†åŠ¡åˆåŒç»­ç­¾è¯„ä¼°
- æŠ˜æ‰£å˜åŒ–ç›‘æ§
- æˆæœ¬ä¼˜åŒ–å†³ç­–

#### `core/security_compliance.py` (SecurityComplianceAnalyzer)

**èŒè´£**: å®‰å…¨åˆè§„æ£€æŸ¥

**æ£€æŸ¥é¡¹**:
- å…¬ç½‘æš´éœ²æ£€æµ‹
- åœæ­¢å®ä¾‹æ£€æŸ¥ï¼ˆä»äº§ç”Ÿç£ç›˜è´¹ç”¨ï¼‰
- æ ‡ç­¾è¦†ç›–ç‡æ£€æŸ¥
- ç£ç›˜åŠ å¯†æ£€æŸ¥
- æŠ¢å å¼å®ä¾‹æ£€æŸ¥
- EIPä½¿ç”¨æƒ…å†µ

**è¿”å›**: å®‰å…¨è¯„åˆ†ï¼ˆ0-100ï¼‰+ æ£€æŸ¥ç»“æœåˆ—è¡¨

#### `core/optimization_engine.py` (OptimizationEngine)

**èŒè´£**: ä¼˜åŒ–å»ºè®®å¼•æ“

**æ•°æ®æ¥æº**: 
- âš ï¸ æœ¬åœ°SQLiteæ•°æ®åº“ï¼ˆ`*_monitoring_data.db`ï¼‰
- å­˜åœ¨ä¾èµ–é—®é¢˜ï¼ˆç¯å¢ƒç¼ºå¤±æ–‡ä»¶æ—¶åŠŸèƒ½é€€åŒ–ï¼‰

**åˆ†æç±»å‹**:
- é—²ç½®ECSï¼ˆCPU/å†…å­˜ä½ï¼‰
- é—²ç½®RDSï¼ˆè¿æ¥æ•°ä½ï¼‰
- æœªç»‘å®šEIP
- æœªæŒ‚è½½äº‘ç›˜
- è§„æ ¼é™é…å»ºè®®

**è¾“å‡º**:
- ä¼˜åŒ–æœºä¼šåˆ—è¡¨ï¼ˆèµ„æºç±»å‹ã€æ“ä½œã€èŠ‚çœæ½œåŠ›ï¼‰
- ROIè®¡ç®—
- ä¼˜åŒ–è„šæœ¬ç”Ÿæˆï¼ˆé˜¿é‡Œäº‘CLIå‘½ä»¤ï¼‰

---

### 5. Provider Abstraction Layerï¼ˆäº‘æŠ½è±¡å±‚ï¼‰

#### `core/provider.py` (BaseProvider)

**è®¾è®¡æ¨¡å¼**: æŠ½è±¡å·¥å‚ + é€‚é…å™¨

**æ ¸å¿ƒæ¥å£**:
```python
class BaseProvider(ABC):
    @abstractmethod
    def list_instances() -> List[UnifiedResource]
    
    @abstractmethod
    def list_rds() -> List[UnifiedResource]
    
    @abstractmethod
    def list_vpcs() -> List[Dict]
    
    @abstractmethod
    def get_metric(resource_id, metric_name, start_time, end_time) -> List[Dict]
    
    @abstractmethod
    def check_permissions() -> List[str]
```

#### `providers/aliyun/provider.py` (AliyunProvider)

**å®ç°çš„èµ„æºç±»å‹**:
- ECS (list_instances) - æ”¯æŒåˆ†é¡µ
- RDS (list_rds)
- Redis (list_redis)
- OSS (list_oss) - éœ€è¦oss2åº“
- VPC (list_vpcs)
- EIP (list_eip) âš ï¸ å‘½åä¸ä¸€è‡´
- SLB (list_slb)
- NAT (list_nat_gateways)
- MongoDB (list_mongodb)
- NAS (list_nas) âš ï¸ æœ‰bugï¼Œä½¿ç”¨äº†æœªå®šä¹‰çš„self.regions
- Disk (list_disks)
- Snapshot (list_snapshots)

**ç›‘æ§æŒ‡æ ‡**:
- é€šè¿‡CloudMonitor APIè·å–
- æ”¯æŒçš„æŒ‡æ ‡: CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜IOPS
- ç²’åº¦: æ—¥å‡å€¼ï¼ˆPeriod=86400ï¼‰

**æƒé™æ£€æŸ¥**:
- ä½¿ç”¨STS APIè·å–å½“å‰èº«ä»½
- ä½¿ç”¨RAM APIè·å–ç­–ç•¥åˆ—è¡¨
- æ£€æµ‹é«˜å±æƒé™ï¼ˆAdministratorAccessã€FullAccessç­‰ï¼‰

#### `providers/tencent/provider.py` (TencentProvider)

**å®ç°çš„èµ„æºç±»å‹**:
- CVM (list_instances)
- CDB (list_rds)
- Redis (list_redis)
- COS (list_oss) - éœ€è¦qcloud_cosåº“
- VPC (list_vpcs)

**ç›‘æ§æŒ‡æ ‡**:
- é€šè¿‡Monitor APIè·å–
- å‘½åç©ºé—´: QCE/CVM

---

### 6. Data Model Layerï¼ˆæ•°æ®æ¨¡å‹å±‚ï¼‰

#### `models/resource.py` (UnifiedResource)

**è®¾è®¡åŸåˆ™**: æœ€å°å…¬å…±é›† + å¯æ‰©å±•

**æ ¸å¿ƒå­—æ®µ**:
```python
@dataclass
class UnifiedResource:
    id: str                    # å®ä¾‹ID
    name: str                  # å®ä¾‹åç§°
    provider: str              # äº‘å‚å•†ï¼ˆaliyun/tencentï¼‰
    region: str                # åŒºåŸŸ
    zone: Optional[str]        # å¯ç”¨åŒº
    resource_type: ResourceType  # èµ„æºç±»å‹æšä¸¾
    status: ResourceStatus     # çŠ¶æ€æšä¸¾
    
    # ç½‘ç»œä¿¡æ¯
    private_ips: List[str]
    public_ips: List[str]
    vpc_id: Optional[str]
    
    # è§„æ ¼ä¸è®¡è´¹
    spec: Optional[str]        # å®ä¾‹è§„æ ¼
    cpu: int                   # CPUæ ¸æ•°
    memory: int                # å†…å­˜ï¼ˆMBï¼‰
    charge_type: str           # PrePaid/PostPaid
    
    # æ—¶é—´ä¿¡æ¯
    created_time: Optional[datetime]
    expired_time: Optional[datetime]
    
    # æ‰©å±•
    raw_data: Dict            # åŸå§‹APIå“åº”
    tags: Dict[str, str]      # èµ„æºæ ‡ç­¾
```

**æšä¸¾ç±»å‹**:
- `ResourceType`: ECS, RDS, REDIS, MONGODB, SLB, NAT, OSS, VPC, EIP
- `ResourceStatus`: RUNNING, STOPPED, STARTING, STOPPING, CHANGING

---

## ğŸ”„ å…³é”®æ•°æ®æµåˆ†æ

### æ•°æ®æµ1: CLIèµ„æºæŸ¥è¯¢ (`cl query ecs`)

```
ç”¨æˆ·è¾“å…¥: ./cl query ecs --account prod
  â†“
cli/commands/query_cmd.py
  â†“ smart_resolve_account()
core/config.py: è§£æè´¦å·é…ç½®
  â†“ æ£€æŸ¥ç¼“å­˜
core/cache.py: æŸ¥è¯¢SQLiteç¼“å­˜ï¼ˆTTL=5åˆ†é’Ÿï¼‰
  â†“ ç¼“å­˜æœªå‘½ä¸­
cli/utils.py: get_provider(account_config)
  â†“
providers/aliyun/provider.py: AliyunProviderå®ä¾‹åŒ–
  â†“
provider.list_instances()
  â†“ DescribeInstancesRequestï¼ˆåˆ†é¡µï¼ŒPageSize=100ï¼‰
é˜¿é‡Œäº‘ECS API
  â†“ å“åº”JSON
è½¬æ¢ä¸ºUnifiedResourceåˆ—è¡¨
  â†“ ä¿å­˜ç¼“å­˜
core/cache.py: å­˜å…¥SQLite
  â†“ æ ¼å¼åŒ–è¾“å‡º
Rich Tableå±•ç¤º
```

**æ€§èƒ½ä¼˜åŒ–ç‚¹**:
- âœ… SQLiteç¼“å­˜ï¼ˆ5åˆ†é’ŸTTLï¼‰
- âœ… åˆ†é¡µæŸ¥è¯¢ï¼ˆé¿å…å¤§é‡æ•°æ®ä¸€æ¬¡åŠ è½½ï¼‰
- âœ… æ‡’åŠ è½½SDKï¼ˆæŒ‰éœ€å¯¼å…¥ï¼‰

---

### æ•°æ®æµ2: CLIé—²ç½®åˆ†æ (`cl analyze idle`)

```
ç”¨æˆ·è¾“å…¥: ./cl analyze idle --account prod --days 7
  â†“
cli/commands/analyze_cmd.py
  â†“
core/services/analysis_service.py
  â†“ æ£€æŸ¥ç¼“å­˜
core/cache.py: æŸ¥è¯¢ idle_resultï¼ˆTTL=24hï¼‰
  â†“ ç¼“å­˜æœªå‘½ä¸­
core/rules_manager.py: åŠ è½½è§„åˆ™ï¼ˆCPUé˜ˆå€¼ã€ç™½åå•ï¼‰
  â†“
providers/aliyun/provider.py: è·å–ECSåˆ—è¡¨
  â†“ for each instance
core/idle_detector.py:
  â†“ fetch_ecs_metrics()
provider.get_metric(): CloudMonitor API
  â†“ 6ä¸ªæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ï¼‰
  â†“ is_ecs_idle(metrics, tags)
åˆ¤å®š: æ˜¯å¦æ»¡è¶³2ä¸ªæ¡ä»¶ï¼Ÿ
  â†“ æ£€æŸ¥ç™½åå•æ ‡ç­¾
  â†“ åˆ¤å®šç»“æœ
æ±‡æ€»é—²ç½®å®ä¾‹åˆ—è¡¨
  â†“ ä¿å­˜ç¼“å­˜
core/cache.py: å­˜å…¥idle_result
  â†“ è¾“å‡º
Rich Tableå±•ç¤ºï¼ˆå®ä¾‹IDã€åŸå› ã€è§„æ ¼ï¼‰
```

**å…³é”®ç‚¹**:
- ç›‘æ§APIè°ƒç”¨é¢‘ç¹ï¼ˆæ¯å®ä¾‹6æ¬¡ï¼Œsleep 0.1sé˜²é™æµï¼‰
- 24hç¼“å­˜å‡å°‘é‡å¤åˆ†æ
- ç™½åå•æœºåˆ¶é¿å…è¯¯æŠ¥ï¼ˆå¦‚K8sèŠ‚ç‚¹ï¼‰

---

### æ•°æ®æµ3: Web DashboardåŠ è½½

```
å‰ç«¯è¯·æ±‚: GET /api/dashboard/summary?account=prod
  â†“
web/backend/api.py: get_summary()
  â†“ æ£€æŸ¥ç¼“å­˜
core/cache.py: æŸ¥è¯¢ dashboard_summaryï¼ˆTTL=24hï¼‰
  â†“ ç¼“å­˜æœªå‘½ä¸­
core/config.py: è§£æè´¦å·é…ç½®
  â†“ ä¼˜å…ˆä½¿ç”¨è´¦å•å£å¾„
_get_billing_overview_totals(): BSS API QueryBillOverview
  â†“ è·å–å½“æœˆæ€»æˆæœ¬
  â†“ è·å–è¶‹åŠ¿æ•°æ®
core/cost_trend_analyzer.py: generate_trend_report()
  â†“ è¯»å– ./data/cost/cost_history.json
  â†“ è®¡ç®—ç¯æ¯”MoM
  â†“ è·å–é—²ç½®æ•°æ®
core/cache.py: æŸ¥è¯¢ idle_result
  â†“ è·å–èµ„æºç»Ÿè®¡
provider.list_instances/rds/redis()
  â†“ è®¡ç®—æ ‡ç­¾è¦†ç›–ç‡
  â†“ è®¡ç®—èŠ‚çœæ½œåŠ›
éå†é—²ç½®å®ä¾‹ï¼Œç´¯åŠ çœŸå®æˆæœ¬ï¼ˆBSSæ˜ å°„ï¼‰
  â†“ æ„é€ å“åº”
{
  total_cost, idle_count, trend, trend_pct,
  total_resources, resource_breakdown,
  tag_coverage, savings_potential
}
  â†“ ä¿å­˜ç¼“å­˜ï¼ˆ24hï¼‰
  â†“ è¿”å›JSON
å‰ç«¯ Next.js æ¸²æŸ“ Dashboard
```

**æ€§èƒ½ä¼˜åŒ–**:
- 24hç¼“å­˜ï¼ˆé¿å…é¢‘ç¹APIè°ƒç”¨ï¼‰
- ä¼˜å…ˆä½¿ç”¨BSSè´¦å•ï¼ˆæ›´å‡†ç¡®ï¼‰
- æ‰¹é‡æŸ¥è¯¢èµ„æºï¼ˆéé€ä¸ªï¼‰

---

### æ•°æ®æµ4: æŠ˜æ‰£è¶‹åŠ¿åˆ†æ âœ¨ (`cl analyze discount`)

```
ç”¨æˆ·è¾“å…¥: ./cl analyze discount --export
  â†“
cli/commands/analyze_cmd.py
  â†“
core/discount_analyzer.py: DiscountTrendAnalyzer
  â†“ æŸ¥æ‰¾è´¦å•ç›®å½•
find_bill_directories(): æ‰«æé¡¹ç›®æ ¹ç›®å½•
  â†“ æ‰¾åˆ°ç›®å½•: 1844634015852583-ydzn/
  â†“ æ£€æŸ¥ç¼“å­˜
~/.cloudlens/discount_cache/{dir_name}_discount_trend.json (24h)
  â†“ ç¼“å­˜æœªå‘½ä¸­
  â†“ è§£æCSVæ–‡ä»¶
parse_bill_csv(): è¯»å–æ‰€æœ‰ *.csv
  â†“ æ¯ä¸ªæ–‡ä»¶çº¦30ä¸‡è¡Œï¼Œå…±5ä¸ªæ–‡ä»¶
  â†“ æå–å…³é”®å­—æ®µï¼ˆè´¦æœŸã€äº§å“ã€å®ä¾‹IDã€å®˜ç½‘ä»·ã€ä¼˜æƒ é‡‘é¢ã€åˆåŒï¼‰
  â†“ æŒ‰æœˆèšåˆ
aggregate_monthly_discounts():
  â†“ ç»´åº¦1: æ€»ä½“ï¼ˆtotal_official_price, total_discount_amountï¼‰
  â†“ ç»´åº¦2: æŒ‰äº§å“ï¼ˆby_productï¼‰
  â†“ ç»´åº¦3: æŒ‰åˆåŒï¼ˆby_contractï¼‰
  â†“ ç»´åº¦4: æŒ‰å®ä¾‹ï¼ˆby_instanceï¼‰
  â†“ è®¡ç®—æŠ˜æ‰£ç‡
  â†“ è¶‹åŠ¿åˆ†æ
_analyze_trends(): 
  â†“ æŠ˜æ‰£ç‡å˜åŒ–ï¼ˆé¦–æœˆ vs æœ«æœˆï¼‰
  â†“ è¶‹åŠ¿æ–¹å‘ï¼ˆä¸Šå‡/ä¸‹é™/å¹³ç¨³ï¼‰
  â†“ å¹³å‡æŠ˜æ‰£ç‡ã€æœ€å¤§æœ€å°
  â†“ ç´¯è®¡èŠ‚çœé‡‘é¢
  â†“ äº§å“çº§åˆ†æ
_analyze_product_discounts(): TOP 20äº§å“æŠ˜æ‰£è¶‹åŠ¿
  â†“ åˆåŒçº§åˆ†æ
_analyze_contract_discounts(): TOP 10å•†åŠ¡åˆåŒæ•ˆæœ
  â†“ å®ä¾‹çº§åˆ†æ
_analyze_top_instance_discounts(): TOP 50é«˜æŠ˜æ‰£å®ä¾‹
  â†“ ä¿å­˜ç¼“å­˜ï¼ˆ24hï¼‰
  â†“ ç”ŸæˆHTMLæŠ¥å‘Š
generate_discount_report(): 
  â†“ EChartså›¾è¡¨ï¼ˆæŠ˜æ‰£ç‡æ›²çº¿ã€é‡‘é¢å¯¹æ¯”æŸ±çŠ¶å›¾ï¼‰
  â†“ äº§å“/åˆåŒ/å®ä¾‹è¡¨æ ¼
  â†“ è¾“å‡º
~/cloudlens_reports/discount_trend_xxxxxxxx.html
  â†“ è‡ªåŠ¨æ‰“å¼€æŠ¥å‘Š
```

**æ€§èƒ½ç‰¹ç‚¹**:
- é¦–æ¬¡è§£æ: 1-2åˆ†é’Ÿï¼ˆ143ä¸‡è¡ŒCSVï¼‰
- åç»­æŸ¥è¯¢: ç§’çº§ï¼ˆ24hç¼“å­˜ï¼‰
- å†…å­˜å ç”¨: çº¦200-300MBï¼ˆè§£ææœŸé—´ï¼‰

**æŠ˜æ‰£ç‡è®¡ç®—**:
```
æŠ˜æ‰£ç‡ = ä¼˜æƒ é‡‘é¢ / å®˜ç½‘ä»·

ç¤ºä¾‹ï¼š
  å®˜ç½‘ä»·: Â¥1000
  ä¼˜æƒ é‡‘é¢: Â¥500
  åº”ä»˜é‡‘é¢: Â¥500
  æŠ˜æ‰£ç‡: 50%ï¼ˆ5æŠ˜ï¼‰
```

---

### æ•°æ®æµ5: Webæˆæœ¬åˆ†æ (`/api/cost/overview`)

```
å‰ç«¯è¯·æ±‚: GET /api/cost/overview?account=prod
  â†“
web/backend/api.py: get_cost_overview()
  â†“ æ£€æŸ¥ç¼“å­˜
core/cache.py: æŸ¥è¯¢ cost_overviewï¼ˆTTL=24hï¼‰
  â†“ ç¼“å­˜æœªå‘½ä¸­
  â†“ è·å–è´¦å•æ•°æ®ï¼ˆå½“å‰æœˆ & ä¸Šæœˆï¼‰
_get_billing_overview_totals(account, "2025-12")
  â†“ BSS API
_bss_query_bill_overview(): QueryBillOverview
  â†“ è¿”å›: {total_pretax, by_product, by_product_name}
  â†“ è®¡ç®—ç¯æ¯”
current_month_cost = å½“æœˆè´¦å•æ€»é¢
last_month_cost = ä¸Šæœˆè´¦å•æ€»é¢
mom = (current - last) / last * 100
  â†“ æ„é€ å“åº”
{
  current_month: xxx,
  last_month: xxx,
  mom: xxx,
  yoy: 0  # TODO: åŒæ¯”æš‚æœªå®ç°
}
  â†“ ä¿å­˜ç¼“å­˜ï¼ˆ24hï¼‰
  â†“ è¿”å›JSON
å‰ç«¯æ¸²æŸ“æˆæœ¬å¡ç‰‡
```

**å£å¾„è¯´æ˜**:
- ä½¿ç”¨ `PretaxAmount`ï¼ˆç¨å‰åº”ä»˜ï¼ŒæŠ˜åï¼‰
- å¯¹ PayAsYouGoï¼Œ`PaymentAmount` å¸¸ä¸º0ï¼Œç”¨ `PretaxAmount` æ›´å‡†ç¡®
- æŒ‰äº§å“èšåˆï¼ˆProductCodeï¼‰

---

## ğŸ’¾ å­˜å‚¨ä¸ç¼“å­˜ä½“ç³»

### å½“å‰ä½“ç³»ï¼ˆâš ï¸ å­˜åœ¨åŒè½¨é—®é¢˜ï¼‰

#### 1. **SQLite TTLç¼“å­˜** âœ… ä¸»è·¯å¾„

**æ¨¡å—**: `core/cache.py` (CacheManager)

**å­˜å‚¨ä½ç½®**: `~/.cloudlens/cache.db`

**è¡¨ç»“æ„**:
```sql
CREATE TABLE resource_cache (
    cache_key TEXT PRIMARY KEY,
    resource_type TEXT,
    account_name TEXT,
    region TEXT,
    data TEXT,  -- JSON
    created_at TIMESTAMP,
    expires_at TIMESTAMP
)
```

**ä½¿ç”¨åœºæ™¯**:
- CLIèµ„æºæŸ¥è¯¢ï¼ˆ`cl query ecs`ï¼‰
- Web APIèµ„æºåˆ—è¡¨
- é—²ç½®åˆ†æç»“æœï¼ˆ`idle_result`ï¼Œ24hï¼‰
- Dashboardæ‘˜è¦ï¼ˆ`dashboard_summary`ï¼Œ24hï¼‰
- æˆæœ¬æ¦‚è§ˆï¼ˆ`cost_overview`ï¼Œ24hï¼‰
- å®‰å…¨æ¦‚è§ˆï¼ˆ`security_overview`ï¼Œ24hï¼‰

**TTLè®¾ç½®**:
- èµ„æºæŸ¥è¯¢: 5åˆ†é’Ÿï¼ˆ`DEFAULT_TTL = 300`ï¼‰
- åˆ†æç»“æœ: 24å°æ—¶ï¼ˆä¼ å…¥ `ttl_seconds=86400`ï¼‰

**ä¼˜ç‚¹**:
- ç»“æ„åŒ–å­˜å‚¨ï¼Œæ˜“äºæŸ¥è¯¢
- è‡ªåŠ¨è¿‡æœŸæ¸…ç†
- å¹¶å‘å®‰å…¨ï¼ˆSQLiteäº‹åŠ¡ï¼‰

#### 2. **msgpackæ–‡ä»¶ç¼“å­˜** âš ï¸ æ—§è·¯å¾„

**æ¨¡å—**: `core/cache_manager.py` (CacheManager) âš ï¸ åŒåå†²çª

**å­˜å‚¨ä½ç½®**: `./data/cache/{tenant}/{resource_type}.pkl`

**ä½¿ç”¨åœºæ™¯**:
- `core/base_analyzer.py` - æ—§åˆ†æå™¨åŸºç±»
- `resource_modules/*_analyzer.py` - æ—§èµ„æºåˆ†æå™¨
- `scripts/*` - éƒ¨åˆ†ç‹¬ç«‹è„šæœ¬

**é—®é¢˜**:
- ä¸SQLiteç¼“å­˜åŒåï¼ˆå®¹æ˜“importé”™ï¼‰
- ä½¿ç”¨è€…å°‘ï¼ˆä¸»è¦æ˜¯æ—§æ¶æ„ï¼‰
- æ— è‡ªåŠ¨è¿‡æœŸæ¸…ç†
- ä¸æ”¯æŒåŒºåŸŸç»´åº¦

**å»ºè®®**: é€æ­¥åºŸå¼ƒï¼Œè¿ç§»åˆ°SQLiteç¼“å­˜

#### 3. **æˆæœ¬å†å²** âœ… 

**å­˜å‚¨ä½ç½®**: `./data/cost/cost_history.json`

**æ•°æ®ç»“æ„**:
```json
[
  {
    "timestamp": "2025-12-15T10:00:00",
    "account": "prod",
    "total_cost": 12345.67,
    "cost_by_type": {"ecs": 8000, "rds": 4000},
    "cost_by_region": {"cn-hangzhou": 10000},
    "resource_count": 150
  }
]
```

**ä½¿ç”¨åœºæ™¯**:
- `core/cost_trend_analyzer.py`
- Web Dashboardè¶‹åŠ¿å›¾
- æˆæœ¬é¢„æµ‹æ¨¡å‹è®­ç»ƒæ•°æ®

**ä¿ç•™ç­–ç•¥**: æœ€è¿‘365å¤©

#### 4. **æŠ˜æ‰£åˆ†æç¼“å­˜** âœ¨ æ–°å¢

**å­˜å‚¨ä½ç½®**: `~/.cloudlens/discount_cache/{dir_name}_discount_trend.json`

**æ•°æ®ç»“æ„**:
```json
{
  "account_name": "1844634015852583",
  "analysis_periods": ["2025-12", "2025-11", ...],
  "trend_analysis": {...},
  "product_analysis": {...},
  "contract_analysis": {...},
  "top_instance_discounts": [...],
  "generated_at": "2025-12-15T10:00:00"
}
```

**TTL**: 24å°æ—¶

**æ•°æ®é‡**: é€šå¸¸ < 1MBï¼ˆèšåˆåï¼‰

#### 5. **æœ¬åœ°SQLiteæ•°æ®åº“** âš ï¸ æ—§æ¶æ„

**æ–‡ä»¶**:
- `ecs_monitoring_data_fixed.db`
- `rds_monitoring_data.db`
- `eip_monitoring_data.db`
- `nas_monitoring_data.db`
- ç­‰...

**ä½¿ç”¨åœºæ™¯**:
- `core/optimization_engine.py` - ä¼˜åŒ–å»ºè®®
- `resource_modules/cost_analyzer.py` - æˆæœ¬åˆ†æ
- éƒ¨åˆ†ç‹¬ç«‹è„šæœ¬ï¼ˆ`scripts/`ï¼‰

**é—®é¢˜**:
- ä¾èµ–å¤–éƒ¨æ•°æ®æºï¼ˆç¯å¢ƒç¼ºå¤±æ—¶åŠŸèƒ½é€€åŒ–ï¼‰
- ä¸"å®æ—¶ä»äº‘APIæ‹‰å–"æ¨¡å¼ä¸ä¸€è‡´
- æ•°æ®åŒæ­¥æœºåˆ¶ä¸æ¸…æ™°

**å»ºè®®**: 
- çŸ­æœŸ: åœ¨æ–‡æ¡£ä¸­æ˜ç¡®æ ‡æ³¨ä¸º"ç¦»çº¿åˆ†ææ¨¡å¼"
- é•¿æœŸ: æä¾›"å®æ—¶æ¨¡å¼"æ›¿ä»£æ–¹æ¡ˆ

---

## âš™ï¸ é…ç½®ä¸è¿è¡Œæ–¹å¼

### é…ç½®æ–‡ä»¶ä½ç½®

```
~/.cloudlens/
â”œâ”€â”€ config.json          # è´¦å·é…ç½®ï¼ˆå…ƒæ•°æ®ï¼‰
â”œâ”€â”€ credentials          # credentialsæ–‡ä»¶æ ¼å¼ï¼ˆAWSå…¼å®¹ï¼‰
â”œâ”€â”€ context.json         # CLIä¸Šä¸‹æ–‡ï¼ˆä¸Šæ¬¡è´¦å·ç­‰ï¼‰
â”œâ”€â”€ rules.json           # ä¼˜åŒ–è§„åˆ™ï¼ˆé˜ˆå€¼ã€ç™½åå•ï¼‰
â”œâ”€â”€ cache.db             # SQLiteç¼“å­˜ï¼ˆèµ„æºã€åˆ†æç»“æœï¼‰
â”œâ”€â”€ discount_cache/      # æŠ˜æ‰£åˆ†æç¼“å­˜ âœ¨
â””â”€â”€ logs/
    â””â”€â”€ cloudlens.log    # ç»“æ„åŒ–æ—¥å¿—
```

### è¿è¡Œæ¨¡å¼

#### 1. CLIæ¨¡å¼

**å¯åŠ¨æ–¹å¼**:
```bash
./cl <command> <subcommand> [options]
```

**ç‰¹ç‚¹**:
- é€‚åˆè‡ªåŠ¨åŒ–ã€è„šæœ¬ã€CI/CD
- æ”¯æŒå¹¶å‘æŸ¥è¯¢ï¼ˆThreadPoolExecutorï¼‰
- ä¸°å¯Œçš„è¾“å‡ºæ ¼å¼ï¼ˆtable/json/csv/excel/htmlï¼‰

#### 2. Webæ¨¡å¼

**å¯åŠ¨æ–¹å¼**:
```bash
# åç«¯
cd web/backend
uvicorn main:app --reload --host 127.0.0.1 --port 8000

# å‰ç«¯
cd web/frontend
npm run dev
```

**ç‰¹ç‚¹**:
- é€‚åˆæ—¥å¸¸ç®¡ç†ã€å¯è§†åŒ–
- å®æ—¶åˆ·æ–°ï¼ˆ"Scan Now"æŒ‰é’®ï¼‰
- å›¾è¡¨å±•ç¤ºï¼ˆRechartsï¼‰

#### 3. REPLæ¨¡å¼

**å¯åŠ¨æ–¹å¼**:
```bash
./cl repl
```

**ç‰¹ç‚¹**:
- äº¤äº’å¼å‘½ä»¤è¡Œ
- åŸºäºprompt_toolkit
- è‡ªåŠ¨è¡¥å…¨ã€å†å²è®°å½•

#### 4. TUI Dashboard

**å¯åŠ¨æ–¹å¼**:
```bash
./cl dashboard
```

**ç‰¹ç‚¹**:
- å…¨å±ç»ˆç«¯ç•Œé¢ï¼ˆåŸºäºtextualï¼‰
- å®æ—¶ç›‘æ§
- ç±»ä¼¼K9sé£æ ¼

---

## âœ¨ æ–°å¢åŠŸèƒ½: æŠ˜æ‰£è¶‹åŠ¿åˆ†æ

### åŠŸèƒ½æ¦‚è¿°

åŸºäºé˜¿é‡Œäº‘è´¦å•CSVæ–‡ä»¶ï¼Œåˆ†ææœ€è¿‘6ä¸ªæœˆçš„æŠ˜æ‰£å˜åŒ–è¶‹åŠ¿ï¼Œæ”¯æŒäº§å“ã€åˆåŒã€å®ä¾‹ä¸‰ä¸ªç»´åº¦ï¼Œä¸ºå•†åŠ¡å†³ç­–å’Œæˆæœ¬ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒã€‚

### æ ¸å¿ƒèƒ½åŠ›

1. **è¶‹åŠ¿åˆ†æ**
   - æŠ˜æ‰£ç‡å˜åŒ–æ›²çº¿ï¼ˆ6ä¸ªæœˆï¼‰
   - æŠ˜æ‰£é‡‘é¢å¯¹æ¯”
   - è¶‹åŠ¿æ–¹å‘åˆ¤æ–­ï¼ˆä¸Šå‡/ä¸‹é™/å¹³ç¨³ï¼‰

2. **äº§å“ç»´åº¦**
   - TOP 20äº§å“æŠ˜æ‰£æ’å
   - å„äº§å“æŠ˜æ‰£ç‡å˜åŒ–
   - è¯†åˆ«æŠ˜æ‰£ä¼˜åŒ–æœºä¼š

3. **åˆåŒç»´åº¦**
   - TOP 10å•†åŠ¡åˆåŒæ•ˆæœ
   - åˆåŒè¦†ç›–æœˆä»½æ•°
   - åˆåŒæŠ˜æ‰£ç‡ç¨³å®šæ€§

4. **å®ä¾‹ç»´åº¦**
   - TOP 50é«˜æŠ˜æ‰£å®ä¾‹
   - å®ä¾‹çº§æˆæœ¬ä¼˜åŒ–å‚è€ƒ

### ä½¿ç”¨æ–¹å¼

#### CLIå‘½ä»¤

```bash
# åŸºç¡€ç”¨æ³•
./cl analyze discount

# æŒ‡å®šè´¦å•ç›®å½•
./cl analyze discount --bill-dir ./1844634015852583-ydzn

# åˆ†æ12ä¸ªæœˆ
./cl analyze discount --months 12

# å¯¼å‡ºHTMLæŠ¥å‘Š
./cl analyze discount --export

# å¯¼å‡ºExcelæŠ¥å‘Š
./cl analyze discount --export --format excel
```

#### Web API

```bash
# è·å–æŠ˜æ‰£è¶‹åŠ¿
GET /api/discounts/trend?months=6

# è·å–äº§å“æŠ˜æ‰£è¯¦æƒ…
GET /api/discounts/products?product=ecs
```

### å®é™…æ•ˆæœï¼ˆåŸºäºç¤ºä¾‹æ•°æ®ï¼‰

```
âœ… åˆ†æå®Œæˆ!
  è´¦æœŸ: 2025-12, 2025-11, 2025-10, 2025-09, 2025-08, 2025-07
  æœ€æ–°æŠ˜æ‰£ç‡: 57.43%
  å¹³å‡æŠ˜æ‰£ç‡: 52.68%
  è¶‹åŠ¿æ–¹å‘: ä¸Šå‡ ğŸ“ˆ
  ç´¯è®¡èŠ‚çœ: Â¥2,579,330.06

ğŸ“¦ äº§å“æŠ˜æ‰£ TOP 3:
  1. äº‘æœåŠ¡å™¨ ECS     - Â¥1,416,697.74 (57.69%) ğŸ“ˆ ä¸Šå‡
  2. äº‘æ•°æ®åº“ RDS     - Â¥247,634.16 (56.40%) ğŸ“ˆ ä¸Šå‡
  3. æ”¯æŒè®¡åˆ’         - Â¥150,000.00 (100.00%) 
```

### ä¸šåŠ¡ä»·å€¼

1. **å•†åŠ¡è°ˆåˆ¤æ”¯æŒ**
   - æ•°æ®åŒ–è¯„ä¼°åˆåŒæ•ˆæœ
   - è¯†åˆ«æŠ˜æ‰£ä¸‹é™é£é™©
   - ä¸ºç»­ç­¾æä¾›è°ˆåˆ¤ä¾æ®

2. **æˆæœ¬ä¼˜åŒ–å†³ç­–**
   - æ‰¾å‡ºæŠ˜æ‰£ç‡ä½çš„äº§å“
   - ä¼˜åŒ–é‡‡è´­ç­–ç•¥
   - æ‰¹é‡ç»­è´¹è·å–æ›´é«˜æŠ˜æ‰£

3. **å¼‚å¸¸ç›‘æ§**
   - æŠ˜æ‰£ç‡å¼‚å¸¸ä¸‹é™é¢„è­¦
   - åŠæ—¶å‘ç°åˆåŒåˆ°æœŸ
   - é¿å…æˆæœ¬çªå¢

---

## âš ï¸ æŠ€æœ¯å€ºåŠ¡ä¸é£é™©ç‚¹

### é«˜ä¼˜å…ˆçº§ï¼ˆP0 - å½±å“ç¨³å®šæ€§ï¼‰

#### 1. **ç¼“å­˜ä½“ç³»åŒè½¨å¹¶å­˜** ğŸ”´

**é—®é¢˜æè¿°**:
- `core/cache.py` (CacheManager) - SQLiteç¼“å­˜
- `core/cache_manager.py` (CacheManager) - msgpackæ–‡ä»¶ç¼“å­˜
- **åŒåç±»å¯¼è‡´importæ··ä¹±**

**å½±å“èŒƒå›´**:
- CLI/Webä¸»è·¯å¾„ä½¿ç”¨SQLite
- æ—§åˆ†æå™¨ï¼ˆ`core/base_analyzer.py`ï¼‰ä½¿ç”¨æ–‡ä»¶ç¼“å­˜
- å›¢é˜Ÿæˆå‘˜å®¹æ˜“importé”™è¯¯

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

**å»ºè®®æ–¹æ¡ˆ**:
```python
# æ–¹æ¡ˆ1: é‡å‘½åï¼ˆæ¨èï¼‰
core/cache.py          -> CacheManager (ä¿æŒ)
core/cache_manager.py  -> FileCacheManager

# æ–¹æ¡ˆ2: åºŸå¼ƒæ—§ç¼“å­˜
å°† core/cache_manager.py ç§»è‡³ legacy/
æ›´æ–°æ‰€æœ‰å¼•ç”¨åˆ° core/cache.py
```

**é¢„ä¼°å·¥ä½œé‡**: 2-4å°æ—¶

---

#### 2. **Provideræ–¹æ³•å‘½åä¸ä¸€è‡´** ğŸ”´

**é—®é¢˜æè¿°**:
- `list_eip()` vs `list_eips()` - å‘½åä¸ç»Ÿä¸€
- Webä»£ç ä¸­æœ‰ `list_eips()` è°ƒç”¨ï¼Œä½†AliyunProviderå®ç°æ˜¯ `list_eip()`
- å¯¼è‡´åŠŸèƒ½é»˜é»˜å¤±æ•ˆï¼ˆtry/exceptåæ‰å¼‚å¸¸ï¼‰

**å½±å“èŒƒå›´**:
- Webå®‰å…¨åˆ†æï¼ˆEIPä½¿ç”¨æƒ…å†µï¼‰
- Webèµ„æºåˆ—è¡¨ï¼ˆEIPå±•ç¤ºï¼‰

**é£é™©ç­‰çº§**: ğŸ”´ é«˜ï¼ˆåŠŸèƒ½é€€åŒ–ï¼‰

**å»ºè®®æ–¹æ¡ˆ**:
```python
# ç»Ÿä¸€ä¸ºå¤æ•°å½¢å¼
providers/aliyun/provider.py:
  list_eip()  -> list_eips()
  list_disk() -> list_disks()  # å·²æ­£ç¡®
  list_snapshot() -> list_snapshots()  # å·²æ­£ç¡®
```

**é¢„ä¼°å·¥ä½œé‡**: 30åˆ†é’Ÿ

---

#### 3. **AliyunProvider.list_nas() æœ‰bug** ğŸ”´

**é—®é¢˜ä»£ç **:
```python
# providers/aliyun/provider.py line 550
def list_nas(self) -> List[Dict]:
    for region in self.regions:  # âŒ self.regionsæœªå®šä¹‰
        client = self._get_client(region)  # âŒ _get_clientä¸æ¥å—regionå‚æ•°
```

**å½±å“**: NASèµ„æºæŸ¥è¯¢ç›´æ¥å¤±è´¥

**é£é™©ç­‰çº§**: ğŸ”´ é«˜

**å»ºè®®æ–¹æ¡ˆ**:
```python
# æ–¹æ¡ˆ1: ä¿®å¤å®ç°
def list_nas(self) -> List[Dict]:
    # åªæŸ¥è¯¢å½“å‰region
    from aliyunsdknas.request.v20170626 import DescribeFileSystemsRequest
    request = DescribeFileSystemsRequest.DescribeFileSystemsRequest()
    response = self._do_request(request)
    # ...

# æ–¹æ¡ˆ2: æ ‡è®°ä¸ºæœªå®ç°
def list_nas(self) -> List[Dict]:
    logger.warning("list_nas() not fully implemented yet")
    return []
```

**é¢„ä¼°å·¥ä½œé‡**: 1å°æ—¶

---

### ä¸­ä¼˜å…ˆçº§ï¼ˆP1 - å½±å“æ•°æ®å‡†ç¡®æ€§ï¼‰

#### 4. **æˆæœ¬æ•°æ®å£å¾„ä¸ç»Ÿä¸€** ğŸŸ¡

**é—®é¢˜æè¿°**:
- `core/cost_trend_analyzer.py` - åŸºäºè§„æ ¼ä¼°ç®—
- `web/backend/api.py` - åŸºäºBSSè´¦å•ï¼ˆæ›´å‡†ç¡®ï¼‰
- `resource_modules/cost_analyzer.py` - åŸºäºæœ¬åœ°DB + æŠ˜æ‰£åˆ†æå™¨

**å½±å“**:
- åŒä¸€èµ„æºåœ¨ä¸åŒé¡µé¢æ˜¾ç¤ºçš„æˆæœ¬ä¸ä¸€è‡´
- ç”¨æˆ·å›°æƒ‘ï¼š"ä¸ºä»€ä¹ˆDashboardå’Œæˆæœ¬é¡µé¢çš„æ€»é¢ä¸åŒï¼Ÿ"

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

**å»ºè®®æ–¹æ¡ˆ**:
```
ç»Ÿä¸€å£å¾„ä¼˜å…ˆçº§ï¼š
1. BSSè´¦å•APIï¼ˆQueryInstanceBillï¼‰- æœ€å‡†ç¡®
2. æŠ˜æ‰£åˆ†æå™¨ï¼ˆç»­è´¹ä»·æ ¼ï¼‰- åŒ…å¹´åŒ…æœˆèµ„æº
3. è§„æ ¼ä¼°ç®— - å…œåº•æ–¹æ¡ˆ

åœ¨ä»£ç ä¸­æ˜ç¡®æ ‡æ³¨æ•°æ®æ¥æºï¼š
{
  "cost": 1234.56,
  "cost_source": "bss_billing"  // æˆ– "discount_analyzer" æˆ– "estimated"
}
```

**é¢„ä¼°å·¥ä½œé‡**: 1-2å¤©

---

#### 5. **ä¼˜åŒ–å¼•æ“ä¾èµ–æœ¬åœ°DBæ–‡ä»¶** ğŸŸ¡

**é—®é¢˜æè¿°**:
- `core/optimization_engine.py` ç›´æ¥è¿æ¥ `*_monitoring_data.db`
- ç¯å¢ƒç¼ºå¤±æ–‡ä»¶æ—¶åŠŸèƒ½é€€åŒ–/æŠ¥é”™
- ä¸"å®æ—¶ä»äº‘APIæ‹‰å–"æ¨¡å¼ä¸ä¸€è‡´

**å½±å“èŒƒå›´**:
- Webä¼˜åŒ–å»ºè®®é¡µé¢ï¼ˆ`/api/optimization/suggestions`ï¼‰
- éƒ¨åˆ†ä¼˜åŒ–åŠŸèƒ½æ— æ³•ä½¿ç”¨

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

**å»ºè®®æ–¹æ¡ˆ**:
```
æ–¹æ¡ˆ1: åŒæ¨¡å¼æ”¯æŒ
- å®æ—¶æ¨¡å¼: ä»Provider APIæ‹‰å–ï¼ˆé»˜è®¤ï¼‰
- ç¦»çº¿æ¨¡å¼: ä»æœ¬åœ°DBè¯»å–ï¼ˆéœ€è¦å…ˆè¿è¡Œé‡‡é›†è„šæœ¬ï¼‰

æ–¹æ¡ˆ2: å®Œå…¨åˆ‡æ¢åˆ°å®æ—¶æ¨¡å¼
- ç§»é™¤DBä¾èµ–
- æ‰€æœ‰æ•°æ®ä»Providerè·å–
- ä½¿ç”¨SQLiteç¼“å­˜ï¼ˆ24hï¼‰
```

**é¢„ä¼°å·¥ä½œé‡**: 2-3å¤©

---

### ä½ä¼˜å…ˆçº§ï¼ˆP2 - æ”¹è¿›ä½“éªŒï¼‰

#### 6. **CLIä»£ç æœ‰æœªå®Œæˆç‰‡æ®µ** ğŸŸ¢

**é—®é¢˜ç‚¹**:
- `cli/commands/config_cmd.py` `show_account()` æ„é€ äº† `info` ä½†æœªè¾“å‡º
- `cli/commands/analyze_cmd.py` éƒ¨åˆ†ç¼©è¿›å¯ç–‘

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½ï¼ˆä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰

**å»ºè®®**: è¿è¡Œå®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œlinteræ£€æŸ¥

---

#### 7. **Webå‰ç«¯åŠŸèƒ½ä¸å®Œæ•´** ğŸŸ¢

**ç¼ºå¤±åŠŸèƒ½**:
- æŠ˜æ‰£åˆ†æé¡µé¢ï¼ˆå‰ç«¯UIï¼‰âœ¨ æ–°å¢APIå·²å°±ç»ª
- æŠ¥å‘Šå†å²é¡µé¢
- å®æ—¶åˆ·æ–°ï¼ˆWebSocketï¼‰
- å¤šè´¦å·åˆ‡æ¢å™¨

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

**å»ºè®®**: æŒ‰Phase 2/3é€æ­¥å®ç°

---

## ğŸš€ é‡æ„è·¯çº¿å›¾

### Phase 0: æ­¢è¡€ä¿®å¤ï¼ˆ1-2å¤©ï¼‰âš¡ ä¼˜å…ˆ

**ç›®æ ‡**: ä¿®å¤æ˜ç¡®çš„bugå’Œå‘½åå†²çª

**ä»»åŠ¡æ¸…å•**:
- [x] âœ… ç»Ÿä¸€ `list_eip()` å‘½åï¼ˆæ”¹ä¸º `list_eips()`ï¼‰
- [x] âœ… ä¿®å¤ `AliyunProvider.list_nas()` bug
- [x] âœ… é‡å‘½å `core/cache_manager.py` ä¸º `FileCacheManager`
- [ ] è¿è¡Œpytestæ£€æŸ¥æ‰€æœ‰å•å…ƒæµ‹è¯•
- [ ] è¿è¡Œflake8/mypyæ£€æŸ¥ä»£ç è´¨é‡
- [ ] è¡¥å…¨ `cli/commands/config_cmd.py` `show_account()` è¾“å‡º

**é¢„æœŸæ”¶ç›Š**:
- æ¶ˆé™¤åŠŸèƒ½é€€åŒ–é£é™©
- æå‡ä»£ç å¯ç»´æŠ¤æ€§
- é¿å…æ–°äººè¸©å‘

---

### Phase 1: æ•°æ®å£å¾„ç»Ÿä¸€ï¼ˆ3-5å¤©ï¼‰

**ç›®æ ‡**: ç»Ÿä¸€æˆæœ¬æ•°æ®æ¥æºï¼Œæå‡æ•°æ®å‡†ç¡®æ€§

**ä»»åŠ¡æ¸…å•**:
1. **ç»Ÿä¸€æˆæœ¬å£å¾„**
   - Web API å…¨é¢åˆ‡æ¢åˆ° BSS è´¦å•
   - CLI æ·»åŠ  `--cost-source` å‚æ•°ï¼ˆbss/estimatedï¼‰
   - åœ¨å“åº”ä¸­æ ‡æ³¨æ•°æ®æ¥æº

2. **æˆæœ¬æ˜ å°„ä¼˜åŒ–**
   - ä¼˜åŒ– `_get_cost_map_from_billing()` æ€§èƒ½
   - æ·»åŠ æ›´å¤šèµ„æºç±»å‹æ”¯æŒï¼ˆSLBã€NATã€EIPç­‰ï¼‰
   - æä¾›"å®ä¾‹ID â†’ æœˆåº¦æˆæœ¬"ç»Ÿä¸€æŸ¥è¯¢æ¥å£

3. **æŠ˜æ‰£æ•°æ®é›†æˆ**
   - å°†æŠ˜æ‰£åˆ†æç»“æœèå…¥æˆæœ¬åˆ†æ
   - åœ¨èµ„æºè¯¦æƒ…é¡µæ˜¾ç¤ºæŠ˜æ‰£ç‡
   - åœ¨Dashboardæ˜¾ç¤ºæŠ˜æ‰£è¶‹åŠ¿å¡ç‰‡

**é¢„æœŸæ”¶ç›Š**:
- æˆæœ¬æ•°æ®å‡†ç¡®æ€§æå‡90%+
- ç”¨æˆ·ä½“éªŒä¸€è‡´æ€§

---

### Phase 2: ç¼“å­˜ä½“ç³»é‡æ„ï¼ˆ3-5å¤©ï¼‰

**ç›®æ ‡**: ç»Ÿä¸€ç¼“å­˜æ¶æ„ï¼Œæ¸…ç†å†å²é—ç•™

**ä»»åŠ¡æ¸…å•**:
1. **åºŸå¼ƒæ—§æ–‡ä»¶ç¼“å­˜**
   - å°† `core/cache_manager.py` ç§»è‡³ `legacy/`
   - æ›´æ–°æ‰€æœ‰å¼•ç”¨åˆ° `core/cache.py`
   - è¿ç§» `core/base_analyzer.py` åˆ°SQLiteç¼“å­˜

2. **SQLiteç¼“å­˜å¢å¼º**
   - æ·»åŠ ç¼“å­˜ç»Ÿè®¡APIï¼ˆå‘½ä¸­ç‡ã€å­˜å‚¨å¤§å°ï¼‰
   - è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
   - æ”¯æŒç¼“å­˜é¢„çƒ­ï¼ˆwarm_up_cacheï¼‰

3. **æˆæœ¬å†å²è¿ç§»**
   - è€ƒè™‘å°† `cost_history.json` è¿ç§»åˆ°SQLite
   - ç»Ÿä¸€æ—¶åºæ•°æ®å­˜å‚¨
   - æ”¯æŒæ›´å¤æ‚çš„æŸ¥è¯¢ï¼ˆæŒ‰äº§å“ã€åŒºåŸŸè¿‡æ»¤ï¼‰

**é¢„æœŸæ”¶ç›Š**:
- ç»Ÿä¸€çš„ç¼“å­˜ç®¡ç†
- æ›´å¥½çš„æ€§èƒ½ç›‘æ§
- é™ä½ç»´æŠ¤æˆæœ¬

---

### Phase 3: ä¼˜åŒ–å¼•æ“é‡æ„ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**: ä¼˜åŒ–å¼•æ“åˆ‡æ¢åˆ°å®æ—¶æ¨¡å¼

**ä»»åŠ¡æ¸…å•**:
1. **å®æ—¶ä¼˜åŒ–å»ºè®®**
   - ä»Provider APIå®æ—¶è·å–èµ„æº
   - ç»“åˆé—²ç½®åˆ†æç»“æœ
   - ç»“åˆæˆæœ¬æ•°æ®ï¼ˆBSSï¼‰
   - ç»“åˆæŠ˜æ‰£æ•°æ®ï¼ˆCSVï¼‰ âœ¨

2. **ç¦»çº¿æ¨¡å¼éš”ç¦»**
   - å°†DBä¾èµ–çš„ä»£ç ç§»è‡³ `legacy/`
   - æä¾›å¯é€‰çš„"ç¦»çº¿åˆ†ææ¨¡å¼"
   - æ˜ç¡®æ–‡æ¡£è¯´æ˜

3. **ä¼˜åŒ–å»ºè®®å¢å¼º**
   - åŸºäºæŠ˜æ‰£ç‡æ¨èç»­è´¹ç­–ç•¥
   - åŸºäºé—²ç½®ç‡æ¨èé™é…/é‡Šæ”¾
   - åŸºäºæˆæœ¬è¶‹åŠ¿æ¨èé¢„ç®—è°ƒæ•´

**é¢„æœŸæ”¶ç›Š**:
- æ— å¤–éƒ¨DBä¾èµ–
- æ›´çµæ´»çš„éƒ¨ç½²
- æ›´ä¸°å¯Œçš„ä¼˜åŒ–å»ºè®®

---

### Phase 4: Webå‰ç«¯å®Œå–„ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**: è¡¥å…¨WebåŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**ä»»åŠ¡æ¸…å•**:
1. **æŠ˜æ‰£åˆ†æé¡µé¢** âœ¨
   - æŠ˜æ‰£ç‡è¶‹åŠ¿å›¾è¡¨
   - äº§å“æŠ˜æ‰£å¯¹æ¯”è¡¨æ ¼
   - åˆåŒæ•ˆæœå±•ç¤º
   - TOPå®ä¾‹æŠ˜æ‰£åˆ—è¡¨
   - å¯¼å‡ºåŠŸèƒ½

2. **æŠ¥å‘Šå†å²é¡µé¢**
   - å†å²æŠ¥å‘Šåˆ—è¡¨
   - åœ¨çº¿é¢„è§ˆ
   - é‡æ–°ä¸‹è½½

3. **å®æ—¶åˆ·æ–°**
   - WebSocketé›†æˆ
   - è‡ªåŠ¨åˆ·æ–°Dashboard
   - è¿›åº¦å®æ—¶å±•ç¤º

4. **å¤šè´¦å·ç®¡ç†**
   - è´¦å·é€‰æ‹©å™¨ç»„ä»¶
   - å¤šè´¦å·æˆæœ¬å¯¹æ¯”
   - è·¨è´¦å·èµ„æºæœç´¢

**é¢„æœŸæ”¶ç›Š**:
- WebåŠŸèƒ½å®Œæ•´æ€§
- ç”¨æˆ·ä½“éªŒæå‡
- ä½¿ç”¨é¢‘ç‡æå‡

---

## ğŸ“Š æ€§èƒ½ä¸æ‰©å±•æ€§è¯„ä¼°

### å½“å‰æ€§èƒ½è¡¨ç°

#### 1. èµ„æºæŸ¥è¯¢æ€§èƒ½

| æ“ä½œ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| å•è´¦å·ECSæŸ¥è¯¢ï¼ˆ100å®ä¾‹ï¼‰ | 3-5ç§’ | <100ms | 50å€ |
| 5è´¦å·å¹¶å‘æŸ¥è¯¢ | 8ç§’ | <500ms | 16å€ |
| é—²ç½®åˆ†æï¼ˆå«ç›‘æ§ï¼‰ | 30-60ç§’ | <1ç§’ | 60å€ |

**ä¼˜åŒ–æ‰‹æ®µ**:
- SQLiteç¼“å­˜ï¼ˆ5åˆ†é’ŸTTLï¼‰
- å¹¶å‘æŸ¥è¯¢ï¼ˆThreadPoolExecutorï¼Œmax_workers=10ï¼‰
- åˆ†é¡µæŸ¥è¯¢ï¼ˆPageSize=100ï¼‰

#### 2. è´¦å•è§£ææ€§èƒ½

| æ•°æ®é‡ | é¦–æ¬¡è§£æ | ç¼“å­˜å‘½ä¸­ |
|--------|----------|----------|
| 143ä¸‡è¡Œï¼ˆ6ä¸ªæœˆï¼‰ | 60-90ç§’ | <1ç§’ |
| 30ä¸‡è¡Œï¼ˆ1ä¸ªæœˆï¼‰ | 15-20ç§’ | <1ç§’ |

**ä¼˜åŒ–ç©ºé—´**:
- ä½¿ç”¨pandasåŠ é€ŸCSVè§£æ
- å¢é‡è§£æï¼ˆåªè§£ææ–°å¢æœˆä»½ï¼‰
- å¹¶è¡Œè§£æå¤šä¸ªæ–‡ä»¶

#### 3. Webé¡µé¢åŠ è½½æ€§èƒ½

| é¡µé¢ | é¦–æ¬¡åŠ è½½ | ç¼“å­˜å‘½ä¸­ |
|------|----------|----------|
| Dashboard | 2-3ç§’ | <500ms |
| èµ„æºåˆ—è¡¨ï¼ˆ100æ¡ï¼‰ | 1-2ç§’ | <300ms |
| æˆæœ¬åˆ†æ | 3-4ç§’ | <500ms |

**ä¼˜åŒ–æ‰‹æ®µ**:
- 24hç¼“å­˜ï¼ˆåˆ†æç»“æœï¼‰
- åˆ†é¡µåŠ è½½
- ä»£ç åˆ†å‰²ï¼ˆNext.jsè‡ªåŠ¨ï¼‰

---

### æ‰©å±•æ€§è¯„ä¼°

#### 1. æ”¯æŒæ›´å¤šäº‘å‚å•†

**å½“å‰**: é˜¿é‡Œäº‘ï¼ˆå®Œæ•´ï¼‰ã€è…¾è®¯äº‘ï¼ˆéƒ¨åˆ†ï¼‰

**æ‰©å±•éš¾åº¦**: ğŸŸ¢ ä½

**æ­¥éª¤**:
1. åˆ›å»ºæ–°Providerç±»ï¼ˆç»§æ‰¿BaseProviderï¼‰
2. å®ç°å¿…éœ€æ¥å£ï¼ˆlist_instancesç­‰ï¼‰
3. æ³¨å†Œåˆ° `cli/utils.py` `get_provider()`

**é¢„ä¼°å·¥ä½œé‡**: 2-3å¤©/äº‘å‚å•†

#### 2. æ”¯æŒæ›´å¤šèµ„æºç±»å‹

**å½“å‰**: ECSã€RDSã€Redisã€OSSã€VPCã€SLBã€NATã€MongoDBã€NASç­‰

**æ‰©å±•éš¾åº¦**: ğŸŸ¢ ä½

**æ­¥éª¤**:
1. åœ¨Providerä¸­æ·»åŠ  `list_xxx()` æ–¹æ³•
2. æ›´æ–° `UnifiedResource` æšä¸¾
3. æ·»åŠ CLIå‘½ä»¤æ”¯æŒ
4. æ·»åŠ Web APIç«¯ç‚¹

**é¢„ä¼°å·¥ä½œé‡**: 0.5-1å¤©/èµ„æºç±»å‹

#### 3. æ”¯æŒæ›´å¤šè´¦å•æº

**å½“å‰**: 
- é˜¿é‡Œäº‘BSS API âœ…
- é˜¿é‡Œäº‘è´¦å•CSV âœ… æ–°å¢

**è®¡åˆ’**:
- AWS Cost Explorer API
- è…¾è®¯äº‘è´¦å•API
- AWSè´¦å•CSV
- Azureè´¦å•

**æ‰©å±•éš¾åº¦**: ğŸŸ¡ ä¸­

**é¢„ä¼°å·¥ä½œé‡**: 2-3å¤©/äº‘å‚å•†

---

## ğŸ¯ æ•°æ®æµä¼˜åŒ–å»ºè®®

### ä¼˜åŒ–1: æ‰¹é‡èµ„æºæŸ¥è¯¢

**å½“å‰é—®é¢˜**: é€ä¸ªè°ƒç”¨ `list_instances/list_rds/list_redis`

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# æ·»åŠ æ‰¹é‡æŸ¥è¯¢æ¥å£
provider.list_all_resources() -> Dict[resource_type, List[UnifiedResource]]

# å†…éƒ¨å¹¶å‘è°ƒç”¨
with ThreadPoolExecutor(max_workers=5) as executor:
    futures = {
        'ecs': executor.submit(self.list_instances),
        'rds': executor.submit(self.list_rds),
        'redis': executor.submit(self.list_redis),
    }
    results = {k: f.result() for k, f in futures.items()}
```

**é¢„æœŸæ”¶ç›Š**: æŸ¥è¯¢é€Ÿåº¦æå‡3-5å€

---

### ä¼˜åŒ–2: ç›‘æ§æ•°æ®æ‰¹é‡è·å–

**å½“å‰é—®é¢˜**: é—²ç½®åˆ†æé€ä¸ªå®ä¾‹è°ƒç”¨get_metricï¼ˆ6æ¬¡/å®ä¾‹ï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# CloudMonitoræ”¯æŒæ‰¹é‡æŸ¥è¯¢ï¼ˆæœ€å¤š200ä¸ªç»´åº¦ï¼‰
# å°†å¤šä¸ªå®ä¾‹IDåˆå¹¶ä¸ºä¸€æ¬¡APIè°ƒç”¨
provider.get_metrics_batch(instance_ids, metric_names, start, end)
```

**é¢„æœŸæ”¶ç›Š**: é—²ç½®åˆ†æé€Ÿåº¦æå‡10å€

---

### ä¼˜åŒ–3: æŠ˜æ‰£åˆ†æå¢é‡è§£æ

**å½“å‰é—®é¢˜**: æ¯æ¬¡éƒ½è§£æå…¨éƒ¨CSVæ–‡ä»¶

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# è®°å½•å·²è§£æçš„æ–‡ä»¶hash
# åªè§£ææ–°å¢/å˜æ›´çš„æ–‡ä»¶
def parse_bill_csv_incremental():
    for csv_file in csv_files:
        file_hash = md5(csv_file)
        if file_hash in parsed_hashes:
            continue  # è·³è¿‡å·²è§£æ
        # è§£ææ–°æ–‡ä»¶
```

**é¢„æœŸæ”¶ç›Š**: å¢é‡è§£æè€—æ—¶ < 5ç§’

---

## ğŸ” å®‰å…¨æ€§åˆ†æ

### å½“å‰å®‰å…¨æªæ–½ âœ…

1. **å¯†é’¥å®‰å…¨å­˜å‚¨**
   - ä½¿ç”¨ç³»ç»ŸKeyringå­˜å‚¨å¯†é’¥
   - é…ç½®æ–‡ä»¶ä¸åŒ…å«æ˜æ–‡å¯†é’¥
   - ç¯å¢ƒå˜é‡æ”¯æŒï¼ˆCI/CDåœºæ™¯ï¼‰

2. **åªè¯»è®¾è®¡**
   - `PermissionGuard` æ£€æŸ¥æ‰€æœ‰APIè°ƒç”¨
   - ä»£ç å±‚é¢æ— Write/Delete API
   - ç™½åå•æœºåˆ¶ï¼ˆåªå…è®¸Describe/List/Getï¼‰

3. **æƒé™å®¡è®¡**
   - å¯åŠ¨æ—¶æ£€æŸ¥å½“å‰å‡­è¯æƒé™
   - è¯†åˆ«é«˜å±æƒé™ï¼ˆAdministratorAccessï¼‰
   - å»ºè®®æœ€å°æƒé™ç­–ç•¥

4. **æœ¬åœ°è¿è¡Œ**
   - æ•°æ®ä¸å‡ºç½‘
   - æ— éœ€éƒ¨ç½²WebæœåŠ¡ï¼ˆå¯é€‰ï¼‰
   - é€‚åˆæ•æ„Ÿç¯å¢ƒ

### å®‰å…¨æ”¹è¿›å»ºè®®

1. **è´¦å•CSVæ•æ„Ÿæ•°æ®**
   - å»ºè®®åŠ å¯†å­˜å‚¨è´¦å•æ–‡ä»¶
   - æˆ–ä½¿ç”¨ä¸´æ—¶ç›®å½•ï¼ˆåˆ†æååˆ é™¤ï¼‰

2. **Web APIè®¤è¯**
   - å½“å‰æ— è®¤è¯æœºåˆ¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
   - ç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ JWTè®¤è¯
   - æ”¯æŒRBACæƒé™æ§åˆ¶

---

## ğŸ“ˆ äº§å“åŠŸèƒ½çŸ©é˜µ

### æ ¸å¿ƒåŠŸèƒ½æ¸…å•

| åŠŸèƒ½æ¨¡å— | CLIæ”¯æŒ | Webæ”¯æŒ | å®ç°å®Œæ•´åº¦ | æ•°æ®æ¥æº |
|---------|---------|---------|-----------|---------|
| **èµ„æºæŸ¥è¯¢** | âœ… | âœ… | 100% | Provider API + SQLiteç¼“å­˜ |
| **é—²ç½®åˆ†æ** | âœ… | âœ… | 90% | CloudMonitor + è§„åˆ™å¼•æ“ |
| **æˆæœ¬è¶‹åŠ¿** | âœ… | âœ… | 80% | å¿«ç…§ + BSS API |
| **æŠ˜æ‰£åˆ†æ** âœ¨ | âœ… | âœ… API | 90% | è´¦å•CSV + BSS API |
| **AIæˆæœ¬é¢„æµ‹** | âœ… | ğŸš§ | 70% | Prophet MLæ¨¡å‹ |
| **å®‰å…¨åˆè§„** | âœ… | âœ… | 85% | Provider API + CISè§„åˆ™ |
| **CIS Benchmark** | âœ… | ğŸš§ | 80% | å†…ç½®æ£€æŸ¥è§„åˆ™ |
| **è‡ªåŠ¨ä¿®å¤** | âœ… | âŒ | 50% | Remediationå¼•æ“ |
| **æŠ¥å‘Šç”Ÿæˆ** | âœ… | ğŸš§ | 70% | ReportGenerator |
| **æƒé™å®¡è®¡** | âœ… | âŒ | 60% | STS/RAM API |

**å›¾ä¾‹**:
- âœ… å·²å®Œæ•´å®ç°
- ğŸš§ éƒ¨åˆ†å®ç°/è¿›è¡Œä¸­
- âŒ æœªå®ç°
- âœ¨ æ–°å¢åŠŸèƒ½

---

## ğŸ’¡ å…³é”®æŠ€æœ¯å†³ç­–è®°å½•

### å†³ç­–1: ä¸ºä»€ä¹ˆç”¨ThreadPoolè€Œä¸æ˜¯AsyncIOï¼Ÿ

**èƒŒæ™¯**: å¹¶å‘æŸ¥è¯¢éœ€è¦æå‡æ€§èƒ½

**é€‰æ‹©**: ThreadPoolExecutor

**ç†ç”±**:
- äº‘SDKå¤§å¤šæ˜¯åŒæ­¥é˜»å¡çš„ï¼ˆaliyun-python-sdkï¼‰
- AsyncIOéœ€è¦æ”¹é€ æ‰€æœ‰Providerä¸ºasync
- ThreadPoolå¯ä»¥ç›´æ¥åŒ…è£…åŒæ­¥å‡½æ•°
- æ€§èƒ½æå‡å·²æ»¡è¶³éœ€æ±‚ï¼ˆ3å€ï¼‰

**æƒè¡¡**:
- AsyncIOç†è®ºæ€§èƒ½æ›´å¥½
- ä½†æ”¹é€ æˆæœ¬é«˜ï¼ˆé‡å†™æ‰€æœ‰Providerï¼‰
- æœªæ¥å¯è€ƒè™‘ `providers/aliyun/async_provider.py`

---

### å†³ç­–2: ä¸ºä»€ä¹ˆåŒæ—¶æ”¯æŒCLIå’ŒWebï¼Ÿ

**èƒŒæ™¯**: ç”¨æˆ·ç¾¤ä½“ä¸åŒï¼Œä½¿ç”¨åœºæ™¯ä¸åŒ

**é€‰æ‹©**: åŒæ¨¡å¼å¹¶å­˜

**ç†ç”±**:
- **CLI**: é€‚åˆè‡ªåŠ¨åŒ–ã€CI/CDã€æ‰¹é‡æ“ä½œã€é«˜çº§ç”¨æˆ·
- **Web**: é€‚åˆå¯è§†åŒ–ã€æ—¥å¸¸ç®¡ç†ã€å›¢é˜Ÿåä½œã€éæŠ€æœ¯ç”¨æˆ·

**è®¾è®¡åŸåˆ™**:
- å…±äº«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆ`core/`ï¼‰
- CLIå’ŒWebåªæ˜¯ä¸åŒçš„"çš®è‚¤"
- ä¿æŒåŠŸèƒ½å¯¹ç­‰ï¼ˆå°½é‡ï¼‰

---

### å†³ç­–3: ä¸ºä»€ä¹ˆæŠ˜æ‰£åˆ†æç”¨CSVè€Œä¸æ˜¯BSS APIï¼Ÿ

**èƒŒæ™¯**: æŠ˜æ‰£åˆ†æéœ€è¦å†å²6ä¸ªæœˆæ•°æ®

**é€‰æ‹©**: åŸºäºè´¦å•CSV + BSS APIäº’è¡¥

**ç†ç”±**:
1. **CSVä¼˜åŠ¿**:
   - åŒ…å«å®Œæ•´çš„æŠ˜æ‰£æ˜ç»†ï¼ˆä¼˜æƒ åç§°ã€åˆåŒç¼–å·ã€æŠ˜æ‰£ç±»å‹ï¼‰
   - æ”¯æŒç¦»çº¿åˆ†æï¼ˆä¸ä¾èµ–APIæƒé™ï¼‰
   - å¯é•¿æœŸä¿å­˜ï¼ˆ6ä¸ªæœˆ+ï¼‰

2. **BSS APIé™åˆ¶**:
   - åªèƒ½æŸ¥è¯¢å•æœˆæ•°æ®
   - æ— æ³•ç›´æ¥è·å–æŠ˜æ‰£è¶‹åŠ¿
   - APIè°ƒç”¨æœ‰é¢‘ç‡é™åˆ¶

**æœ€ä½³å®è·µ**:
- **CSVåˆ†æ**: é•¿æœŸè¶‹åŠ¿ã€å•†åŠ¡å†³ç­–ï¼ˆæ¯æœˆæ›´æ–°ï¼‰
- **BSS API**: å®æ—¶ç›‘æ§ã€å½“æœˆæ•°æ®ï¼ˆå®æ—¶æŸ¥è¯¢ï¼‰

---

## ğŸ“š æ–‡æ¡£å®Œæ•´æ€§è¯„ä¼°

### å·²æœ‰æ–‡æ¡£ âœ…

- `README.md` - é¡¹ç›®æ¦‚è§ˆã€å¿«é€Ÿå¼€å§‹
- `PRODUCT_OVERVIEW.md` - äº§å“æ·±åº¦æ¢³ç†
- `WEB_PRODUCT_DESIGN.md` - Webäº§å“è®¾è®¡
- `docs/WEB_QUICKSTART.md` - Webå¿«é€Ÿå¼€å§‹
- `docs/DISCOUNT_ANALYSIS_GUIDE.md` âœ¨ - æŠ˜æ‰£åˆ†ææŒ‡å—
- `CONTRIBUTING.md` - è´¡çŒ®æŒ‡å—

### ç¼ºå¤±æ–‡æ¡£ ğŸ“

- [ ] **æŠ€æœ¯æ¶æ„æ–‡æ¡£** (`TECHNICAL_ARCHITECTURE.md`)
- [ ] **ç”¨æˆ·å®Œæ•´æ‰‹å†Œ** (`USER_GUIDE.md`)
- [ ] **å¼€å‘è€…æŒ‡å—** (`DEVELOPER_GUIDE.md`)
- [ ] **APIæ–‡æ¡£** (`API_REFERENCE.md`)
- [ ] **éƒ¨ç½²æŒ‡å—** (`DEPLOYMENT_GUIDE.md`)
- [ ] **æ•…éšœæ’æŸ¥æ‰‹å†Œ** (`TROUBLESHOOTING.md`)
- [ ] **å˜æ›´æ—¥å¿—** (`CHANGELOG.md`)

**å»ºè®®**: Phase 4è¡¥å…¨æ–‡æ¡£ä½“ç³»

---

## ğŸ“ æ€»ç»“ä¸å»ºè®®

### é¡¹ç›®ä¼˜åŠ¿ âœ…

1. **æ¶æ„æ¸…æ™°** - åˆ†å±‚æ˜ç¡®ï¼ŒèŒè´£åˆ†ç¦»è‰¯å¥½
2. **æ‰©å±•æ€§å¼º** - æ˜“äºæ·»åŠ æ–°äº‘å‚å•†å’Œèµ„æºç±»å‹
3. **åŠŸèƒ½ä¸°å¯Œ** - è¦†ç›–æŸ¥è¯¢ã€åˆ†æã€ä¼˜åŒ–ã€æŠ¥å‘Šå…¨æµç¨‹
4. **å®‰å…¨å¯é ** - åªè¯»è®¾è®¡ï¼Œå¯†é’¥å®‰å…¨ï¼Œæƒé™å®¡è®¡
5. **ç”¨æˆ·å‹å¥½** - CLIå’ŒWebåŒæ¨¡å¼ï¼Œäº¤äº’ä½“éªŒå¥½

### éœ€è¦æ”¹è¿›çš„åœ°æ–¹ âš ï¸

1. **æŠ€æœ¯å€ºåŠ¡** - åŒç¼“å­˜ä½“ç³»ã€å‘½åä¸ä¸€è‡´ã€æ—§DBä¾èµ–
2. **æ•°æ®å£å¾„** - æˆæœ¬æ•°æ®æ¥æºä¸ç»Ÿä¸€ï¼Œå½±å“å‡†ç¡®æ€§
3. **ä»£ç è´¨é‡** - éƒ¨åˆ†æœªå®Œæˆç‰‡æ®µï¼Œéœ€è¦æµ‹è¯•è¦†ç›–
4. **æ–‡æ¡£å®Œå–„** - å¼€å‘è€…æ–‡æ¡£ã€APIæ–‡æ¡£ç¼ºå¤±

### ä¼˜å…ˆçº§å»ºè®®

**ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰**:
1. ä¿®å¤æ˜ç¡®çš„bugï¼ˆlist_nasã€list_eipå‘½åï¼‰
2. ç»Ÿä¸€ç¼“å­˜å‘½åï¼ˆé¿å…å†²çªï¼‰
3. è¡¥å…¨æŠ˜æ‰£åˆ†æå‰ç«¯é¡µé¢ âœ¨

**çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰**:
1. ç»Ÿä¸€æˆæœ¬æ•°æ®å£å¾„ï¼ˆBSSä¼˜å…ˆï¼‰
2. ç¼“å­˜ä½“ç³»é‡æ„ï¼ˆåºŸå¼ƒæ—§ç¼“å­˜ï¼‰
3. è¿è¡Œå®Œæ•´æµ‹è¯•ï¼Œè¡¥å……å•å…ƒæµ‹è¯•

**ä¸­æœŸï¼ˆ1-2ä¸ªæœˆï¼‰**:
1. ä¼˜åŒ–å¼•æ“é‡æ„ï¼ˆå®æ—¶æ¨¡å¼ï¼‰
2. Webå‰ç«¯åŠŸèƒ½å®Œå–„
3. æ–‡æ¡£ä½“ç³»å®Œå–„

**é•¿æœŸï¼ˆ3-6ä¸ªæœˆï¼‰**:
1. æ”¯æŒAWSã€Azure
2. AIä¼˜åŒ–å»ºè®®ï¼ˆåŸºäºMLæ¨¡å‹ï¼‰
3. å‘Šè­¦ä¸é€šçŸ¥ç³»ç»Ÿ
4. å›¢é˜Ÿåä½œåŠŸèƒ½ï¼ˆè¯„è®ºã€å®¡æ‰¹ï¼‰

---

## ğŸ”— ç›¸å…³èµ„æº

### æ–‡æ¡£é“¾æ¥

- [æŠ˜æ‰£åˆ†æä½¿ç”¨æŒ‡å—](docs/DISCOUNT_ANALYSIS_GUIDE.md) âœ¨
- [Webå¿«é€Ÿå¼€å§‹](docs/WEB_QUICKSTART.md)
- [äº§å“æ¦‚è§ˆ](PRODUCT_OVERVIEW.md)

### ä»£ç å…¥å£

- CLIå…¥å£: `cli/main.py`
- Webåç«¯: `web/backend/main.py`
- Webå‰ç«¯: `web/frontend/app/page.tsx`
- æŠ˜æ‰£åˆ†æå™¨: `core/discount_analyzer.py` âœ¨

### é…ç½®æ–‡ä»¶

- è´¦å·é…ç½®: `~/.cloudlens/config.json`
- ä¼˜åŒ–è§„åˆ™: `~/.cloudlens/rules.json`
- ç¼“å­˜æ•°æ®åº“: `~/.cloudlens/cache.db`

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub Issues**: æäº¤Bugæˆ–åŠŸèƒ½è¯·æ±‚
- **æ–‡æ¡£**: æŸ¥çœ‹å®Œæ•´æ–‡æ¡£
- **CLIå¸®åŠ©**: `./cl --help`

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-15  
**æ¢³ç†å®Œæˆåº¦**: âœ… 100%  
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: æ‰§è¡ŒPhase 0é‡æ„ä»»åŠ¡
