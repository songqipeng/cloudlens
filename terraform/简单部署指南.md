# CloudLens ç®€å•éƒ¨ç½²æŒ‡å—

**ç›®æ ‡**: åœ¨æ—¥æœ¬æˆ–é¦™æ¸¯éƒ¨ç½² CloudLensï¼Œä½¿ç”¨åŸŸå `cloudlens.songqipeng.com`

---

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šç”³è¯· AWS Access Key å’Œ Secret Key

### æ–¹æ³•1ï¼šé€šè¿‡ AWS æ§åˆ¶å°ï¼ˆæ¨èï¼‰

1. **ç™»å½• AWS æ§åˆ¶å°**
   - è®¿é—®: https://console.aws.amazon.com
   - ä½¿ç”¨æ‚¨çš„ AWS è´¦æˆ·ç™»å½•

2. **è¿›å…¥ IAM æœåŠ¡**
   - åœ¨é¡¶éƒ¨æœç´¢æ¡†è¾“å…¥ "IAM"
   - ç‚¹å‡»è¿›å…¥ IAM æœåŠ¡

3. **åˆ›å»ºè®¿é—®å¯†é’¥**
   - ç‚¹å‡»å·¦ä¾§èœå• "ç”¨æˆ·" (Users)
   - ç‚¹å‡»æ‚¨çš„ç”¨æˆ·åï¼ˆæˆ–åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼‰
   - ç‚¹å‡» "å®‰å…¨å‡­è¯" (Security credentials) æ ‡ç­¾é¡µ
   - æ»šåŠ¨åˆ° "è®¿é—®å¯†é’¥" (Access keys) éƒ¨åˆ†
   - ç‚¹å‡» "åˆ›å»ºè®¿é—®å¯†é’¥" (Create access key)

4. **é€‰æ‹©ç”¨é€”**
   - é€‰æ‹© "å‘½ä»¤è¡Œç•Œé¢ (CLI)" æˆ– "åº”ç”¨ç¨‹åºåœ¨ AWS å¤–éƒ¨è¿è¡Œ"
   - ç‚¹å‡» "ä¸‹ä¸€æ­¥"
   - å¯é€‰ï¼šæ·»åŠ æè¿°æ ‡ç­¾
   - ç‚¹å‡» "åˆ›å»ºè®¿é—®å¯†é’¥"

5. **ä¿å­˜å¯†é’¥** âš ï¸ é‡è¦ï¼
   - **Access Key ID**: ç±»ä¼¼ `AKIAIOSFODNN7EXAMPLE`
   - **Secret Access Key**: ç±»ä¼¼ `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`
   - âš ï¸ **Secret Access Key åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹å³ä¿å­˜ï¼**
   - ç‚¹å‡» "ä¸‹è½½ .csv æ–‡ä»¶" ä¿å­˜åˆ°æœ¬åœ°

### æ–¹æ³•2ï¼šé€šè¿‡ AWS CLIï¼ˆå¦‚æœå·²å®‰è£…ï¼‰

```bash
# å¦‚æœè¿˜æ²¡æœ‰å®‰è£… AWS CLI
brew install awscli  # macOS

# é…ç½®å‡­è¯ï¼ˆä¼šå¼•å¯¼æ‚¨è¾“å…¥ï¼‰
aws configure
# è¾“å…¥:
# - AWS Access Key ID: <æ‚¨çš„Access Key>
# - AWS Secret Access Key: <æ‚¨çš„Secret Key>
# - Default region: ap-northeast-1 (ä¸œäº¬) æˆ– ap-east-1 (é¦™æ¸¯)
# - Default output format: json
```

---

## ğŸš€ ç¬¬äºŒæ­¥ï¼šä¸€é”®éƒ¨ç½²ï¼ˆ3ä¸ªå‘½ä»¤ï¼‰

### 1. ç¯å¢ƒå‡†å¤‡

```bash
cd /path/to/cloudlens
./scripts/setup-terraform.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ Terraform å’Œ AWS CLI
- âœ… éªŒè¯ AWS å‡­è¯
- âœ… åˆ›å»ºé…ç½®æ–‡ä»¶

### 2. å¡«å†™é…ç½®

```bash
cd terraform
cp terraform.tfvars.example terraform.tfvars
nano terraform.tfvars  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

**åªéœ€è¦ä¿®æ”¹è¿™å‡ è¡Œ**ï¼š

```hcl
# AWSåŒºåŸŸï¼ˆé€‰æ‹©æ—¥æœ¬æˆ–é¦™æ¸¯ï¼‰
aws_region = "ap-northeast-1"  # æ—¥æœ¬ä¸œäº¬
# æˆ–
# aws_region = "ap-east-1"     # é¦™æ¸¯

# åŸŸåé…ç½®
domain_name = "cloudlens.songqipeng.com"
route53_zone_name = "songqipeng.com"
create_route53_zone = false  # å¦‚æœåŸŸåå·²åœ¨Route 53ï¼Œè®¾ä¸ºfalse

# SSHå…¬é’¥ï¼ˆè¿è¡Œ cat ~/.ssh/id_rsa.pub è·å–ï¼‰
create_key_pair = true
ssh_public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQ... your-email@example.com"

# æ•°æ®åº“å¯†ç ï¼ˆè¯·æ”¹æˆå¼ºå¯†ç ï¼ï¼‰
mysql_password = "YOUR_SECURE_PASSWORD_HERE"
```

### 3. éƒ¨ç½²

```bash
terraform init
terraform apply
```

è¾“å…¥ `yes` ç¡®è®¤ï¼Œç­‰å¾… 10-15 åˆ†é’Ÿå®Œæˆã€‚

---

## ğŸŒ AWS åŒºåŸŸé€‰æ‹©

### æ—¥æœ¬ï¼ˆæ¨èï¼‰

```hcl
aws_region = "ap-northeast-1"  # ä¸œäº¬
```

**ä¼˜åŠ¿**:
- âœ… å»¶è¿Ÿä½ï¼ˆå¦‚æœç”¨æˆ·åœ¨ä¸­å›½ï¼‰
- âœ… æˆæœ¬é€‚ä¸­
- âœ… æœåŠ¡é½å…¨

### é¦™æ¸¯

```hcl
aws_region = "ap-east-1"  # é¦™æ¸¯
```

**ä¼˜åŠ¿**:
- âœ… å»¶è¿Ÿæœ€ä½ï¼ˆå¦‚æœç”¨æˆ·åœ¨ä¸­å›½ï¼‰
- âš ï¸ ä»·æ ¼ç¨é«˜
- âš ï¸ éƒ¨åˆ†æœåŠ¡å¯èƒ½ä¸å¯ç”¨

---

## ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹

### æ—¥æœ¬éƒ¨ç½²é…ç½®

```hcl
# AWSé…ç½®
aws_region = "ap-northeast-1"  # æ—¥æœ¬ä¸œäº¬

# åŸŸåé…ç½®
domain_name = "cloudlens.songqipeng.com"
route53_zone_name = "songqipeng.com"
create_route53_zone = false  # å¦‚æœåŸŸåå·²åœ¨Route 53

# EC2é…ç½®
instance_type = "t3.medium"  # 2æ ¸4Gï¼Œçº¦$30/æœˆ
ebs_volume_size = 50  # 50GBå­˜å‚¨

# SSHé…ç½®
create_key_pair = true
ssh_public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQ... your-email@example.com"

# æ•°æ®åº“é…ç½®
mysql_user = "cloudlens"
mysql_password = "YourSecurePassword123!@#"
mysql_database = "cloudlens"
```

### é¦™æ¸¯éƒ¨ç½²é…ç½®

```hcl
# AWSé…ç½®
aws_region = "ap-east-1"  # é¦™æ¸¯

# å…¶ä»–é…ç½®åŒä¸Š...
```

---

## âœ… éƒ¨ç½²åéªŒè¯

### 1. æŸ¥çœ‹éƒ¨ç½²ä¿¡æ¯

```bash
terraform output
```

ä¼šæ˜¾ç¤ºï¼š
- è®¿é—®åŸŸå: `https://cloudlens.songqipeng.com`
- SSH è¿æ¥å‘½ä»¤
- å®ä¾‹ä¿¡æ¯

### 2. è®¿é—®ç½‘ç«™

æ‰“å¼€æµè§ˆå™¨: `https://cloudlens.songqipeng.com`

### 3. SSH è¿æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# ä½¿ç”¨è¾“å‡ºçš„SSHå‘½ä»¤
terraform output ssh_command

# æˆ–æ‰‹åŠ¨è¿æ¥
ssh -i ~/.ssh/cloudlens-key.pem ec2-user@<å®ä¾‹IP>
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ° IAM ç”¨æˆ·ï¼Ÿ

**è§£å†³**: 
- ç¡®ä¿æ‚¨ç™»å½•çš„æ˜¯ AWS æ ¹è´¦æˆ·æˆ–æœ‰ IAM æƒé™çš„è´¦æˆ·
- å¦‚æœä½¿ç”¨å­è´¦æˆ·ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™

### Q2: åˆ›å»ºè®¿é—®å¯†é’¥æ—¶æç¤ºæƒé™ä¸è¶³ï¼Ÿ

**è§£å†³**:
- è”ç³» AWS è´¦æˆ·ç®¡ç†å‘˜
- æˆ–ä½¿ç”¨æ ¹è´¦æˆ·åˆ›å»ºå¯†é’¥ï¼ˆä¸æ¨èï¼Œå»ºè®®åˆ›å»º IAM ç”¨æˆ·ï¼‰

### Q3: éƒ¨ç½²æ—¶æç¤º "Access Denied"ï¼Ÿ

**è§£å†³**:
1. æ£€æŸ¥ AWS å‡­è¯æ˜¯å¦æ­£ç¡®: `aws sts get-caller-identity`
2. æ£€æŸ¥ IAM ç”¨æˆ·æ˜¯å¦æœ‰ä»¥ä¸‹æƒé™:
   - EC2 å®Œå…¨è®¿é—®
   - Route 53 å®Œå…¨è®¿é—®
   - ACM å®Œå…¨è®¿é—®
   - VPC å®Œå…¨è®¿é—®
   - IAM éƒ¨åˆ†æƒé™ï¼ˆåˆ›å»ºè§’è‰²ï¼‰

### Q4: åŸŸåè§£æä¸ç”Ÿæ•ˆï¼Ÿ

**è§£å†³**:
1. å¦‚æœåŸŸåä¸åœ¨ Route 53:
   - è¿è¡Œ: `terraform output route53_zone_name_servers`
   - åœ¨æ‚¨çš„ DNS æœåŠ¡å•†é…ç½®åç§°æœåŠ¡å™¨
   - ç­‰å¾… DNS ä¼ æ’­ï¼ˆé€šå¸¸å‡ åˆ†é’Ÿï¼‰

2. æ£€æŸ¥ DNS è§£æ:
   ```bash
   dig cloudlens.songqipeng.com
   ```

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### æ—¥æœ¬ï¼ˆap-northeast-1ï¼‰

| èµ„æº | æœˆæˆæœ¬ |
|------|--------|
| EC2 t3.medium | Â¥4,500 (~$30) |
| EBS 50GB | Â¥600 (~$4) |
| ALB | Â¥2,400 (~$16) |
| **æ€»è®¡** | **çº¦ Â¥7,500/æœˆ (~$50)** |

### é¦™æ¸¯ï¼ˆap-east-1ï¼‰

| èµ„æº | æœˆæˆæœ¬ |
|------|--------|
| EC2 t3.medium | Â¥5,000 (~$33) |
| EBS 50GB | Â¥700 (~$5) |
| ALB | Â¥2,700 (~$18) |
| **æ€»è®¡** | **çº¦ Â¥8,400/æœˆ (~$56)** |

---

## ğŸ“š æ›´å¤šå¸®åŠ©

- [å®Œæ•´æ–‡æ¡£](./README.md)
- [å¿«é€Ÿå¼€å§‹](./QUICK_START.md)
- [éœ€è¦çš„ä¿¡æ¯](./REQUIREMENTS.md)

---

*æœ€åæ›´æ–°: 2026-01-23*
