# CloudLens æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ” å½“å‰é—®é¢˜

åŸŸåå·²é…ç½®DNSè§£æï¼Œä½†æœåŠ¡æ— æ³•è®¿é—®ã€‚

---

## ğŸ“‹ æ’æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥ DNS è§£æ

```bash
# æ£€æŸ¥DNSè§£æ
dig cloudlens.songqipeng.com +short
nslookup cloudlens.songqipeng.com

# åº”è¯¥è¿”å› ALB çš„ DNS åç§°æˆ– IP
```

**é¢„æœŸç»“æœ**: åº”è¯¥è§£æåˆ° `cloudlens-alb-1610761068.ap-northeast-1.elb.amazonaws.com`

**å¦‚æœè§£æä¸æ­£ç¡®**:
- æ£€æŸ¥é˜¿é‡Œäº‘DNSé…ç½®
- ç­‰å¾…DNSä¼ æ’­ï¼ˆæœ€å¤š48å°æ—¶ï¼Œé€šå¸¸å‡ åˆ†é’Ÿï¼‰

---

### 2. æ£€æŸ¥ ALB å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯å¥åº·æ£€æŸ¥
aws elbv2 describe-target-health \
  --target-group-arn $(aws elbv2 describe-target-groups \
    --names cloudlens-backend-tg \
    --query 'TargetGroups[0].TargetGroupArn' \
    --output text \
    --region ap-northeast-1) \
  --region ap-northeast-1

# æ£€æŸ¥å‰ç«¯å¥åº·æ£€æŸ¥
aws elbv2 describe-target-health \
  --target-group-arn $(aws elbv2 describe-target-groups \
    --names cloudlens-frontend-tg \
    --query 'TargetGroups[0].TargetGroupArn' \
    --output text \
    --region ap-northeast-1) \
  --region ap-northeast-1
```

**é¢„æœŸç»“æœ**: `State: healthy`

**å¦‚æœä¸å¥åº·**:
- æ£€æŸ¥EC2å®ä¾‹ä¸Šçš„æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
- æ£€æŸ¥æœåŠ¡æ—¥å¿—

---

### 3. æ£€æŸ¥ EC2 æœåŠ¡çŠ¶æ€

```bash
# SSHè¿æ¥
ssh -i ~/.ssh/cloudlens-key.pem ec2-user@3.112.218.39

# æ£€æŸ¥DockeræœåŠ¡
docker ps
docker-compose ps

# æ£€æŸ¥æœåŠ¡æ—¥å¿—
cd /opt/cloudlens/app
docker-compose logs -f
```

**é¢„æœŸç»“æœ**: 
- `backend` å’Œ `frontend` å®¹å™¨éƒ½åœ¨è¿è¡Œ
- ç«¯å£ 8000 (åç«¯) å’Œ 3000 (å‰ç«¯) å·²ç›‘å¬

---

### 4. æ£€æŸ¥æœ¬åœ°æœåŠ¡

```bash
# åœ¨EC2å®ä¾‹ä¸Šæµ‹è¯•
curl http://localhost:8000/health
curl http://localhost:3000
```

**é¢„æœŸç»“æœ**: 
- åç«¯è¿”å›å¥åº·æ£€æŸ¥å“åº”
- å‰ç«¯è¿”å›HTMLé¡µé¢

---

### 5. æ£€æŸ¥å®‰å…¨ç»„

ç¡®ä¿å®‰å…¨ç»„è§„åˆ™æ­£ç¡®ï¼š
- ALBå®‰å…¨ç»„: å…è®¸ 80, 443 å…¥ç«™
- EC2å®‰å…¨ç»„: å…è®¸æ¥è‡ªALBçš„ 8000, 3000 ç«¯å£

---

### 6. æ£€æŸ¥ SSL è¯ä¹¦

```bash
# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
aws acm describe-certificate \
  --certificate-arn arn:aws:acm:ap-northeast-1:329435385384:certificate/caea7afc-9872-4710-8554-a55d2eafd14d \
  --region ap-northeast-1
```

**é¢„æœŸç»“æœ**: `Status: ISSUED`

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: DNSè§£æä¸æ­£ç¡®

**ç—‡çŠ¶**: `dig` è¿”å›é”™è¯¯çš„IPæˆ–æ— æ³•è§£æ

**è§£å†³**:
1. æ£€æŸ¥é˜¿é‡Œäº‘DNSé…ç½®
2. ç¡®è®¤è®°å½•ç±»å‹ä¸º CNAME æˆ– A (åˆ«å)
3. ç­‰å¾…DNSä¼ æ’­

### é—®é¢˜2: æœåŠ¡æœªå¯åŠ¨

**ç—‡çŠ¶**: `docker ps` æ˜¾ç¤ºå®¹å™¨æœªè¿è¡Œ

**è§£å†³**:
```bash
ssh -i ~/.ssh/cloudlens-key.pem ec2-user@3.112.218.39
cd /opt/cloudlens/app
docker-compose up -d
docker-compose logs -f
```

### é—®é¢˜3: å¥åº·æ£€æŸ¥å¤±è´¥

**ç—‡çŠ¶**: ALBå¥åº·æ£€æŸ¥æ˜¾ç¤º `unhealthy`

**è§£å†³**:
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦åœ¨è¿è¡Œ
2. æ£€æŸ¥å¥åº·æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡® (`/health` å’Œ `/`)
3. æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
4. æŸ¥çœ‹æœåŠ¡æ—¥å¿—

### é—®é¢˜4: SSLè¯ä¹¦é—®é¢˜

**ç—‡çŠ¶**: HTTPSè®¿é—®æ˜¾ç¤ºè¯ä¹¦é”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥è¯ä¹¦æ˜¯å¦å·²éªŒè¯
2. ç­‰å¾…è¯ä¹¦éªŒè¯å®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
3. æ£€æŸ¥DNSéªŒè¯è®°å½•æ˜¯å¦æ­£ç¡®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. DNSè§£æç»“æœ (`dig cloudlens.songqipeng.com`)
2. ALBå¥åº·æ£€æŸ¥çŠ¶æ€
3. EC2æœåŠ¡çŠ¶æ€ (`docker ps`)
4. æœåŠ¡æ—¥å¿— (`docker-compose logs`)

---

*æœ€åæ›´æ–°: 2026-01-23*
