# å¼€å‘å¾…åŠäº‹é¡¹æ¸…å•

> **æœ€åæ›´æ–°**: 2025-10-31  
> **å½“å‰ç‰ˆæœ¬**: v2.0.0

---

## âœ… å·²å®Œæˆ

### å¤šç§Ÿæˆ·æ”¯æŒæ”¹é€ 
- âœ… **RDSåˆ†æå™¨** - å·²å®Œæˆå¤šç§Ÿæˆ·æ”¯æŒæ”¹é€ 
  - æ”¯æŒ `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - æŠ¥å‘Šè¾“å‡ºåˆ° `{tenant_name}/cru/` ç›®å½•
  - æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨ `data/{tenant_name}/rds/` ç›®å½•

---

## ğŸš§ å¾…å®Œæˆå·¥ä½œ

### 1. èµ„æºåˆ©ç”¨ç‡åˆ†æå™¨å¤šç§Ÿæˆ·æ”¯æŒæ”¹é€ 

ä»¥ä¸‹åˆ†æå™¨éœ€è¦æŒ‰ç…§RDSçš„æ¨¡å¼è¿›è¡Œæ”¹é€ ï¼Œæ·»åŠ å¤šç§Ÿæˆ·æ”¯æŒï¼š

#### 1.1 Redisåˆ†æå™¨ (é«˜ä¼˜å…ˆçº§) â³
- **æ–‡ä»¶**: `resource_modules/redis_analyzer.py`
- **ä»»åŠ¡**:
  - [ ] ä¿®æ”¹ `__init__` æ–¹æ³•ï¼Œæ·»åŠ  `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - [ ] ä¿®æ”¹æ•°æ®åº“è·¯å¾„ä¸ºç§Ÿæˆ·ç‰¹å®šè·¯å¾„ï¼š`data/{tenant_name}/redis/`
  - [ ] ä¿®æ”¹æŠ¥å‘Šè¾“å‡ºè·¯å¾„ä¸ºï¼š`{tenant_name}/cru/`
  - [ ] ä¿®æ”¹ `main()` å‡½æ•°ï¼Œæ¥å— `tenant_name`, `output_base_dir`, `tenant_config` å‚æ•°
  - [ ] æ›´æ–° `main.py` ä¸­çš„ `run_redis_analysis()` å‡½æ•°

#### 1.2 MongoDBåˆ†æå™¨ (é«˜ä¼˜å…ˆçº§) â³
- **æ–‡ä»¶**: `resource_modules/mongodb_analyzer.py`
- **ä»»åŠ¡**:
  - [ ] ä¿®æ”¹ `__init__` æ–¹æ³•ï¼Œæ·»åŠ  `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - [ ] ä¿®æ”¹æ•°æ®åº“è·¯å¾„ä¸ºç§Ÿæˆ·ç‰¹å®šè·¯å¾„ï¼š`data/{tenant_name}/mongodb/`
  - [ ] ä¿®æ”¹æŠ¥å‘Šè¾“å‡ºè·¯å¾„ä¸ºï¼š`{tenant_name}/cru/`
  - [ ] ä¿®æ”¹ `main()` å‡½æ•°ï¼Œæ¥å— `tenant_name`, `output_base_dir`, `tenant_config` å‚æ•°
  - [ ] æ›´æ–° `main.py` ä¸­çš„ `run_mongodb_analysis()` å‡½æ•°

#### 1.3 ClickHouseåˆ†æå™¨ â³
- **æ–‡ä»¶**: `resource_modules/clickhouse_analyzer.py`
- **çŠ¶æ€**: éƒ¨åˆ†æ”¯æŒï¼ˆå·²æœ‰tenant_nameå‚æ•°ï¼Œä½†éœ€è¦å®Œå–„ï¼‰
- **ä»»åŠ¡**:
  - [ ] æ£€æŸ¥å¹¶å®Œå–„ `output_base_dir` æ”¯æŒ
  - [ ] ç¡®ä¿æŠ¥å‘Šè¾“å‡ºåˆ°æ­£ç¡®çš„ç§Ÿæˆ·ç›®å½•
  - [ ] ç¡®ä¿æ•°æ®åº“æ–‡ä»¶éš”ç¦»

#### 1.4 OSSåˆ†æå™¨ â³
- **æ–‡ä»¶**: `resource_modules/oss_analyzer.py`
- **çŠ¶æ€**: éƒ¨åˆ†æ”¯æŒï¼ˆå·²æ¥å—å‡­è¯å‚æ•°ï¼Œä½†ç¼ºå°‘ç§Ÿæˆ·éš”ç¦»ï¼‰
- **ä»»åŠ¡**:
  - [ ] æ·»åŠ  `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - [ ] ä¿®æ”¹æŠ¥å‘Šè¾“å‡ºè·¯å¾„ä¸ºï¼š`{tenant_name}/cru/`
  - [ ] ä¿®æ”¹ `main()` å‡½æ•°ç­¾å
  - [ ] æ›´æ–° `main.py` ä¸­çš„è°ƒç”¨æ–¹å¼

#### 1.5 SLBåˆ†æå™¨ â³
- **æ–‡ä»¶**: `resource_modules/slb_analyzer.py`
- **çŠ¶æ€**: éƒ¨åˆ†æ”¯æŒï¼ˆå·²æ¥å—å‡­è¯å‚æ•°ï¼Œä½†ç¼ºå°‘ç§Ÿæˆ·éš”ç¦»ï¼‰
- **ä»»åŠ¡**:
  - [ ] æ·»åŠ  `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - [ ] ä¿®æ”¹æŠ¥å‘Šè¾“å‡ºè·¯å¾„ä¸ºï¼š`{tenant_name}/cru/`
  - [ ] ä¿®æ”¹ `main()` å‡½æ•°ç­¾å
  - [ ] æ›´æ–° `main.py` ä¸­çš„è°ƒç”¨æ–¹å¼

#### 1.6 EIPåˆ†æå™¨ â³
- **æ–‡ä»¶**: `resource_modules/eip_analyzer.py`
- **çŠ¶æ€**: éƒ¨åˆ†æ”¯æŒï¼ˆå·²æ¥å—å‡­è¯å‚æ•°ï¼Œä½†ç¼ºå°‘ç§Ÿæˆ·éš”ç¦»ï¼‰
- **ä»»åŠ¡**:
  - [ ] æ·»åŠ  `tenant_name` å’Œ `output_base_dir` å‚æ•°
  - [ ] ä¿®æ”¹æŠ¥å‘Šè¾“å‡ºè·¯å¾„ä¸ºï¼š`{tenant_name}/cru/`
  - [ ] ä¿®æ”¹ `main()` å‡½æ•°ç­¾å
  - [ ] æ›´æ–° `main.py` ä¸­çš„è°ƒç”¨æ–¹å¼

---

### 2. æŠ˜æ‰£åˆ†æåŠŸèƒ½å®Œå–„

#### 2.1 MongoDBæŠ˜æ‰£åˆ†æä¿®å¤ âš ï¸ **é«˜ä¼˜å…ˆçº§**
- **æ–‡ä»¶**: `resource_modules/discount_analyzer.py`
- **é—®é¢˜**: `DescribeRenewalPrice` APIè°ƒç”¨å¤±è´¥ï¼ˆç½‘ç»œè¿æ¥é”™è¯¯ï¼‰
- **é”™è¯¯ä¿¡æ¯**: `Connection aborted`, `ConnectionResetError`
- **ä»»åŠ¡**:
  - [ ] æ£€æŸ¥MongoDB APIåŸŸåå’Œç‰ˆæœ¬æ˜¯å¦æ­£ç¡®
  - [ ] å°è¯•ä½¿ç”¨HTTPSæˆ–ä¸åŒçš„APIç«¯ç‚¹
  - [ ] å‚è€ƒRedisçš„å®ç°æ–¹å¼ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„APIæ–¹æ³•
  - [ ] æ·»åŠ æ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
  - [ ] æµ‹è¯•ä¿®å¤åçš„åŠŸèƒ½

#### 2.2 å…¶ä»–èµ„æºæŠ˜æ‰£åˆ†æè¯„ä¼°
- **OSS**: âŒ ä¸æ”¯æŒï¼ˆæŒ‰é‡ä»˜è´¹æ¨¡å¼ï¼Œä¸æ”¯æŒåŒ…å¹´åŒ…æœˆï¼‰
- **SLB**: âŒ ä¸æ”¯æŒï¼ˆæŒ‰é‡ä»˜è´¹æ¨¡å¼ï¼Œä¸æ”¯æŒåŒ…å¹´åŒ…æœˆï¼‰
- **EIP**: âŒ ä¸æ”¯æŒï¼ˆæŒ‰é‡ä»˜è´¹æ¨¡å¼ï¼Œä¸æ”¯æŒåŒ…å¹´åŒ…æœˆï¼‰
- **ClickHouse**: â³ å¾…è¯„ä¼°æ˜¯å¦æ”¯æŒåŒ…å¹´åŒ…æœˆæ¨¡å¼

---

### 3. main.py é›†æˆæ›´æ–°

éœ€è¦æ›´æ–° `main.py` ä¸­æ‰€æœ‰åˆ†æå™¨çš„è°ƒç”¨å‡½æ•°ï¼š

- [ ] `run_redis_analysis()` - æ·»åŠ  `tenant_name` å‚æ•°æ”¯æŒ
- [ ] `run_mongodb_analysis()` - æ·»åŠ  `tenant_name` å‚æ•°æ”¯æŒ
- [ ] `run_clickhouse_analysis()` - æ£€æŸ¥å¹¶å®Œå–„
- [ ] `run_oss_analysis()` - æ·»åŠ  `tenant_name` å‚æ•°æ”¯æŒ
- [ ] `run_slb_analysis()` - æ·»åŠ  `tenant_name` å‚æ•°æ”¯æŒ
- [ ] `run_eip_analysis()` - æ·»åŠ  `tenant_name` å‚æ•°æ”¯æŒ
- [ ] `run_all_cru_analysis()` - æ›´æ–°æ‰€æœ‰è°ƒç”¨ä»¥ä¼ é€’ `tenant_name`

---

### 4. æµ‹è¯•å’ŒéªŒè¯

- [ ] æµ‹è¯•RDSåˆ†æå™¨å¤šç§Ÿæˆ·åŠŸèƒ½ï¼ˆå·²æ”¹é€ ï¼Œéœ€éªŒè¯ï¼‰
- [ ] æµ‹è¯•æ‰€æœ‰æ”¹é€ åçš„åˆ†æå™¨
- [ ] éªŒè¯æŠ¥å‘Šè¾“å‡ºç›®å½•ç»“æ„
- [ ] éªŒè¯æ•°æ®åº“æ–‡ä»¶éš”ç¦»
- [ ] éªŒè¯å¤šç§Ÿæˆ·å¹¶å‘åˆ†æä¸äº’ç›¸å¹²æ‰°

---

## ğŸ“ æ”¹é€ æ¨¡æ¿å‚è€ƒ

### RDSåˆ†æå™¨æ”¹é€ æ¨¡å¼ï¼ˆå·²å®Œæˆï¼Œä½œä¸ºæ¨¡æ¿ï¼‰

```python
class RDSAnalyzer:
    def __init__(self, access_key_id, access_key_secret, tenant_name=None, output_base_dir="."):
        self.access_key_id = access_key_id
        self.access_key_secret = access_key_secret
        self.tenant_name = tenant_name or "default"
        self.output_base_dir = output_base_dir
        
        # ç§Ÿæˆ·ç‰¹å®šçš„æ•°æ®åº“è·¯å¾„
        import os
        db_dir = os.path.join(output_base_dir, "data", self.tenant_name, "rds")
        os.makedirs(db_dir, exist_ok=True)
        self.db_name = os.path.join(db_dir, 'rds_monitoring_data.db')

def main(tenant_name=None, output_base_dir=".", tenant_config=None):
    # æ”¯æŒä»tenant_configè·å–å‡­è¯ï¼Œæˆ–ä»config.jsonè¯»å–ï¼ˆå‘åå…¼å®¹ï¼‰
    ...
```

### main.pyè°ƒç”¨æ¨¡å¼

```python
def run_xxx_analysis(args, tenant_name=None, tenant_config=None):
    from resource_modules.xxx_analyzer import main as xxx_main
    xxx_main(tenant_name=tenant_name, output_base_dir=".", tenant_config=tenant_config)
```

---

## ğŸ¯ ä¼˜å…ˆçº§æ’åº

1. **é«˜ä¼˜å…ˆçº§**:
   - Redisåˆ†æå™¨å¤šç§Ÿæˆ·æ”¯æŒ
   - MongoDBåˆ†æå™¨å¤šç§Ÿæˆ·æ”¯æŒ
   - MongoDBæŠ˜æ‰£åˆ†æAPIä¿®å¤

2. **ä¸­ä¼˜å…ˆçº§**:
   - ClickHouseåˆ†æå™¨å®Œå–„
   - OSS/SLB/EIPåˆ†æå™¨å¤šç§Ÿæˆ·æ”¯æŒ

3. **ä½ä¼˜å…ˆçº§**:
   - å…¨é¢æµ‹è¯•å’ŒéªŒè¯
   - æ–‡æ¡£æ›´æ–°

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: æ‰€æœ‰æ”¹é€ éƒ½åº”ä¿æŒå‘åå…¼å®¹ï¼Œå¦‚æœæœªæä¾›ç§Ÿæˆ·å‚æ•°ï¼Œåº”ä½¿ç”¨é»˜è®¤å€¼æˆ–ä»config.jsonè¯»å–
2. **ç›®å½•ç»“æ„**: ç»Ÿä¸€ä½¿ç”¨ `{tenant_name}/cru/` ä½œä¸ºæŠ¥å‘Šè¾“å‡ºç›®å½•
3. **æ•°æ®åº“éš”ç¦»**: æ¯ä¸ªç§Ÿæˆ·çš„æ•°æ®åº”å®Œå…¨éš”ç¦»ï¼Œé¿å…æ•°æ®æ··æ·†
4. **é”™è¯¯å¤„ç†**: æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
5. **æµ‹è¯•éªŒè¯**: æ¯å®Œæˆä¸€ä¸ªåˆ†æå™¨æ”¹é€ åï¼Œåº”ç«‹å³æµ‹è¯•éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

- 2025-10-31: åˆ›å»ºå¾…åŠäº‹é¡¹æ¸…å•ï¼Œå®ŒæˆRDSåˆ†æå™¨å¤šç§Ÿæˆ·æ”¯æŒæ”¹é€ 

