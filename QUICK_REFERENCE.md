# CloudLens å¿«é€Ÿå‚è€ƒå¡ç‰‡

> ğŸ“– ä¸€é¡µçº¸äº†è§£å…¨éƒ¨æ ¸å¿ƒå‘½ä»¤å’ŒåŠŸèƒ½

---

## ğŸ¯ æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥

### é…ç½®ç®¡ç†
```bash
./cl config add --provider aliyun --name prod --ak xxx --sk xxx    # æ·»åŠ è´¦å·
./cl config list                                                    # æŸ¥çœ‹è´¦å·
./cl config rules                                                   # é…ç½®è§„åˆ™ï¼ˆäº¤äº’å¼ï¼‰
```

### èµ„æºæŸ¥è¯¢
```bash
./cl query ecs --account prod              # æŸ¥è¯¢ECS
./cl query rds --account prod              # æŸ¥è¯¢RDS
./cl query ecs --format json > ecs.json    # å¯¼å‡ºJSON
./cl query ecs --concurrent                # å¹¶å‘æŸ¥è¯¢å¤šè´¦å·
```

### åˆ†æåŠŸèƒ½
```bash
./cl analyze idle --account prod           # é—²ç½®èµ„æºåˆ†æ
./cl analyze cost --account prod --trend   # æˆæœ¬è¶‹åŠ¿åˆ†æ
./cl analyze forecast --account prod       # AIæˆæœ¬é¢„æµ‹
./cl analyze discount --export âœ¨          # æŠ˜æ‰£è¶‹åŠ¿åˆ†æï¼ˆæ–°ï¼‰
./cl analyze security --account prod --cis # CISå®‰å…¨åˆè§„
./cl analyze tags --account prod           # æ ‡ç­¾æ²»ç†
```

### è‡ªåŠ¨ä¿®å¤
```bash
./cl remediate tags --account prod         # æ‰¹é‡æ‰“æ ‡ç­¾ï¼ˆå¹²è¿è¡Œï¼‰
./cl remediate tags --account prod --confirm  # å®é™…æ‰§è¡Œ
./cl remediate history                     # æŸ¥çœ‹ä¿®å¤å†å²
```

### ç¼“å­˜ç®¡ç†
```bash
./cl cache status                          # æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
./cl cache clear --all                     # æ¸…é™¤æ‰€æœ‰ç¼“å­˜
./cl cache cleanup                         # æ¸…ç†è¿‡æœŸç¼“å­˜
```

---

## ğŸ“Š æ ¸å¿ƒæ¨¡å—é€ŸæŸ¥

| æ¨¡å— | æ–‡ä»¶ | æ ¸å¿ƒåŠŸèƒ½ |
|------|------|----------|
| é…ç½®ç®¡ç† | `core/config.py` | å¤šæºè´¦å·åŠ è½½+Keyring |
| ç¼“å­˜ç³»ç»Ÿ | `core/cache.py` | SQLite TTLç¼“å­˜ï¼ˆä¸»è·¯å¾„âœ…ï¼‰ |
| é—²ç½®æ£€æµ‹ | `core/idle_detector.py` | 2/4æ¡ä»¶åˆ¤å®š+ç™½åå• |
| æˆæœ¬è¶‹åŠ¿ | `core/cost_trend_analyzer.py` | å¿«ç…§+ç¯æ¯”MoM |
| **æŠ˜æ‰£åˆ†æ**âœ¨ | `core/discount_analyzer.py` | CSVè§£æ+6æœˆè¶‹åŠ¿ |
| å®‰å…¨åˆè§„ | `core/security_compliance.py` | å…¬ç½‘æš´éœ²+CIS |
| äº‘æŠ½è±¡ | `core/provider.py` | BaseProvideræ¥å£ |
| é˜¿é‡Œäº‘ | `providers/aliyun/provider.py` | 17ç§èµ„æº |

---

## ğŸ”„ 3ä¸ªæ ¸å¿ƒæ•°æ®æµ

### æµç¨‹1: èµ„æºæŸ¥è¯¢ï¼ˆ5åˆ†é’Ÿç¼“å­˜ï¼‰
```
CLI â†’ Config â†’ Cache â†’ Provider API â†’ SQLite â†’ è¾“å‡º
```

### æµç¨‹2: é—²ç½®åˆ†æï¼ˆ24å°æ—¶ç¼“å­˜ï¼‰
```
CLI â†’ Cache â†’ Rules â†’ Provider â†’ CloudMonitor(6æŒ‡æ ‡) â†’ åˆ¤å®š â†’ Cache â†’ è¾“å‡º
```

### æµç¨‹3: æŠ˜æ‰£åˆ†æï¼ˆ24å°æ—¶ç¼“å­˜ï¼‰âœ¨
```
CLI â†’ è´¦å•CSV(143ä¸‡è¡Œ) â†’ è§£æ â†’ æŒ‰æœˆèšåˆ â†’ è¶‹åŠ¿åˆ†æ â†’ Cache â†’ HTMLæŠ¥å‘Š
```

---

## ğŸ’¾ æ•°æ®å­˜å‚¨ä½ç½®

```
~/.cloudlens/
â”œâ”€â”€ config.json              # è´¦å·é…ç½®
â”œâ”€â”€ cache.db                 # SQLiteç¼“å­˜ï¼ˆä¸»ï¼‰âœ…
â”œâ”€â”€ discount_cache/          # æŠ˜æ‰£ç¼“å­˜ âœ¨
â””â”€â”€ rules.json               # ä¼˜åŒ–è§„åˆ™

./data/cost/
â””â”€â”€ cost_history.json        # æˆæœ¬å¿«ç…§å†å²

é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ è´¦å·ID-åç§°/              # è´¦å•CSVç›®å½• âœ¨
    â”œâ”€â”€ *_detail_1.csv
    â””â”€â”€ *_detail_2.csv
```

---

## âš ï¸ æŠ€æœ¯å€ºåŠ¡é€ŸæŸ¥

| é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥æ—¶ |
|------|------|--------|----------|
| ç¼“å­˜ä½“ç³»åŒè½¨ï¼ˆåŒåå†²çªï¼‰ | ğŸ”´ åŠŸèƒ½æ··ä¹± | P0 | 2-4h |
| `list_eip()` å‘½åä¸ç»Ÿä¸€ | ğŸ”´ åŠŸèƒ½é€€åŒ– | P0 | 30min |
| `list_nas()` æœ‰bug | ğŸ”´ NASæŸ¥è¯¢å¤±è´¥ | P0 | 1h |
| æˆæœ¬å£å¾„ä¸ç»Ÿä¸€ | ğŸŸ¡ æ•°æ®ä¸å‡† | P1 | 1-2å¤© |
| ä¼˜åŒ–å¼•æ“ä¾èµ–æœ¬åœ°DB | ğŸŸ¡ ç¯å¢ƒä¾èµ– | P1 | 2-3å¤© |
| Webå‰ç«¯åŠŸèƒ½ç¼ºå¤± | ğŸŸ¢ ä½“éªŒå½±å“ | P2 | 2-3å‘¨ |

---

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

| æ“ä½œ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡å€æ•° |
|------|--------|--------|----------|
| å•è´¦å·ECSæŸ¥è¯¢ï¼ˆ100å®ä¾‹ï¼‰ | 3-5ç§’ | <100ms | 50x |
| é—²ç½®åˆ†æï¼ˆå«ç›‘æ§ï¼‰ | 30-60ç§’ | <1ç§’ | 60x |
| **è´¦å•è§£æâœ¨ï¼ˆ143ä¸‡è¡Œï¼‰** | **60-90ç§’** | **<1ç§’** | **90x** |
| 5è´¦å·å¹¶å‘æŸ¥è¯¢ | 8ç§’ | <500ms | 16x |

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼æ•°æ®

åŸºäºç¤ºä¾‹è´¦å•ï¼ˆ2025-07è‡³2025-12ï¼‰:

- **ç´¯è®¡èŠ‚çœ**: Â¥258ä¸‡ï¼ˆæŠ˜æ‰£ï¼‰
- **å¹³å‡æŠ˜æ‰£ç‡**: 52.68%
- **TOPäº§å“**: ECS Â¥141ä¸‡ï¼ˆ57.69%ï¼‰
- **TOPåˆåŒ**: ALY20250616174046069782_V1ï¼ˆÂ¥123ä¸‡ï¼‰
- **æŠ˜æ‰£è¶‹åŠ¿**: ğŸ“ˆ ä¸Šå‡ +6.85%

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥ï¼‰

### 1ï¸âƒ£ é…ç½®è´¦å·
```bash
./cl config add --provider aliyun --name prod --ak YOUR_AK --sk YOUR_SK
```

### 2ï¸âƒ£ æŸ¥è¯¢èµ„æº
```bash
./cl query ecs --account prod
```

### 3ï¸âƒ£ åˆ†æä¼˜åŒ–
```bash
./cl analyze idle --account prod      # é—²ç½®åˆ†æ
./cl analyze discount --export âœ¨     # æŠ˜æ‰£åˆ†æï¼ˆæ–°åŠŸèƒ½ï¼‰
```

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ç”¨é€” | é€‚åˆäººç¾¤ |
|------|------|----------|
| `PROJECT_SUMMARY.md` ğŸ“„ | é¡¹ç›®æ‘˜è¦ | æ‰€æœ‰äºº |
| `PROJECT_DEEP_ANALYSIS.md` ğŸ“– | æ·±åº¦æ¢³ç† | å¼€å‘è€…ã€æ¶æ„å¸ˆ |
| `ARCHITECTURE_DIAGRAM.md` ğŸ¨ | æ¶æ„å›¾è°± | æŠ€æœ¯å›¢é˜Ÿ |
| `DISCOUNT_ANALYSIS_GUIDE.md` âœ¨ | æŠ˜æ‰£æŒ‡å— | æˆæœ¬å›¢é˜Ÿã€è´¢åŠ¡ |
| `README.md` ğŸ“˜ | ä½¿ç”¨æ‰‹å†Œ | æ–°ç”¨æˆ· |

---

## ğŸ”— å…³é”®é“¾æ¥

- **CLIå…¥å£**: `cli/main.py`
- **Web API**: `web/backend/api.py`
- **æŠ˜æ‰£åˆ†æå™¨**: `core/discount_analyzer.py` âœ¨
- **é…ç½®ç¤ºä¾‹**: `~/.cloudlens/config.json`

---

## ğŸ’¡ ä¸€å¥è¯è®°ä½

**CloudLens = å¤šäº‘èµ„æºæ²»ç†ï¼ˆCLI+Webï¼‰ = é—²ç½®è¯†åˆ« + æˆæœ¬/æŠ˜æ‰£åˆ†æ + å®‰å…¨åˆè§„ + è‡ªåŠ¨ä¼˜åŒ–**

---

**æœ€åæ›´æ–°**: 2025-12-15  
**ç‰ˆæœ¬**: v2.1.0  
**æ–°åŠŸèƒ½**: âœ¨ æŠ˜æ‰£è¶‹åŠ¿åˆ†æ



