# CloudLens é¡¹ç›®ç»“æ„

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ CloudLens é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œå„æ¨¡å—çš„èŒè´£ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
aliyunidle/
â”œâ”€â”€ cli/                          # CLIå‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ main.py                  # CLIä¸»å…¥å£
â”‚   â”œâ”€â”€ utils.py                 # CLIå·¥å…·å‡½æ•°
â”‚   â””â”€â”€ commands/                # å‘½ä»¤æ¨¡å—
â”‚       â”œâ”€â”€ analyze_cmd.py       # åˆ†æå‘½ä»¤
â”‚       â”œâ”€â”€ bill_cmd.py          # è´¦å•å‘½ä»¤
â”‚       â”œâ”€â”€ cache_cmd.py         # ç¼“å­˜ç®¡ç†å‘½ä»¤
â”‚       â”œâ”€â”€ config_cmd.py        # é…ç½®ç®¡ç†å‘½ä»¤
â”‚       â”œâ”€â”€ query_cmd.py         # èµ„æºæŸ¥è¯¢å‘½ä»¤
â”‚       â””â”€â”€ remediate_cmd.py     # ä¿®å¤å‘½ä»¤
â”‚
â”œâ”€â”€ core/                         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ database.py              # æ•°æ®åº“æŠ½è±¡å±‚ï¼ˆMySQL/SQLiteï¼‰
â”‚   â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ provider.py              # äº‘å‚å•†æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ cache.py                 # ç¼“å­˜ç®¡ç†å™¨
â”‚   â”œâ”€â”€ bill_storage.py          # è´¦å•å­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ dashboard_manager.py     # ä»ªè¡¨ç›˜ç®¡ç†
â”‚   â”œâ”€â”€ budget_manager.py        # é¢„ç®—ç®¡ç†
â”‚   â”œâ”€â”€ alert_manager.py         # å‘Šè­¦ç®¡ç†
â”‚   â”œâ”€â”€ virtual_tags.py          # è™šæ‹Ÿæ ‡ç­¾ç®¡ç†
â”‚   â”œâ”€â”€ cost_allocation.py       # æˆæœ¬åˆ†é…
â”‚   â”œâ”€â”€ idle_detector.py         # é—²ç½®èµ„æºæ£€æµ‹
â”‚   â”œâ”€â”€ cost_analyzer.py         # æˆæœ¬åˆ†æ
â”‚   â”œâ”€â”€ cost_trend_analyzer.py   # æˆæœ¬è¶‹åŠ¿åˆ†æ
â”‚   â”œâ”€â”€ discount_analyzer_advanced.py  # é«˜çº§æŠ˜æ‰£åˆ†æ
â”‚   â”œâ”€â”€ security_compliance.py   # å®‰å…¨åˆè§„æ£€æŸ¥
â”‚   â”œâ”€â”€ cis_compliance.py        # CISåŸºå‡†æ£€æŸ¥
â”‚   â”œâ”€â”€ tag_analyzer.py          # æ ‡ç­¾åˆ†æ
â”‚   â”œâ”€â”€ report_generator.py      # æŠ¥å‘Šç”Ÿæˆ
â”‚   â”œâ”€â”€ filter_engine.py         # é«˜çº§ç­›é€‰å¼•æ“
â”‚   â”œâ”€â”€ rules_manager.py         # è§„åˆ™ç®¡ç†
â”‚   â”œâ”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ analysis_service.py  # åˆ†ææœåŠ¡
â”‚   â””â”€â”€ ...                      # å…¶ä»–æ ¸å¿ƒæ¨¡å—
â”‚
â”œâ”€â”€ providers/                    # äº‘å‚å•†å®ç°
â”‚   â”œâ”€â”€ aliyun/                  # é˜¿é‡Œäº‘Provider
â”‚   â”‚   â”œâ”€â”€ provider.py          # åŒæ­¥Provider
â”‚   â”‚   â””â”€â”€ async_provider.py    # å¼‚æ­¥Provider
â”‚   â””â”€â”€ tencent/                 # è…¾è®¯äº‘Provider
â”‚       â””â”€â”€ provider.py
â”‚
â”œâ”€â”€ resource_modules/             # èµ„æºåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ ecs_analyzer.py          # ECSåˆ†æå™¨
â”‚   â”œâ”€â”€ rds_analyzer.py          # RDSåˆ†æå™¨
â”‚   â”œâ”€â”€ redis_analyzer.py        # Redisåˆ†æå™¨
â”‚   â”œâ”€â”€ vpc_analyzer.py          # VPCåˆ†æå™¨
â”‚   â”œâ”€â”€ eip_analyzer.py          # EIPåˆ†æå™¨
â”‚   â”œâ”€â”€ disk_analyzer.py         # ç£ç›˜åˆ†æå™¨
â”‚   â”œâ”€â”€ cost_analyzer.py         # æˆæœ¬åˆ†æå™¨
â”‚   â””â”€â”€ ...                      # å…¶ä»–èµ„æºåˆ†æå™¨
â”‚
â”œâ”€â”€ web/                          # Webåº”ç”¨
â”‚   â”œâ”€â”€ backend/                 # åç«¯APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPIåº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ api.py               # ä¸»APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ api_alerts.py        # å‘Šè­¦API
â”‚   â”‚   â”œâ”€â”€ api_cost_allocation.py  # æˆæœ¬åˆ†é…API
â”‚   â”‚   â”œâ”€â”€ api_ai_optimizer.py # AIä¼˜åŒ–API
â”‚   â”‚   â”œâ”€â”€ error_handler.py    # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ i18n.py             # å›½é™…åŒ–
â”‚   â””â”€â”€ frontend/                # å‰ç«¯åº”ç”¨
â”‚       â”œâ”€â”€ app/                 # Next.js App Router
â”‚       â”‚   â”œâ”€â”€ _pages/          # é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ a/[account]/    # è´¦å·è·¯ç”±
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ components/          # Reactç»„ä»¶
â”‚       â”œâ”€â”€ lib/                # å·¥å…·åº“
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ models/                       # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ resource.py             # ç»Ÿä¸€èµ„æºæ¨¡å‹
â”‚
â”œâ”€â”€ utils/                        # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ logger.py               # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ error_handler.py        # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ retry_helper.py         # é‡è¯•åŠ©æ‰‹
â”‚   â”œâ”€â”€ concurrent_helper.py    # å¹¶å‘åŠ©æ‰‹
â”‚   â”œâ”€â”€ credential_manager.py   # å‡­è¯ç®¡ç†
â”‚   â””â”€â”€ cost_predictor.py       # æˆæœ¬é¢„æµ‹
â”‚
â”œâ”€â”€ scripts/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ install_completion.sh   # å®‰è£…Shellè‡ªåŠ¨è¡¥é½
â”‚   â”œâ”€â”€ migrate_sqlite_to_mysql.py  # æ•°æ®è¿ç§»è„šæœ¬
â”‚   â””â”€â”€ ...                     # å…¶ä»–å·¥å…·è„šæœ¬
â”‚
â”œâ”€â”€ sql/                          # SQLè„šæœ¬
â”‚   â”œâ”€â”€ init_mysql_schema.sql    # MySQLè¡¨ç»“æ„
â”‚   â””â”€â”€ verify_schema.py        #  schemaéªŒè¯è„šæœ¬
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ providers/               # Provideræµ‹è¯•
â”‚   â”œâ”€â”€ resource_modules/        # èµ„æºæ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ utils/                   # å·¥å…·æ¨¡å—æµ‹è¯•
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ WEB_QUICKSTART.md        # Webå¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€â”€ DISCOUNT_ANALYSIS_GUIDE.md  # æŠ˜æ‰£åˆ†ææŒ‡å—
â”‚   â”œâ”€â”€ BILL_AUTO_FETCH_GUIDE.md    # è´¦å•è·å–æŒ‡å—
â”‚   â”œâ”€â”€ PLUGIN_DEVELOPMENT.md    # æ’ä»¶å¼€å‘æŒ‡å—
â”‚   â””â”€â”€ shell_completion.md      # Shellè‡ªåŠ¨è¡¥é½
â”‚
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ basic_usage.py           # åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ advanced_usage.py       # é«˜çº§ä½¿ç”¨ç¤ºä¾‹
â”‚
â”œâ”€â”€ completions/                  # Shellè‡ªåŠ¨è¡¥é½
â”‚   â”œâ”€â”€ cl-complete.bash         # Bashè¡¥é½è„šæœ¬
â”‚   â””â”€â”€ cl-complete.zsh          # Zshè¡¥é½è„šæœ¬
â”‚
â”œâ”€â”€ .github/                      # GitHubé…ç½®
â”‚   â””â”€â”€ workflows/               # CI/CDå·¥ä½œæµ
â”‚       â””â”€â”€ ci.yml               # æŒç»­é›†æˆé…ç½®
â”‚
â”œâ”€â”€ README.md                     # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md                # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ USER_GUIDE.md                # ç”¨æˆ·æ‰‹å†Œ
â”œâ”€â”€ TECHNICAL_ARCHITECTURE.md    # æŠ€æœ¯æ¶æ„æ–‡æ¡£
â”œâ”€â”€ PRODUCT_INTRODUCTION.md      # äº§å“ä»‹ç»
â”œâ”€â”€ CONTRIBUTING.md              # è´¡çŒ®æŒ‡å—
â”œâ”€â”€ CHANGELOG.md                 # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ pyproject.toml               # é¡¹ç›®é…ç½®
â””â”€â”€ config.json.example          # é…ç½®ç¤ºä¾‹
```

## ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### CLIå±‚ (`cli/`)
- **èŒè´£**: å‘½ä»¤è¡Œæ¥å£ï¼Œç”¨æˆ·äº¤äº’
- **æŠ€æœ¯**: Clickæ¡†æ¶
- **ä¸»è¦æ–‡ä»¶**:
  - `main.py`: CLIå…¥å£ï¼Œå‘½ä»¤æ³¨å†Œ
  - `commands/*.py`: å„åŠŸèƒ½å‘½ä»¤å®ç°

### æ ¸å¿ƒä¸šåŠ¡å±‚ (`core/`)
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘å®ç°
- **ä¸»è¦æ¨¡å—**:
  - **æ•°æ®åº“å±‚**: `database.py` - æ•°æ®åº“æŠ½è±¡ï¼Œæ”¯æŒMySQL/SQLite
  - **å­˜å‚¨ç®¡ç†**: `cache.py`, `bill_storage.py`, `dashboard_manager.py` ç­‰
  - **åˆ†æå¼•æ“**: `idle_detector.py`, `cost_analyzer.py`, `discount_analyzer_advanced.py` ç­‰
  - **å®‰å…¨åˆè§„**: `security_compliance.py`, `cis_compliance.py`
  - **æœåŠ¡å±‚**: `services/analysis_service.py` - åˆ†ææœåŠ¡å°è£…

### äº‘å‚å•†å±‚ (`providers/`)
- **èŒè´£**: äº‘å‚å•†APIå°è£…
- **è®¾è®¡æ¨¡å¼**: æŠ½è±¡å·¥å‚æ¨¡å¼
- **å®ç°**:
  - `BaseProvider`: æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
  - `AliyunProvider`: é˜¿é‡Œäº‘å®ç°
  - `TencentProvider`: è…¾è®¯äº‘å®ç°
  - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼

### èµ„æºåˆ†æå±‚ (`resource_modules/`)
- **èŒè´£**: å„ç±»èµ„æºçš„ä¸“é—¨åˆ†æé€»è¾‘
- **ç‰¹ç‚¹**: æ’ä»¶åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- **åˆ†æå™¨ç±»å‹**:
  - ECSã€RDSã€Redisç­‰èµ„æºåˆ†æå™¨
  - æˆæœ¬åˆ†æå™¨
  - ç½‘ç»œåˆ†æå™¨

### Webåº”ç”¨å±‚ (`web/`)
- **åç«¯** (`web/backend/`):
  - FastAPIæ¡†æ¶
  - RESTful APIè®¾è®¡
  - æ”¯æŒä¸­è‹±æ–‡å›½é™…åŒ–
- **å‰ç«¯** (`web/frontend/`):
  - Next.jsæ¡†æ¶
  - React + TypeScript
  - ç°ä»£åŒ–UIè®¾è®¡ï¼ˆFinouté£æ ¼ï¼‰

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **è¯­è¨€**: Python 3.8+
- **æ¡†æ¶**: FastAPI
- **æ•°æ®åº“**: MySQLï¼ˆä¸»ï¼‰ï¼ŒSQLiteï¼ˆå…¼å®¹ï¼‰
- **ORM**: è‡ªå®šä¹‰æ•°æ®åº“æŠ½è±¡å±‚
- **ç¼“å­˜**: MySQL/SQLiteç¼“å­˜è¡¨

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: Next.js 14+
- **è¯­è¨€**: TypeScript
- **UIåº“**: è‡ªå®šä¹‰ç»„ä»¶åº“ï¼ˆTailwind CSSï¼‰
- **çŠ¶æ€ç®¡ç†**: React Context API
- **å›½é™…åŒ–**: è‡ªå®šä¹‰i18næ–¹æ¡ˆ

### CLIæŠ€æœ¯
- **æ¡†æ¶**: Click
- **äº¤äº’**: prompt_toolkit, rich
- **é…ç½®**: Keyringï¼ˆå®‰å…¨å­˜å‚¨ï¼‰

## ğŸ“Š æ•°æ®å­˜å‚¨

### MySQLæ•°æ®åº“
é¡¹ç›®ä½¿ç”¨MySQLä½œä¸ºä¸»æ•°æ®åº“ï¼Œé€šè¿‡æ•°æ®åº“æŠ½è±¡å±‚æ”¯æŒSQLiteå…¼å®¹ã€‚

**ä¸»è¦è¡¨ç»“æ„**:
- `resource_cache` - èµ„æºæŸ¥è¯¢ç¼“å­˜
- `bill_items` - è´¦å•æ˜ç»†
- `dashboards` - ä»ªè¡¨ç›˜é…ç½®
- `budgets` - é¢„ç®—ç®¡ç†
- `budget_records` - é¢„ç®—æ‰§è¡Œè®°å½•
- `alert_rules` - å‘Šè­¦è§„åˆ™
- `alerts` - å‘Šè­¦è®°å½•
- `virtual_tags` - è™šæ‹Ÿæ ‡ç­¾
- `cost_allocation` - æˆæœ¬åˆ†é…
- ç­‰13+ä¸ªè¡¨

### é…ç½®æ–‡ä»¶
- **ä½ç½®**: `~/.cloudlens/config.json`
- **å†…å®¹**: äº‘è´¦å·é…ç½®ï¼ˆAccessKeyç­‰ï¼‰
- **å®‰å…¨**: æ”¯æŒKeyringåŠ å¯†å­˜å‚¨

## ğŸ” å®‰å…¨è®¾è®¡

1. **å¯†é’¥ç®¡ç†**: ä½¿ç”¨ç³»ç»ŸKeyringï¼Œä¸å­˜å‚¨æ˜æ–‡
2. **æƒé™æ§åˆ¶**: PermissionGuardæ£€æŸ¥APIæƒé™
3. **åªè¯»æ“ä½œ**: CLIé»˜è®¤åªè¯»ï¼Œä¿®å¤æ“ä½œéœ€æ˜ç¡®ç¡®è®¤
4. **å®¡è®¡æ—¥å¿—**: æ‰€æœ‰ä¿®å¤æ“ä½œè®°å½•å®Œæ•´æ—¥å¿—

## ğŸš€ æ‰©å±•æ€§

### æ·»åŠ æ–°äº‘å‚å•†
1. åœ¨ `providers/` ä¸‹åˆ›å»ºæ–°ç›®å½•
2. å®ç° `BaseProvider` æ¥å£
3. æ³¨å†Œåˆ°Providerå·¥å‚

### æ·»åŠ æ–°èµ„æºç±»å‹
1. åœ¨ `resource_modules/` åˆ›å»ºåˆ†æå™¨
2. å®ç° `BaseResourceAnalyzer` æ¥å£
3. æ³¨å†Œåˆ°åˆ†æå™¨æ³¨å†Œè¡¨

### æ·»åŠ æ–°åˆ†æåŠŸèƒ½
1. åœ¨ `core/` åˆ›å»ºåˆ†ææ¨¡å—
2. åœ¨ `cli/commands/analyze_cmd.py` æ·»åŠ å‘½ä»¤
3. åœ¨ `web/backend/api.py` æ·»åŠ APIç«¯ç‚¹

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- Python: éµå¾ªPEP 8
- TypeScript: éµå¾ªESLintè§„åˆ™
- ä½¿ç”¨ç±»å‹æç¤ºï¼ˆPythonï¼‰å’ŒTypeScriptç±»å‹

### æµ‹è¯•
- å•å…ƒæµ‹è¯•: `tests/` ç›®å½•
- è¿è¡Œæµ‹è¯•: `pytest tests/`

### æ–‡æ¡£
- APIæ–‡æ¡£: FastAPIè‡ªåŠ¨ç”Ÿæˆï¼ˆ`/docs`ï¼‰
- ä»£ç æ³¨é‡Š: ä½¿ç”¨docstring
- ç”¨æˆ·æ–‡æ¡£: `docs/` ç›®å½•

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†

- **ä¸»ç‰ˆæœ¬**: é‡å¤§æ¶æ„å˜æ›´
- **æ¬¡ç‰ˆæœ¬**: æ–°åŠŸèƒ½æ·»åŠ 
- **ä¿®è®¢ç‰ˆæœ¬**: Bugä¿®å¤å’Œå°æ”¹è¿›

å½“å‰ç‰ˆæœ¬: **v2.1.0**

---

**æœ€åæ›´æ–°**: 2025-01-XX

