# 📊 CloudLens 折扣分析功能 - 快速上手

> ⏱️ 5分钟完成配置，立即使用Web折扣分析

---

## 🚀 3步开始使用

### 第1步: 启动服务（10秒）

```bash
# 进入项目目录
cd /path/to/aliyunidle

# 一键启动（后端+前端）
./start_web.sh
```

**或者手动启动**:
```bash
# 终端1: 后端（保持运行）
cd web/backend && python3 run.py

# 终端2: 前端（保持运行）
cd web/frontend && npm run dev
```

等待提示"Ready"出现。

---

### 第2步: 访问页面（1秒）

打开浏览器，访问：
```
http://localhost:3000/discounts
```

如果端口被占用，使用：
```
http://localhost:3001/discounts
```

---

### 第3步: 查看分析（1秒）

页面自动显示：
- ✅ 4个核心指标卡片
- ✅ 折扣率趋势图
- ✅ 产品/合同/实例分析

如需最新数据，点击"强制刷新"（60-90秒）

---

## 📊 页面功能一览

```
┌─────────────────────────────────────────────────────────┐
│              折扣趋势分析页面                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [核心指标卡片 x4]                                      │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐              │
│  │57.43% │ │52.68% │ │ 上升  │ │¥258万 │              │
│  │最新   │ │平均   │ │趋势   │ │节省   │              │
│  └───────┘ └───────┘ └───────┘ └───────┘              │
│                                                         │
│  [Tab导航]                                              │
│  [ 趋势总览 ] [ 产品分析 ] [ 合同分析 ] [ TOP实例 ]    │
│                                                         │
│  [折扣率趋势图] ～～～～～～～～～～～                   │
│      📈 折线图展示6个月变化                             │
│                                                         │
│  [折扣金额对比图] ████ ████                             │
│      柱状图 + 折线图组合                                │
│                                                         │
│  [产品折扣表格]                                         │
│  ┌──────┬────────┬─────────┬─────┐                    │
│  │ 产品 │ 累计   │ 折扣率  │ 趋势│                    │
│  │ ECS  │ ¥141万 │ 57.69%  │ 📈  │                    │
│  └──────┴────────┴─────────┴─────┘                    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 💡 核心功能

### ✅ 已集成的功能

| 功能 | CLI | Web | 说明 |
|------|-----|-----|------|
| 折扣趋势分析 | ✅ | ✅ | 6个月历史趋势 |
| 产品维度分析 | ✅ | ✅ | TOP 20产品 |
| 合同维度分析 | ✅ | ✅ | TOP 10合同 |
| 实例维度分析 | ✅ | ✅ | TOP 50实例 |
| 可视化图表 | 🚧 | ✅ | Recharts交互式图表 |
| Excel导出 | ✅ | 🚧 | CLI导出功能 |
| HTML报告 | ✅ | - | CLI生成ECharts报告 |
| 缓存优化 | ✅ | ✅ | 24h TTL, 90倍提升 |

---

## 🎯 使用场景

### 场景1: 商务合同续签评估

```bash
# 1. Web查看趋势
浏览器访问 /discounts
切换到"合同分析"Tab
查看各合同效果

# 2. CLI导出Excel
./cl analyze discount --export --format excel

# 3. 准备谈判材料
基于累计节省和折扣率数据
```

### 场景2: 月度成本优化会议

```bash
# 1. 更新账单数据
下载最新月份的CSV
放入账单目录

# 2. Web展示
访问 /discounts
点击"强制刷新"
截图关键数据

# 3. 识别优化机会
切换到"产品分析"
找出低折扣产品
制定优化计划
```

### 场景3: 日常折扣监控

```bash
# 每月1号例行检查
访问 /discounts
查看"最新折扣率"
查看"折扣率变化"

# 如果下降 > 5%
→ 立即与商务沟通
→ 排查原因
→ 制定应对方案
```

---

## 🛠️ 常见问题

### Q1: 页面显示"暂无数据"？

**原因**: 账单CSV目录不存在

**解决**:
```bash
# 检查账单目录
ls -la 1844634015852583-*/

# 如果不存在，下载并放置账单CSV
# 详见: docs/DISCOUNT_ANALYSIS_GUIDE.md
```

### Q2: 端口3000被占用？

**症状**: "Port 3000 is in use"

**解决**: Next.js会自动使用3001或3002端口，访问对应端口即可

### Q3: 图表不显示？

**原因**: recharts未安装或版本问题

**解决**:
```bash
cd web/frontend
npm install recharts
npm run dev
```

---

## 📚 延伸阅读

- **详细使用指南**: docs/DISCOUNT_ANALYSIS_GUIDE.md
- **Web集成文档**: WEB_DISCOUNT_INTEGRATION.md
- **项目深度梳理**: PROJECT_DEEP_ANALYSIS.md
- **CLI命令帮助**: `./cl analyze discount --help`

---

## 🎉 完成状态

✅ 后端API就绪  
✅ 前端页面完成  
✅ 导航栏已添加  
✅ 真实数据验证  
✅ 性能优化完成  
✅ 文档已完善  

**立即访问**: http://localhost:3000/discounts

---

**最后更新**: 2025-12-15  
**功能状态**: ✅ 完整集成到Web产品
