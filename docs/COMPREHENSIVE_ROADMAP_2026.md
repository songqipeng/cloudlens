# CloudLens ç»¼åˆå‘å±•è§„åˆ’ 2026

**åˆ¶å®šæ—¥æœŸ**: 2026-01-08
**ç‰ˆæœ¬**: 3.0.0
**è§„åˆ’å‘¨æœŸ**: 2026å¹´å…¨å¹´

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç°çŠ¶æ€»è§ˆ](#é¡¹ç›®ç°çŠ¶æ€»è§ˆ)
2. [äº§å“æˆ˜ç•¥è§„åˆ’](#äº§å“æˆ˜ç•¥è§„åˆ’)
3. [æŠ€æœ¯æ¶æ„è§„åˆ’](#æŠ€æœ¯æ¶æ„è§„åˆ’)
4. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)
5. [èµ„æºæŠ•å…¥ä¸é£é™©è¯„ä¼°](#èµ„æºæŠ•å…¥ä¸é£é™©è¯„ä¼°)
6. [æˆåŠŸåº¦é‡æŒ‡æ ‡](#æˆåŠŸåº¦é‡æŒ‡æ ‡)

---

## ğŸ“Š é¡¹ç›®ç°çŠ¶æ€»è§ˆ

### ä»£ç è§„æ¨¡
- **åç«¯**: 195ä¸ªPythonæ–‡ä»¶ï¼Œ62,129è¡Œä»£ç 
- **å‰ç«¯**: 127ä¸ªTypeScriptæ–‡ä»¶ï¼Œ20,257è¡Œä»£ç 
- **æµ‹è¯•**: 19ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œè¦†ç›–æ ¸å¿ƒæ¨¡å—93%

### æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ

| èƒ½åŠ›åŸŸ | æˆç†Ÿåº¦ | æ ¸å¿ƒåŠŸèƒ½ | å¾…æå‡ç‚¹ |
|--------|--------|----------|----------|
| **å¤šäº‘ç®¡ç†** | â­â­â­â­â­ | é˜¿é‡Œäº‘/è…¾è®¯äº‘ç»Ÿä¸€ç®¡ç† | AWS/Azureæ”¯æŒ |
| **æˆæœ¬åˆ†æ** | â­â­â­â­ | è¶‹åŠ¿/é¢„æµ‹/æŠ˜æ‰£åˆ†æ | å¤šç»´åº¦åˆ†æã€å¼‚å¸¸æ£€æµ‹ |
| **å®‰å…¨åˆè§„** | â­â­â­â­â­ | CIS 40é¡¹æ£€æŸ¥ã€æ¼æ´æ‰«æ | è‡ªåŠ¨ä¿®å¤å¢å¼º |
| **è‡ªåŠ¨åŒ–** | â­â­â­ | æ‰¹é‡æ ‡ç­¾ã€å®šæ—¶ä»»åŠ¡ | å·¥ä½œæµç¼–æ’ã€å®¡æ‰¹æµ |
| **åä½œèƒ½åŠ›** | â­â­ | å•ç”¨æˆ·æ¨¡å¼ | å¤šç”¨æˆ·ã€RBACã€å›¢é˜Ÿåä½œ |
| **é›†æˆèƒ½åŠ›** | â­â­â­ | REST API | Webhookã€é€šçŸ¥é›†æˆ |
| **å¯è§‚æµ‹æ€§** | â­â­ | ç»“æ„åŒ–æ—¥å¿— | Metricsã€Tracingã€APM |

### æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

| å€ºåŠ¡ç±»å‹ | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å·¥ä½œé‡ä¼°ç®— |
|----------|----------|----------|------------|
| APIå•æ–‡ä»¶è¿‡å¤§(3922è¡Œ) | å¼€å‘æ•ˆç‡ã€ä»£ç å®¡æŸ¥ | ğŸ”´ é«˜ | 5äººæ—¥ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä»£ç è´¨é‡ã€å›å½’é£é™© | ğŸŸ  ä¸­ | 15äººæ—¥ |
| ç›‘æ§ç¼ºå¤± | è¿ç»´æ•ˆç‡ã€é—®é¢˜å®šä½ | ğŸ”´ é«˜ | 8äººæ—¥ |
| æ–‡æ¡£ä¸å®Œæ•´ | æ–°äººä¸Šæ‰‹ã€ç»´æŠ¤æˆæœ¬ | ğŸŸ¡ ä½ | 10äººæ—¥ |
| ç¼“å­˜å±‚å•ä¸€ | æ€§èƒ½ç“¶é¢ˆ | ğŸŸ  ä¸­ | 6äººæ—¥ |

---

## ğŸ¯ äº§å“æˆ˜ç•¥è§„åˆ’

### ä¸€ã€äº§å“å®šä½ä¸ç›®æ ‡ç”¨æˆ·

#### å½“å‰å®šä½
**ä¼ä¸šçº§å¤šäº‘èµ„æºæ²»ç†ä¸æˆæœ¬ä¼˜åŒ–å¹³å°**

#### ç›®æ ‡ç”¨æˆ·ç”»åƒ

1. **äº‘æ¶æ„å¸ˆ** (40%)
   - ç—›ç‚¹: å¤šäº‘ç¯å¢ƒå¤æ‚ï¼Œç¼ºä¹ç»Ÿä¸€è§†å›¾
   - éœ€æ±‚: èµ„æºå¯è§†åŒ–ã€æ¶æ„åˆè§„æ£€æŸ¥ã€æˆæœ¬ä¼˜åŒ–å»ºè®®

2. **FinOpså·¥ç¨‹å¸ˆ** (35%)
   - ç—›ç‚¹: æˆæœ¬è¶…æ”¯ã€é¢„ç®—éš¾ä»¥æ§åˆ¶
   - éœ€æ±‚: ç²¾å‡†æˆæœ¬åˆ†æã€é¢„ç®—ç®¡ç†ã€å¼‚å¸¸å‘Šè­¦

3. **å®‰å…¨åˆè§„å›¢é˜Ÿ** (15%)
   - ç—›ç‚¹: åˆè§„æ£€æŸ¥è€—æ—¶ã€æ¼æ´éš¾ä»¥åŠæ—¶å‘ç°
   - éœ€æ±‚: è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥ã€å®‰å…¨æ‰«æã€ä¿®å¤å»ºè®®

4. **ITç®¡ç†è€…** (10%)
   - ç—›ç‚¹: ç¼ºä¹å…¨å±€è§†è§’ã€å†³ç­–ä¾æ®ä¸è¶³
   - éœ€æ±‚: ç®¡ç†æŠ¥å‘Šã€è¶‹åŠ¿åˆ†æã€ROIè¯„ä¼°

### äºŒã€äº§å“åŠŸèƒ½è§„åˆ’

#### Q1 2026: ç”¨æˆ·ä½“éªŒä¸æ ¸å¿ƒåŠŸèƒ½å¢å¼º

##### 1. å®æ—¶æ•°æ®åˆ·æ–°ç³»ç»Ÿ â­â­â­â­â­

**ç›®æ ‡**: æå‡ç”¨æˆ·æ“ä½œæ•ˆç‡40%ï¼Œé™ä½æ‰‹åŠ¨åˆ·æ–°é¢‘æ¬¡

**åŠŸèƒ½è®¾è®¡**:
```
å®æ—¶åˆ·æ–°æ§åˆ¶é¢æ¿
â”œâ”€â”€ è‡ªåŠ¨åˆ·æ–°å¼€å…³
â”‚   â”œâ”€â”€ 30ç§’åˆ·æ–° (é«˜é¢‘ç›‘æ§åœºæ™¯)
â”‚   â”œâ”€â”€ 1åˆ†é’Ÿåˆ·æ–° (æ—¥å¸¸ç›‘æ§)
â”‚   â”œâ”€â”€ 5åˆ†é’Ÿåˆ·æ–° (é•¿æœŸè§‚å¯Ÿ)
â”‚   â””â”€â”€ æ‰‹åŠ¨åˆ·æ–°
â”œâ”€â”€ WebSocketæ¨é€
â”‚   â”œâ”€â”€ æˆæœ¬å¼‚å¸¸äº‹ä»¶æ¨é€
â”‚   â”œâ”€â”€ å®‰å…¨å‘Šè­¦å®æ—¶æ¨é€
â”‚   â””â”€â”€ èµ„æºçŠ¶æ€å˜æ›´æ¨é€
â””â”€â”€ åå°é™é»˜æ›´æ–°
    â”œâ”€â”€ å¢é‡æ•°æ®æ›´æ–°
    â”œâ”€â”€ å·®å¼‚é«˜äº®æ˜¾ç¤º
    â””â”€â”€ ç”¨æˆ·æ— æ„ŸçŸ¥åˆ·æ–°
```

**æŠ€æœ¯æ–¹æ¡ˆ**:
- **å‰ç«¯**: Server-Sent Events (SSE) æˆ– WebSocket
- **åç«¯**: FastAPI WebSocket endpoint + Redis Pub/Sub
- **ä¼˜åŒ–**: å¢é‡æ›´æ–°ï¼Œåªä¼ è¾“å˜æ›´æ•°æ®

**å®æ–½æ­¥éª¤**:
1. Week 1: åç«¯WebSocketæœåŠ¡å®ç°
2. Week 2: å‰ç«¯å®æ—¶æ›´æ–°ç»„ä»¶å¼€å‘
3. Week 3: å¢é‡æ•°æ®å·®å¼‚è®¡ç®—
4. Week 4: å‹åŠ›æµ‹è¯•ä¸ä¼˜åŒ–

**é¢„æœŸæ”¶ç›Š**:
- ç”¨æˆ·æ“ä½œæ•ˆç‡ â†‘ 40%
- æ•°æ®æ—¶æ•ˆæ€§ â†‘ 90%
- æ‰‹åŠ¨åˆ·æ–°æ¬¡æ•° â†“ 70%

---

##### 2. æˆæœ¬è¶‹åŠ¿å›¾æ™ºèƒ½å¢å¼º â­â­â­â­

**å½“å‰é—®é¢˜**:
- âœ… å·²ä¿®å¤: é»˜è®¤æ˜¾ç¤ºæœˆåº¦æŸ±çŠ¶å›¾
- âŒ ç¼ºå°‘åŒæ¯”/ç¯æ¯”åˆ‡æ¢
- âŒ æ— æ³•è¿›è¡Œå¤šè´¦å·å¯¹æ¯”
- âŒ ç¼ºå°‘æ•°æ®é’»å–èƒ½åŠ›

**ä¼˜åŒ–æ–¹æ¡ˆ**:

**2.1 å¯¹æ¯”æ¨¡å¼**:
```typescript
// å¯¹æ¯”è§†å›¾æšä¸¾
enum ComparisonMode {
  MONTH_OVER_MONTH = "mom",  // ç¯æ¯” (å½“æœˆ vs ä¸Šæœˆ)
  YEAR_OVER_YEAR = "yoy",    // åŒæ¯” (ä»Šå¹´ vs å»å¹´)
  QUARTER_OVER_QUARTER = "qoq", // å­£åº¦å¯¹æ¯”
  MULTI_ACCOUNT = "multi"    // å¤šè´¦å·å¯¹æ¯”
}
```

**2.2 æ•°æ®é’»å–**:
- ç‚¹å‡»æœˆåº¦æŸ±çŠ¶å›¾ â†’ å±•å¼€æ¯æ—¥è¯¦æƒ…
- ç‚¹å‡»äº§å“åˆ†ç±» â†’ å±•å¼€å­äº§å“æ˜ç»†
- ç‚¹å‡»å®ä¾‹ â†’ æŸ¥çœ‹å®ä¾‹æˆæœ¬è¶‹åŠ¿

**2.3 æ™ºèƒ½æ´å¯Ÿ**:
```
ğŸ’¡ æ™ºèƒ½æ´å¯Ÿé¢æ¿
â”œâ”€â”€ æˆæœ¬å˜åŒ–åŸå› åˆ†æ
â”‚   â”œâ”€â”€ "æœ¬æœˆæˆæœ¬ä¸Šæ¶¨23%ï¼Œä¸»è¦ç”±äºECSå®ä¾‹å¢åŠ 15å°"
â”‚   â”œâ”€â”€ "æŠ˜æ‰£ç‡ä¸‹é™5%ï¼Œå»ºè®®ç»­è´¹ä¼˜åŒ–"
â”‚   â””â”€â”€ "æµé‡è´¹ç”¨å¼‚å¸¸å¢é•¿ï¼Œå»ºè®®æ£€æŸ¥CDNé…ç½®"
â”œâ”€â”€ é¢„æµ‹ä¸å»ºè®®
â”‚   â”œâ”€â”€ "æŒ‰å½“å‰è¶‹åŠ¿ï¼Œæœ¬æœˆå°†è¶…é¢„ç®—12%"
â”‚   â””â”€â”€ "å»ºè®®åœ¨15å·å‰æ‰§è¡Œæˆæœ¬ä¼˜åŒ–åŠ¨ä½œ"
â””â”€â”€ å¯¹æ¯”æ•°æ®
    â”œâ”€â”€ "åŒæ¯”å»å¹´åŒæœŸå¢é•¿18%"
    â””â”€â”€ "ç¯æ¯”ä¸Šæœˆä¸‹é™5%"
```

**UIè®¾è®¡**:
```
[å›¾è¡¨å·¥å…·æ ]
[æœˆåº¦â–¼] [ç¯æ¯”â—‹ åŒæ¯”â—‹ å¤šè´¦å·â—‹] [å¯¼å‡ºâ–¼] [å…¨å±â›¶]

[æŠ˜çº¿å›¾/æŸ±çŠ¶å›¾åŒºåŸŸ]
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æˆæœ¬è¶‹åŠ¿ (2025-01 ~ 2026-01)  â”‚
  â”‚                                â”‚
  â”‚  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”ƒ  â”‚
  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
  â”‚  Jan Feb Mar Apr May Jun Jul   â”‚
  â”‚                                â”‚
  â”‚  ğŸ’¡ æœ¬æœˆæˆæœ¬ç¯æ¯”â†‘23%           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[æ•°æ®è¡¨æ ¼] (å¯é’»å–)
```

---

##### 3. å¿«æ·å¯¼å‡ºä¸æ‰¹é‡æ“ä½œ â­â­â­â­

**3.1 ä¸€é”®å¯¼å‡º**:
```
å¯¼å‡ºæŒ‰é’®èœå•
â”œâ”€â”€ å¯¼å‡ºå½“å‰è§†å›¾ (CSV)
â”œâ”€â”€ å¯¼å‡ºå½“å‰è§†å›¾ (Excel)
â”œâ”€â”€ å¯¼å‡ºè¯¦ç»†æŠ¥å‘Š (HTML)
â”œâ”€â”€ å¯¼å‡ºAPIæ•°æ® (JSON)
â””â”€â”€ è‡ªå®šä¹‰å¯¼å‡º
    â”œâ”€â”€ é€‰æ‹©å­—æ®µ
    â”œâ”€â”€ é€‰æ‹©æ—¶é—´èŒƒå›´
    â””â”€â”€ é€‰æ‹©æ ¼å¼
```

**3.2 æ‰¹é‡æ“ä½œå·¥å…·æ **:
```
[å·²é€‰æ‹© 15 ä¸ªå®ä¾‹] [å–æ¶ˆé€‰æ‹©]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ‰¹é‡æ‰“æ ‡ç­¾] [æ‰¹é‡åœæœº] [æ‰¹é‡ç»­è´¹] â”‚
â”‚ [æ‰¹é‡ä¿®æ”¹è§„æ ¼] [æ‰¹é‡åˆ é™¤] [æ›´å¤šâ–¼] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3.3 æ“ä½œå†å²ä¸å›æ»š**:
- è®°å½•æ‰€æœ‰æ‰¹é‡æ“ä½œ
- æ”¯æŒæ“ä½œå›æ»šï¼ˆå¹²è¿è¡Œé¢„è§ˆï¼‰
- æ“ä½œå®¡è®¡æ—¥å¿—

---

##### 4. ç§»åŠ¨ç«¯è‡ªé€‚åº”ä¼˜åŒ– â­â­â­

**è®¾è®¡åŸåˆ™**:
- **å†…å®¹ä¼˜å…ˆ**: ç§»åŠ¨ç«¯éšè—æ¬¡è¦ä¿¡æ¯
- **è§¦æ‘¸å‹å¥½**: æŒ‰é’®æœ€å°44x44px
- **æ€§èƒ½ä¼˜å…ˆ**: å›¾è¡¨æ‡’åŠ è½½

**ç§»åŠ¨ç«¯ä¸“ç”¨ç»„ä»¶**:
```typescript
// ç§»åŠ¨ç«¯é€‚é…Hook
const { isMobile, isTablet } = useResponsive()

// ç§»åŠ¨ç«¯ç®€åŒ–å¡ç‰‡
<MobileCostCard
  title="æœ¬æœˆæˆæœ¬"
  value={12345}
  trend="+23%"
  sparkline={data}
/>

// ç§»åŠ¨ç«¯æŠ½å±‰èœå•
<MobileDrawer>
  <NavMenu />
</MobileDrawer>
```

**è§¦æ‘¸æ‰‹åŠ¿**:
- å·¦å³æ»‘åŠ¨åˆ‡æ¢Tab
- ä¸‹æ‹‰åˆ·æ–°
- é•¿æŒ‰æ˜¾ç¤ºæ“ä½œèœå•

---

#### Q2 2026: æ•°æ®åˆ†æèƒ½åŠ›æ·±åŒ–

##### 5. å¤šç»´åº¦æˆæœ¬åˆ†æ â­â­â­â­â­

**5.1 åˆ†æç»´åº¦çŸ©é˜µ**:

| ç»´åº¦ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | ç¤ºä¾‹æŸ¥è¯¢ |
|------|---------|----------|----------|
| æŒ‰äº§å“ | âœ… å·²å®ç° | å¢å¼º | "ECSæœ¬æœˆæˆæœ¬Â¥12,345" |
| æŒ‰åŒºåŸŸ | âš ï¸ éƒ¨åˆ†å®ç° | å®Œå–„ | "åä¸œ1åŒºæˆæœ¬å æ¯”45%" |
| æŒ‰æ ‡ç­¾ | âœ… å·²å®ç° | å¢å¼º | "é¡¹ç›®Aæˆæœ¬Â¥8,000" |
| æŒ‰éƒ¨é—¨ | âŒ æœªå®ç° | æ–°å¢ | "ç ”å‘éƒ¨é—¨å æ¯”60%" |
| æŒ‰ç¯å¢ƒ | âŒ æœªå®ç° | æ–°å¢ | "ç”Ÿäº§ç¯å¢ƒ vs æµ‹è¯•ç¯å¢ƒ" |
| æŒ‰å®ä¾‹ | âœ… å·²å®ç° | å¢å¼º | "Top 10 é«˜æˆæœ¬å®ä¾‹" |
| æŒ‰æ—¶é—´ | âœ… å·²å®ç° | å¢å¼º | "å·¥ä½œæ—¥ vs å‘¨æœ«" |

**5.2 æˆæœ¬åˆ†é…å¼•æ“**:
```python
# æˆæœ¬åˆ†é…è§„åˆ™ç¤ºä¾‹
class CostAllocationRule:
    """
    æˆæœ¬åˆ†é…è§„åˆ™å®šä¹‰
    """
    def __init__(self, rule_config):
        self.dimensions = rule_config['dimensions']  # ['department', 'project', 'env']
        self.allocation_method = rule_config['method']  # 'tag', 'equal', 'proportional'
        self.fallback_rule = rule_config['fallback']  # 'shared_pool', 'unallocated'

    def allocate_cost(self, resource, cost):
        """
        æ ¹æ®è§„åˆ™åˆ†é…æˆæœ¬
        """
        # æŒ‰æ ‡ç­¾åˆ†é…
        if self.allocation_method == 'tag':
            return self._allocate_by_tags(resource, cost)

        # æŒ‰æ¯”ä¾‹åˆ†é…
        elif self.allocation_method == 'proportional':
            return self._allocate_proportional(resource, cost)

        # å¹³å‡åˆ†é…
        elif self.allocation_method == 'equal':
            return self._allocate_equally(resource, cost)

# ä½¿ç”¨ç¤ºä¾‹
allocator = CostAllocator(rules=[
    {
        "dimensions": ["department", "project"],
        "method": "tag",
        "fallback": "shared_pool"
    }
])

allocated_costs = allocator.allocate_all_resources(resources, costs)
```

**5.3 æˆæœ¬å½’å› åˆ†æ**:
```
æˆæœ¬å½’å› æŠ¥å‘Š
â”œâ”€â”€ ç›´æ¥æˆæœ¬ (75%)
â”‚   â”œâ”€â”€ ECS: Â¥10,000 (éƒ¨é—¨A: 60%, éƒ¨é—¨B: 40%)
â”‚   â”œâ”€â”€ RDS: Â¥5,000 (é¡¹ç›®X: 100%)
â”‚   â””â”€â”€ OSS: Â¥2,000 (æŒ‰å­˜å‚¨é‡åˆ†é…)
â”œâ”€â”€ å…±äº«æˆæœ¬ (20%)
â”‚   â”œâ”€â”€ VPC: Â¥1,500 (æŒ‰æµé‡æ¯”ä¾‹åˆ†é…)
â”‚   â”œâ”€â”€ SLB: Â¥1,000 (æŒ‰å®ä¾‹æ•°åˆ†é…)
â”‚   â””â”€â”€ DNS: Â¥500 (å¹³å‡åˆ†é…)
â””â”€â”€ æœªåˆ†é…æˆæœ¬ (5%)
    â””â”€â”€ ç¼ºå°‘æ ‡ç­¾çš„èµ„æº: Â¥800
```

---

##### 6. å¼‚å¸¸æ£€æµ‹ä¸æ™ºèƒ½å‘Šè­¦ â­â­â­â­â­

**6.1 å¼‚å¸¸æ£€æµ‹ç®—æ³•**:

```python
class AnomalyDetector:
    """
    å¤šç®—æ³•èåˆçš„å¼‚å¸¸æ£€æµ‹å™¨
    """

    def __init__(self):
        self.detectors = [
            StatisticalDetector(),   # ç»Ÿè®¡æ–¹æ³• (3ÏƒåŸåˆ™)
            TimeSeriesDetector(),    # æ—¶åºåˆ†æ (Prophet)
            MachineLearningDetector() # MLæ–¹æ³• (Isolation Forest)
        ]

    def detect_cost_anomaly(self, cost_history):
        """
        æ£€æµ‹æˆæœ¬å¼‚å¸¸
        """
        anomalies = []

        for detector in self.detectors:
            result = detector.detect(cost_history)
            anomalies.extend(result)

        # å¤šç®—æ³•æŠ•ç¥¨æœºåˆ¶
        confirmed_anomalies = self._consensus_voting(anomalies)

        return self._rank_by_severity(confirmed_anomalies)

    def _consensus_voting(self, anomalies):
        """
        å¤šç®—æ³•å…±è¯†æŠ•ç¥¨
        å¦‚æœ3ä¸ªç®—æ³•ä¸­è‡³å°‘2ä¸ªæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œåˆ™ç¡®è®¤ä¸ºå¼‚å¸¸
        """
        anomaly_votes = defaultdict(int)
        for anomaly in anomalies:
            anomaly_votes[anomaly.timestamp] += 1

        return [a for a in anomalies if anomaly_votes[a.timestamp] >= 2]
```

**6.2 å¼‚å¸¸ç±»å‹å®šä¹‰**:

| å¼‚å¸¸ç±»å‹ | æ£€æµ‹é€»è¾‘ | ä¸¥é‡ç¨‹åº¦ | å¤„ç†å»ºè®® |
|----------|----------|----------|----------|
| **æˆæœ¬çªå¢** | å•æ—¥æˆæœ¬è¶…è¿‡30å¤©å‡å€¼2å€ | ğŸ”´ é«˜ | ç«‹å³æ’æŸ¥æ–°å¢èµ„æº |
| **å¼‚å¸¸è´¦å•** | å•ä¸ªè´¦å•é¡¹è¶…è¿‡å†å²æœ€å¤§å€¼150% | ğŸŸ  ä¸­ | ç¡®è®¤è®¡è´¹è§„åˆ™å˜æ›´ |
| **æŠ˜æ‰£å¼‚å¸¸** | æŠ˜æ‰£ç‡ä½äºå†å²å‡å€¼20% | ğŸŸ¡ ä½ | æ£€æŸ¥åˆåŒåˆ°æœŸæƒ…å†µ |
| **æµé‡å¼‚å¸¸** | æµé‡è´¹ç”¨å¼‚å¸¸å¢é•¿ | ğŸ”´ é«˜ | æ£€æŸ¥æ˜¯å¦è¢«æ”»å‡»/ç›—åˆ· |
| **é—²ç½®èµ„æºå¢åŠ ** | é—²ç½®èµ„æºæ•°é‡å¢åŠ 50% | ğŸŸ  ä¸­ | æ‰§è¡Œèµ„æºæ¸…ç† |
| **é¢„ç®—è¶…æ”¯é£é™©** | å½“å‰æ¶ˆè€—é€Ÿç‡å°†å¯¼è‡´æœˆåº•è¶…æ”¯ | ğŸŸ  ä¸­ | ç«‹å³æ‰§è¡Œæˆæœ¬æ§åˆ¶ |

**6.3 æ™ºèƒ½å‘Šè­¦è·¯ç”±**:
```yaml
# å‘Šè­¦è·¯ç”±é…ç½®
alert_routing:
  - name: "æˆæœ¬çªå¢å‘Šè­¦"
    conditions:
      - type: "cost_spike"
        severity: ["critical", "high"]
    channels:
      - type: "webhook"
        url: "https://hooks.slack.com/..."
      - type: "email"
        recipients: ["finops@company.com"]
      - type: "sms"
        phones: ["+86138****"]
    throttling:
      interval: "1h"  # 1å°æ—¶å†…ç›¸åŒå‘Šè­¦åªå‘é€ä¸€æ¬¡

  - name: "å®‰å…¨å‘Šè­¦"
    conditions:
      - type: "security_issue"
        severity: ["critical"]
    channels:
      - type: "pagerduty"
        integration_key: "xxx"
      - type: "webhook"
        url: "https://hooks.slack.com/security"
    escalation:
      - level: 1
        delay: "5m"
        channels: ["oncall_engineer"]
      - level: 2
        delay: "15m"
        channels: ["security_manager"]
```

---

##### 7. AIæˆæœ¬é¢„æµ‹å¢å¼º â­â­â­â­

**7.1 å¤šæ¨¡å‹å¯¹æ¯”**:

```python
class EnhancedCostPredictor:
    """
    å¢å¼ºç‰ˆæˆæœ¬é¢„æµ‹å™¨ï¼Œæ”¯æŒå¤šæ¨¡å‹å¯¹æ¯”
    """

    def __init__(self):
        self.models = {
            'prophet': ProphetModel(),      # Facebook Prophet (æ—¶åº)
            'lstm': LSTMModel(),            # LSTMç¥ç»ç½‘ç»œ
            'linear': LinearModel(),        # çº¿æ€§å›å½’ (åŸºå‡†)
            'arima': ARIMAModel(),          # ARIMA (ä¼ ç»Ÿæ—¶åº)
            'ensemble': EnsembleModel()     # é›†æˆæ¨¡å‹
        }

    def predict_with_confidence(self, history, days=90):
        """
        é¢„æµ‹æœªæ¥æˆæœ¬ï¼ŒåŒ…å«ç½®ä¿¡åŒºé—´
        """
        predictions = {}

        for name, model in self.models.items():
            result = model.predict(history, days)
            predictions[name] = {
                'forecast': result.forecast,
                'lower_bound': result.lower_bound,  # 95%ç½®ä¿¡åŒºé—´ä¸‹ç•Œ
                'upper_bound': result.upper_bound,  # 95%ç½®ä¿¡åŒºé—´ä¸Šç•Œ
                'accuracy': result.accuracy_score,
                'mape': result.mape  # å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®
            }

        # é€‰æ‹©æœ€ä½³æ¨¡å‹
        best_model = self._select_best_model(predictions)

        return {
            'recommended_model': best_model,
            'all_predictions': predictions,
            'ensemble_prediction': self._ensemble_predict(predictions)
        }
```

**7.2 åœºæ™¯é¢„æµ‹**:
```
åœºæ™¯é¢„æµ‹å·¥å…·
â”œâ”€â”€ åŸºå‡†åœºæ™¯ (å½“å‰è¶‹åŠ¿)
â”‚   â””â”€â”€ "æŒ‰å½“å‰è¶‹åŠ¿ï¼Œ3ä¸ªæœˆåæˆæœ¬ä¸ºÂ¥45,000"
â”œâ”€â”€ ä¼˜åŒ–åœºæ™¯ (æ‰§è¡Œå»ºè®®å)
â”‚   â””â”€â”€ "æ‰§è¡Œä¼˜åŒ–å»ºè®®åï¼Œé¢„è®¡èŠ‚çœÂ¥8,000 (18%)"
â”œâ”€â”€ æ‰©å®¹åœºæ™¯ (èµ„æºå¢é•¿)
â”‚   â”œâ”€â”€ "å¢åŠ 20%èµ„æºï¼Œæˆæœ¬é¢„è®¡Â¥52,000"
â”‚   â””â”€â”€ "å»ºè®®é‡‡ç”¨é¢„ç•™å®ä¾‹ï¼Œå¯èŠ‚çœÂ¥3,000"
â””â”€â”€ What-ifåˆ†æ
    â”œâ”€â”€ "å¦‚æœæŠ˜æ‰£ç‡é™ä½10%ï¼Œæˆæœ¬å°†å¢åŠ Â¥5,000"
    â””â”€â”€ "å¦‚æœè¿ç§»åˆ°æŒ‰é‡ä»˜è´¹ï¼Œæˆæœ¬å°†å¢åŠ Â¥12,000"
```

**7.3 é¢„æµ‹å¯è§†åŒ–**:
```
[æˆæœ¬é¢„æµ‹å›¾è¡¨]
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æˆæœ¬é¢„æµ‹ (æœªæ¥90å¤©)                â”‚
  â”‚                                    â”‚
  â”‚  â†‘                    â•±â”â”â”â” ä¸Šç•Œ  â”‚
  â”‚  â”‚                â•±â”â”â”             â”‚
  â”‚  â”‚            â•±â”â”â” é¢„æµ‹å€¼          â”‚
  â”‚  â”‚        â•±â”â”â”                     â”‚
  â”‚  â”‚    â•±â”â”â”â”â”â”â”â”â”â”â”â”â”â” ä¸‹ç•Œ        â”‚
  â”‚  â”‚â”â”â”â”    å†å²æ•°æ®                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â†’ â”‚
  â”‚       è¿‡å»30å¤©  ä»Šå¤©   æœªæ¥60å¤©    â”‚
  â”‚                                    â”‚
  â”‚  ğŸ“Š æ¨¡å‹å‡†ç¡®åº¦: 92%               â”‚
  â”‚  ğŸ’¡ å»ºè®®: é‡‡ç”¨Prophetæ¨¡å‹          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Q3 2026: åä½œä¸é›†æˆèƒ½åŠ›å»ºè®¾

##### 8. å¤šç”¨æˆ·ä¸æƒé™ç®¡ç† â­â­â­â­â­

**8.1 ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**:

```python
# ç”¨æˆ·æ¨¡å‹
class User:
    id: int
    username: str
    email: str
    password_hash: str
    role: Role  # Admin, Operator, Viewer
    department: str
    created_at: datetime
    last_login: datetime
    mfa_enabled: bool
    mfa_secret: Optional[str]

# è®¤è¯æµç¨‹
class AuthService:
    def login(self, username, password, mfa_code=None):
        # 1. éªŒè¯ç”¨æˆ·åå¯†ç 
        user = self._verify_credentials(username, password)

        # 2. MFAéªŒè¯ (å¦‚æœå¯ç”¨)
        if user.mfa_enabled:
            if not self._verify_mfa(user, mfa_code):
                raise MFARequiredError()

        # 3. ç”ŸæˆJWT Token
        token = self._generate_jwt(user)

        # 4. è®°å½•ç™»å½•æ—¥å¿—
        self._log_login(user)

        return token
```

**8.2 RBACæƒé™æ¨¡å‹**:

```yaml
# è§’è‰²æƒé™é…ç½®
roles:
  admin:
    description: "ç³»ç»Ÿç®¡ç†å‘˜"
    permissions:
      - "*:*"  # æ‰€æœ‰æƒé™

  finops_manager:
    description: "FinOpsç»ç†"
    permissions:
      - "cost:read"
      - "cost:analyze"
      - "budget:*"
      - "report:*"
      - "account:read"

  security_auditor:
    description: "å®‰å…¨å®¡è®¡å‘˜"
    permissions:
      - "security:*"
      - "compliance:*"
      - "resource:read"
      - "report:generate"

  developer:
    description: "å¼€å‘äººå‘˜"
    permissions:
      - "resource:read"
      - "cost:read"
      - "tag:update"  # åªèƒ½æ›´æ–°æ ‡ç­¾

  viewer:
    description: "æŸ¥çœ‹è€…"
    permissions:
      - "*:read"  # åªè¯»æƒé™

# èµ„æºçº§æƒé™æ§åˆ¶
resource_permissions:
  - resource_type: "account"
    resource_id: "prod-account"
    user: "dev-team"
    permissions: ["read"]  # å¼€å‘å›¢é˜Ÿåªèƒ½æŸ¥çœ‹ç”Ÿäº§è´¦å·

  - resource_type: "account"
    resource_id: "dev-account"
    user: "dev-team"
    permissions: ["read", "update"]  # å¼€å‘è´¦å·å¯ä»¥ä¿®æ”¹
```

**8.3 æƒé™æ£€æŸ¥è£…é¥°å™¨**:
```python
from functools import wraps

def require_permission(permission: str):
    """
    æƒé™æ£€æŸ¥è£…é¥°å™¨
    """
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            # ä»è¯·æ±‚ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·
            current_user = get_current_user()

            # æ£€æŸ¥æƒé™
            if not current_user.has_permission(permission):
                raise PermissionDeniedError(
                    f"User {current_user.username} lacks permission: {permission}"
                )

            # è®°å½•æ“ä½œå®¡è®¡æ—¥å¿—
            await audit_log.log_action(
                user=current_user,
                action=permission,
                resource=args[0] if args else None
            )

            return await func(*args, **kwargs)
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@app.post("/api/accounts/{account_id}/resources/delete")
@require_permission("resource:delete")
async def delete_resource(account_id: str, resource_id: str):
    # æ‰§è¡Œåˆ é™¤é€»è¾‘
    pass
```

**8.4 å®¡è®¡æ—¥å¿—**:
```sql
-- å®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE audit_logs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    username VARCHAR(100),
    action VARCHAR(100) NOT NULL,  -- 'resource:delete', 'budget:update'
    resource_type VARCHAR(50),     -- 'ecs', 'budget', 'account'
    resource_id VARCHAR(255),
    old_value JSON,                -- ä¿®æ”¹å‰çš„å€¼
    new_value JSON,                -- ä¿®æ”¹åçš„å€¼
    ip_address VARCHAR(45),
    user_agent TEXT,
    status ENUM('success', 'failed'),
    error_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_action (action),
    INDEX idx_created_at (created_at)
);
```

---

##### 9. ç¬¬ä¸‰æ–¹é›†æˆä¸é€šçŸ¥ â­â­â­â­

**9.1 é€šçŸ¥æ¸ é“é›†æˆ**:

```python
# é€šçŸ¥æ¸ é“æŠ½è±¡
class NotificationChannel(ABC):
    @abstractmethod
    async def send(self, message: NotificationMessage):
        pass

# Slacké›†æˆ
class SlackChannel(NotificationChannel):
    def __init__(self, webhook_url: str):
        self.webhook_url = webhook_url

    async def send(self, message: NotificationMessage):
        payload = {
            "text": message.title,
            "blocks": [
                {
                    "type": "header",
                    "text": {"type": "plain_text", "text": message.title}
                },
                {
                    "type": "section",
                    "text": {"type": "mrkdwn", "text": message.body}
                },
                {
                    "type": "section",
                    "fields": [
                        {"type": "mrkdwn", "text": f"*Severity:*\n{message.severity}"},
                        {"type": "mrkdwn", "text": f"*Account:*\n{message.account}"}
                    ]
                },
                {
                    "type": "actions",
                    "elements": [
                        {
                            "type": "button",
                            "text": {"type": "plain_text", "text": "View Details"},
                            "url": message.link
                        }
                    ]
                }
            ]
        }

        async with httpx.AsyncClient() as client:
            await client.post(self.webhook_url, json=payload)

# é’‰é’‰é›†æˆ
class DingTalkChannel(NotificationChannel):
    def __init__(self, webhook_url: str, secret: str):
        self.webhook_url = webhook_url
        self.secret = secret

    async def send(self, message: NotificationMessage):
        # è®¡ç®—ç­¾å
        timestamp = str(round(time.time() * 1000))
        sign = self._calculate_sign(timestamp)

        payload = {
            "msgtype": "markdown",
            "markdown": {
                "title": message.title,
                "text": f"### {message.title}\n\n{message.body}\n\n"
                        f"**Severity:** {message.severity}\n\n"
                        f"[æŸ¥çœ‹è¯¦æƒ…]({message.link})"
            }
        }

        url = f"{self.webhook_url}&timestamp={timestamp}&sign={sign}"
        async with httpx.AsyncClient() as client:
            await client.post(url, json=payload)

# ä¼ä¸šå¾®ä¿¡é›†æˆ
class WeChatWorkChannel(NotificationChannel):
    # å®ç°ç•¥...
    pass

# é‚®ä»¶é›†æˆ
class EmailChannel(NotificationChannel):
    # å®ç°ç•¥...
    pass
```

**9.2 Webhookæ”¯æŒ**:

```python
# Webhooké…ç½®
class WebhookConfig:
    url: str
    secret: str  # ç”¨äºHMACç­¾åéªŒè¯
    events: List[str]  # è®¢é˜…çš„äº‹ä»¶ç±»å‹
    retry_policy: RetryPolicy
    timeout: int = 30

# Webhookäº‹ä»¶
class WebhookEvent:
    """
    Webhookäº‹ä»¶æ ‡å‡†æ ¼å¼
    """
    event_id: str
    event_type: str  # 'cost.spike', 'security.issue', 'budget.exceeded'
    timestamp: datetime
    account: str
    data: dict
    signature: str  # HMAC-SHA256ç­¾å

# Webhookå‘é€å™¨
class WebhookSender:
    async def send_event(self, config: WebhookConfig, event: WebhookEvent):
        # 1. è®¡ç®—ç­¾å
        event.signature = self._calculate_signature(config.secret, event)

        # 2. å‘é€è¯·æ±‚
        try:
            async with httpx.AsyncClient(timeout=config.timeout) as client:
                response = await client.post(
                    config.url,
                    json=event.dict(),
                    headers={
                        "X-CloudLens-Signature": event.signature,
                        "X-CloudLens-Event": event.event_type
                    }
                )

                if response.status_code >= 500:
                    # æœåŠ¡å™¨é”™è¯¯ï¼Œé‡è¯•
                    await self._retry_send(config, event)

        except Exception as e:
            logger.error(f"Webhook send failed: {e}")
            await self._retry_send(config, event)
```

**9.3 Grafanaæ•°æ®æºæ’ä»¶**:

```go
// Grafanaæ•°æ®æºæ’ä»¶ (Golang)
package main

import (
    "context"
    "encoding/json"
    "github.com/grafana/grafana-plugin-sdk-go/backend"
)

type CloudLensDataSource struct{}

func (ds *CloudLensDataSource) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
    response := backend.NewQueryDataResponse()

    for _, q := range req.Queries {
        var query CloudLensQuery
        json.Unmarshal(q.JSON, &query)

        // è°ƒç”¨CloudLens APIè·å–æ•°æ®
        data, err := ds.fetchData(ctx, query)
        if err != nil {
            response.Responses[q.RefID] = backend.DataResponse{Error: err}
            continue
        }

        // è½¬æ¢ä¸ºGrafanaæ ¼å¼
        frame := ds.convertToDataFrame(data)
        response.Responses[q.RefID] = backend.DataResponse{Frames: []*data.Frame{frame}}
    }

    return response, nil
}

// plugin.jsoné…ç½®
{
  "type": "datasource",
  "name": "CloudLens",
  "id": "cloudlens-datasource",
  "metrics": true,
  "annotations": true,
  "alerting": true
}
```

---

#### Q4 2026: AIèƒ½åŠ›ä¸è‡ªåŠ¨åŒ–å‡çº§

##### 10. è‡ªç„¶è¯­è¨€æŸ¥è¯¢ä¸æ™ºèƒ½é—®ç­” â­â­â­â­â­

**10.1 NL2SQLå¼•æ“**:

```python
class NL2SQLEngine:
    """
    è‡ªç„¶è¯­è¨€è½¬SQLæŸ¥è¯¢å¼•æ“
    """

    def __init__(self, llm_client):
        self.llm_client = llm_client  # Claude/GPT-4ç­‰
        self.schema = self._load_database_schema()
        self.query_templates = self._load_query_templates()

    async def translate_query(self, natural_language_query: str):
        """
        å°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºSQL
        """
        # 1. æ„å›¾è¯†åˆ«
        intent = await self._classify_intent(natural_language_query)

        # 2. å®ä½“æŠ½å–
        entities = await self._extract_entities(natural_language_query)

        # 3. ç”ŸæˆSQL
        prompt = f"""
        æ•°æ®åº“Schema:
        {self.schema}

        æŸ¥è¯¢æ¨¡æ¿ç¤ºä¾‹:
        {self.query_templates}

        ç”¨æˆ·æŸ¥è¯¢: {natural_language_query}
        æ„å›¾: {intent}
        å®ä½“: {entities}

        è¯·ç”Ÿæˆå®‰å…¨çš„SQLæŸ¥è¯¢è¯­å¥:
        """

        sql = await self.llm_client.generate(prompt)

        # 4. SQLå®‰å…¨æ£€æŸ¥
        if not self._is_safe_sql(sql):
            raise UnsafeSQLError("SQL query contains dangerous operations")

        return {
            'sql': sql,
            'intent': intent,
            'entities': entities,
            'explanation': await self._explain_sql(sql)
        }

# ä½¿ç”¨ç¤ºä¾‹
engine = NL2SQLEngine(claude_client)

# ç”¨æˆ·è¾“å…¥
query = "æœ¬æœˆECSæˆæœ¬æœ€é«˜çš„5ä¸ªå®ä¾‹æ˜¯å“ªäº›ï¼Ÿ"

# è½¬æ¢
result = await engine.translate_query(query)
print(result['sql'])
# SELECT instance_id, instance_name, SUM(cost) as total_cost
# FROM bill_items
# WHERE billing_cycle = '2026-01'
#   AND product_name LIKE '%ECS%'
# GROUP BY instance_id, instance_name
# ORDER BY total_cost DESC
# LIMIT 5

# æ‰§è¡ŒSQLå¹¶è¿”å›ç»“æœ
data = db.query(result['sql'])
```

**10.2 æ™ºèƒ½é—®ç­”ç³»ç»Ÿ**:

```python
class IntelligentQASystem:
    """
    åŸºäºRAGçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿ
    """

    def __init__(self):
        self.vector_db = ChromaDB()  # å‘é‡æ•°æ®åº“
        self.llm = ClaudeClient()
        self.embedding_model = OpenAIEmbeddings()

    async def answer_question(self, question: str, context: dict):
        """
        å›ç­”ç”¨æˆ·é—®é¢˜
        """
        # 1. æ£€ç´¢ç›¸å…³æ•°æ®
        relevant_docs = await self._retrieve_relevant_data(question, context)

        # 2. æ„å»ºæç¤ºè¯
        prompt = f"""
        ä½ æ˜¯CloudLensçš„AIåŠ©æ‰‹ï¼Œä¸“æ³¨äºäº‘æˆæœ¬ä¼˜åŒ–å’Œèµ„æºç®¡ç†ã€‚

        ç”¨æˆ·é—®é¢˜: {question}

        ç›¸å…³æ•°æ®:
        {relevant_docs}

        å½“å‰ä¸Šä¸‹æ–‡:
        - è´¦å·: {context['account']}
        - æ—¶é—´èŒƒå›´: {context['time_range']}
        - å½“å‰é¡µé¢: {context['page']}

        è¯·åŸºäºä»¥ä¸Šæ•°æ®å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¹¶æä¾›å¯æ“ä½œçš„å»ºè®®ã€‚
        """

        # 3. ç”Ÿæˆå›ç­”
        answer = await self.llm.generate(prompt)

        # 4. ç”Ÿæˆå¯è§†åŒ–å»ºè®®
        visualizations = await self._suggest_visualizations(question, relevant_docs)

        return {
            'answer': answer,
            'sources': relevant_docs,
            'visualizations': visualizations,
            'suggested_actions': await self._suggest_actions(question, answer)
        }

# ç¤ºä¾‹å¯¹è¯
qa = IntelligentQASystem()

Q: "ä¸ºä»€ä¹ˆæœ¬æœˆæˆæœ¬æ¯”ä¸Šæœˆé«˜äº†è¿™ä¹ˆå¤šï¼Ÿ"
A: "æœ¬æœˆæˆæœ¬å¢åŠ äº†23%ï¼Œä¸»è¦æœ‰ä»¥ä¸‹3ä¸ªåŸå› ï¼š
    1. ECSå®ä¾‹æ•°é‡å¢åŠ äº†15å° (+Â¥8,000)
    2. æµé‡è´¹ç”¨å¼‚å¸¸å¢é•¿ (+Â¥3,000ï¼Œå¯èƒ½æ˜¯CDNé…ç½®é—®é¢˜)
    3. é¢„ç•™å®ä¾‹åˆ°æœŸï¼Œè½¬ä¸ºæŒ‰é‡ä»˜è´¹ (+Â¥2,000)

    å»ºè®®æ“ä½œï¼š
    - æ£€æŸ¥CDNé…ç½®ï¼Œä¼˜åŒ–æµé‡ä½¿ç”¨
    - è¯„ä¼°æ–°å¢ECSçš„å¿…è¦æ€§ï¼Œè€ƒè™‘å…³é—­é—²ç½®å®ä¾‹
    - ç»­è´­é¢„ç•™å®ä¾‹ä»¥é™ä½æˆæœ¬"

Q: "å¸®æˆ‘æ‰¾å‡ºå¯ä»¥ä¼˜åŒ–çš„èµ„æº"
A: "æ ¹æ®åˆ†æï¼Œå‘ç°ä»¥ä¸‹å¯ä¼˜åŒ–èµ„æºï¼š
    1. é—²ç½®ECSå®ä¾‹ (CPU<5%): 8å°ï¼Œé¢„è®¡èŠ‚çœÂ¥2,400/æœˆ
    2. æœªç»‘å®šEIP: 5ä¸ªï¼Œé¢„è®¡èŠ‚çœÂ¥500/æœˆ
    3. ä½åˆ©ç”¨ç‡RDSå®ä¾‹: 3ä¸ªï¼Œå»ºè®®é™é…ï¼Œé¢„è®¡èŠ‚çœÂ¥1,800/æœˆ

    æ€»è®¡å¯èŠ‚çœ: Â¥4,700/æœˆ (å å½“å‰æˆæœ¬15%)

    [æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š] [ä¸€é”®ä¼˜åŒ–]"
```

---

##### 11. è‡ªåŠ¨åŒ–å·¥ä½œæµç¼–æ’ â­â­â­â­

**11.1 å·¥ä½œæµå¼•æ“**:

```python
# å·¥ä½œæµå®šä¹‰ (YAML)
workflow_example = """
name: "æˆæœ¬ä¼˜åŒ–è‡ªåŠ¨åŒ–æµç¨‹"
trigger:
  type: "schedule"
  cron: "0 9 * * 1"  # æ¯å‘¨ä¸€æ—©ä¸Š9ç‚¹

steps:
  - name: "æ£€æµ‹é—²ç½®èµ„æº"
    action: "analyze.idle_resources"
    params:
      threshold:
        cpu: 5
        memory: 10
    outputs:
      idle_list: "{{result.idle_resources}}"

  - name: "ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š"
    action: "report.generate"
    params:
      template: "cost_optimization"
      data: "{{steps.æ£€æµ‹é—²ç½®èµ„æº.idle_list}}"
    outputs:
      report_url: "{{result.url}}"

  - name: "å‘é€é€šçŸ¥"
    action: "notify.send"
    params:
      channel: "slack"
      message: "æœ¬å‘¨å‘ç°{{steps.æ£€æµ‹é—²ç½®èµ„æº.idle_list | length}}ä¸ªé—²ç½®èµ„æºï¼ŒæŸ¥çœ‹æŠ¥å‘Š: {{steps.ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š.report_url}}"

  - name: "ç­‰å¾…å®¡æ‰¹"
    action: "approval.wait"
    params:
      approvers: ["finops@company.com"]
      timeout: "48h"

  - name: "æ‰§è¡Œä¼˜åŒ–"
    condition: "{{steps.ç­‰å¾…å®¡æ‰¹.approved}}"
    action: "remediate.batch_stop"
    params:
      resources: "{{steps.æ£€æµ‹é—²ç½®èµ„æº.idle_list}}"
      dry_run: false

  - name: "éªŒè¯ç»“æœ"
    action: "analyze.verify_optimization"
    params:
      before_cost: "{{trigger.current_cost}}"
      after_cost: "{{steps.æ‰§è¡Œä¼˜åŒ–.new_cost}}"
"""

# å·¥ä½œæµå¼•æ“å®ç°
class WorkflowEngine:
    def __init__(self):
        self.actions = self._register_actions()

    async def execute_workflow(self, workflow_def: dict):
        """
        æ‰§è¡Œå·¥ä½œæµ
        """
        context = {"steps": {}}

        for step in workflow_def['steps']:
            # 1. æ£€æŸ¥æ¡ä»¶
            if 'condition' in step:
                if not self._evaluate_condition(step['condition'], context):
                    logger.info(f"Skipping step {step['name']} due to condition")
                    continue

            # 2. æ¸²æŸ“å‚æ•° (æ”¯æŒJinja2æ¨¡æ¿)
            params = self._render_params(step['params'], context)

            # 3. æ‰§è¡ŒåŠ¨ä½œ
            action = self.actions[step['action']]
            result = await action.execute(params)

            # 4. ä¿å­˜è¾“å‡º
            if 'outputs' in step:
                context['steps'][step['name']] = self._extract_outputs(
                    result, step['outputs']
                )

            # 5. é”™è¯¯å¤„ç†
            if result.status == 'failed':
                if step.get('on_error') == 'continue':
                    logger.warning(f"Step {step['name']} failed, continuing")
                    continue
                else:
                    raise WorkflowExecutionError(f"Step {step['name']} failed")

        return context
```

**11.2 å®¡æ‰¹æµç¨‹**:

```python
# å®¡æ‰¹é…ç½®
class ApprovalConfig:
    approvers: List[str]  # å®¡æ‰¹äººåˆ—è¡¨
    approval_type: str    # 'any', 'all', 'sequential'
    timeout: timedelta
    auto_approve_conditions: Optional[dict]  # è‡ªåŠ¨å®¡æ‰¹æ¡ä»¶

# å®¡æ‰¹æµç¨‹
class ApprovalService:
    async def create_approval(self, config: ApprovalConfig, data: dict):
        """
        åˆ›å»ºå®¡æ‰¹å•
        """
        approval = Approval(
            id=generate_id(),
            config=config,
            data=data,
            status='pending',
            created_at=datetime.now()
        )

        # æ£€æŸ¥è‡ªåŠ¨å®¡æ‰¹æ¡ä»¶
        if config.auto_approve_conditions:
            if self._check_auto_approve(approval):
                approval.status = 'approved'
                approval.approved_by = 'system'
                return approval

        # å‘é€å®¡æ‰¹é€šçŸ¥
        await self._notify_approvers(approval)

        # ä¿å­˜åˆ°æ•°æ®åº“
        await self.db.save(approval)

        return approval

    def _check_auto_approve(self, approval: Approval) -> bool:
        """
        æ£€æŸ¥æ˜¯å¦æ»¡è¶³è‡ªåŠ¨å®¡æ‰¹æ¡ä»¶

        ç¤ºä¾‹: æˆæœ¬å½±å“ < Â¥100 è‡ªåŠ¨å®¡æ‰¹
        """
        conditions = approval.config.auto_approve_conditions

        if 'cost_impact' in conditions:
            if approval.data.get('cost_impact', float('inf')) < conditions['cost_impact']:
                return True

        return False
```

---

### ä¸‰ã€äº§å“æ ¸å¿ƒæŒ‡æ ‡ (North Star Metrics)

| æŒ‡æ ‡ç±»å‹ | æŒ‡æ ‡åç§° | å½“å‰å€¼ | Q2ç›®æ ‡ | Q4ç›®æ ‡ | è®¡ç®—æ–¹å¼ |
|---------|---------|--------|--------|--------|----------|
| **ç”¨æˆ·ä»·å€¼** | æœˆå‡æˆæœ¬èŠ‚çœé‡‘é¢ | - | Â¥50,000 | Â¥200,000 | å®é™…èŠ‚çœ / æœˆ |
| **ç”¨æˆ·æ´»è·ƒ** | å‘¨æ´»è·ƒç”¨æˆ· (WAU) | - | 100 | 500 | å‘¨æ´»è·ƒç”¨æˆ·æ•° |
| **åŠŸèƒ½ä½¿ç”¨** | æŠ¥å‘Šç”Ÿæˆæ¬¡æ•° | - | 1,000/æœˆ | 5,000/æœˆ | æœˆæŠ¥å‘Šç”Ÿæˆæ€»æ•° |
| **æ•ˆç‡æå‡** | å¹³å‡é—®é¢˜ä¿®å¤æ—¶é—´ | - | <24h | <12h | å‘ç°â†’ä¿®å¤å¹³å‡æ—¶é•¿ |
| **ç³»ç»Ÿå¥åº·** | APIå¯ç”¨æ€§ | - | >99.5% | >99.9% | æ­£å¸¸è¯·æ±‚/æ€»è¯·æ±‚ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è§„åˆ’

### ä¸€ã€æ¶æ„æ¼”è¿›è·¯çº¿

#### å½“å‰æ¶æ„ (Monolithic)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Load Balancer â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FastAPI App   â”‚
                    â”‚   (3922è¡ŒAPI)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Core Services  â”‚
                    â”‚  (60+ modules)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MySQL Database â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**:
- å•ä½“åº”ç”¨ï¼Œè€¦åˆåº¦é«˜
- å•ç‚¹æ•…éšœé£é™©
- æ‰©å±•æ€§å—é™
- éƒ¨ç½²é£é™©å¤§

---

#### ç›®æ ‡æ¶æ„ (Microservices - Phase 1: Q2-Q3 2026)

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   API Gateway   â”‚
                         â”‚   (Kong/APISIX) â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                 â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Cost Service   â”‚ â”‚  Resource  â”‚ â”‚   Security    â”‚
       â”‚   (FastAPI)     â”‚ â”‚  Service   â”‚ â”‚   Service     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚                 â”‚
                â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                â”‚         â”‚  Message Bus  â”‚         â”‚
                â”‚         â”‚   (RabbitMQ)  â”‚         â”‚
                â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                 â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Cost Database  â”‚ â”‚  Resource  â”‚ â”‚   Security    â”‚
       â”‚   (MySQL)       â”‚ â”‚  Database  â”‚ â”‚   Database    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### æœªæ¥æ¶æ„ (Cloud-Native - Phase 2: Q4 2026+)

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Service Mesh   â”‚
                         â”‚    (Istio)      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                 â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Cost Service   â”‚ â”‚  Resource  â”‚ â”‚   Security    â”‚
       â”‚   (k8s pods)    â”‚ â”‚  Service   â”‚ â”‚   Service     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚                 â”‚
                â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                â”‚         â”‚  Event Stream â”‚         â”‚
                â”‚         â”‚    (Kafka)    â”‚         â”‚
                â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                 â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Time Series DB â”‚ â”‚   Cache    â”‚ â”‚   Document    â”‚
       â”‚  (InfluxDB)     â”‚ â”‚  (Redis)   â”‚ â”‚   Database    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚           Observability Platform                 â”‚
       â”‚  Prometheus + Grafana + Jaeger + ELK            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### äºŒã€æŠ€æœ¯æ ˆå‡çº§è·¯çº¿

#### Q1 2026: åŸºç¡€è®¾æ–½ä¼˜åŒ–

**2.1 APIæ¨¡å—åŒ–é‡æ„** â­â­â­â­â­

**å½“å‰çŠ¶æ€**: `api.py` 3922è¡Œï¼Œ148ä¸ªç«¯ç‚¹é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶

**é‡æ„æ–¹æ¡ˆ**:

```python
# ç›®æ ‡ç»“æ„
web/backend/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py                # è·¯ç”±æ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ dependencies.py            # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ middleware.py              # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ v1/                        # APIç‰ˆæœ¬åŒ–
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ accounts.py            # è´¦å·ç®¡ç† (~10ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ resources.py           # èµ„æºæŸ¥è¯¢ (~15ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ costs.py               # æˆæœ¬åˆ†æ (~20ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ discounts.py           # æŠ˜æ‰£åˆ†æ (~14ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ security.py            # å®‰å…¨åˆè§„ (~12ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ budgets.py             # é¢„ç®—ç®¡ç† (~8ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ alerts.py              # å‘Šè­¦ç®¡ç† (~10ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ reports.py             # æŠ¥å‘Šç”Ÿæˆ (~6ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ tags.py                # è™šæ‹Ÿæ ‡ç­¾ (~8ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ dashboards.py          # ä»ªè¡¨ç›˜ (~8ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ optimization.py        # ä¼˜åŒ–å»ºè®® (~4ä¸ªç«¯ç‚¹)
â”‚   â”‚   â”œâ”€â”€ cost_allocation.py     # æˆæœ¬åˆ†é… (~6ä¸ªç«¯ç‚¹)
â”‚   â”‚   â””â”€â”€ ai.py                  # AIåŠŸèƒ½ (~5ä¸ªç«¯ç‚¹)
â”œâ”€â”€ models/                        # Pydanticæ¨¡å‹
â”‚   â”œâ”€â”€ requests.py               # è¯·æ±‚æ¨¡å‹
â”‚   â”œâ”€â”€ responses.py              # å“åº”æ¨¡å‹
â”‚   â””â”€â”€ schemas.py                # æ•°æ®æ¨¡å‹
â”œâ”€â”€ services/                      # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ account_service.py
â”‚   â”œâ”€â”€ cost_service.py
â”‚   â”œâ”€â”€ security_service.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ repositories/                  # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ account_repository.py
â”‚   â”œâ”€â”€ bill_repository.py
â”‚   â””â”€â”€ ...
â””â”€â”€ main.py                        # åº”ç”¨å…¥å£

# è·¯ç”±æ³¨å†Œ (api/__init__.py)
from fastapi import APIRouter
from .v1 import (
    accounts, resources, costs, discounts,
    security, budgets, alerts, reports
)

api_router = APIRouter()

# æ³¨å†Œv1è·¯ç”±
api_v1_router = APIRouter(prefix="/api/v1")
api_v1_router.include_router(accounts.router, prefix="/accounts", tags=["accounts"])
api_v1_router.include_router(resources.router, prefix="/resources", tags=["resources"])
api_v1_router.include_router(costs.router, prefix="/costs", tags=["costs"])
# ... å…¶ä»–è·¯ç”±

api_router.include_router(api_v1_router)
```

**åˆ†å±‚æ¶æ„**:
```python
# Controllerå±‚ (api/v1/costs.py)
@router.get("/trends")
async def get_cost_trends(
    account: str,
    date_range: DateRange = Depends(),
    cost_service: CostService = Depends()
):
    return await cost_service.get_cost_trends(account, date_range)

# Serviceå±‚ (services/cost_service.py)
class CostService:
    def __init__(self, bill_repo: BillRepository):
        self.bill_repo = bill_repo

    async def get_cost_trends(self, account: str, date_range: DateRange):
        # ä¸šåŠ¡é€»è¾‘
        bills = await self.bill_repo.get_bills_in_range(account, date_range)
        trends = self._calculate_trends(bills)
        return CostTrendsResponse(**trends)

# Repositoryå±‚ (repositories/bill_repository.py)
class BillRepository:
    def __init__(self, db: Database):
        self.db = db

    async def get_bills_in_range(self, account: str, date_range: DateRange):
        # æ•°æ®è®¿é—®é€»è¾‘
        return await self.db.query(
            "SELECT * FROM bill_items WHERE account_id = ? AND ...",
            (account,)
        )
```

**å®æ–½è®¡åˆ’**:
- Week 1: åˆ›å»ºæ–°ç›®å½•ç»“æ„ï¼Œè¿ç§»10ä¸ªæ ¸å¿ƒç«¯ç‚¹
- Week 2: è¿ç§»å‰©ä½™ç«¯ç‚¹ï¼ŒServiceå±‚é‡æ„
- Week 3: Repositoryå±‚æå–ï¼Œä¾èµ–æ³¨å…¥
- Week 4: æµ‹è¯•ã€æ–‡æ¡£æ›´æ–°ã€ç°åº¦å‘å¸ƒ

---

**2.2 å¤šçº§ç¼“å­˜æ¶æ„** â­â­â­â­

**å½“å‰çŠ¶æ€**: ä»…ä½¿ç”¨MySQLç¼“å­˜è¡¨ (L3ç¼“å­˜)

**ç›®æ ‡æ¶æ„**:
```python
class MultiLevelCache:
    """
    ä¸‰çº§ç¼“å­˜æ¶æ„

    L1: è¿›ç¨‹å†…LRUç¼“å­˜ (5åˆ†é’ŸTTL)
    L2: Redisç¼“å­˜ (30åˆ†é’ŸTTL)
    L3: MySQLç¼“å­˜è¡¨ (24å°æ—¶TTL)
    """

    def __init__(self):
        self.l1_cache = LRUCache(maxsize=1000, ttl=300)
        self.l2_cache = RedisCache(ttl=1800) if redis_available() else None
        self.l3_cache = MySQLCache(ttl=86400)

        # ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
        self.metrics = CacheMetrics()

    async def get(self, key: str):
        # L1æŸ¥è¯¢
        value = self.l1_cache.get(key)
        if value is not None:
            self.metrics.record_hit('l1')
            return value

        # L2æŸ¥è¯¢
        if self.l2_cache:
            value = await self.l2_cache.get(key)
            if value is not None:
                self.metrics.record_hit('l2')
                self.l1_cache.set(key, value)  # å›å¡«L1
                return value

        # L3æŸ¥è¯¢
        value = await self.l3_cache.get(key)
        if value is not None:
            self.metrics.record_hit('l3')
            if self.l2_cache:
                await self.l2_cache.set(key, value)  # å›å¡«L2
            self.l1_cache.set(key, value)  # å›å¡«L1
            return value

        self.metrics.record_miss()
        return None

    async def set(self, key: str, value: Any, ttl: int = None):
        """
        å†™å…¥æ‰€æœ‰ç¼“å­˜å±‚
        """
        self.l1_cache.set(key, value, ttl or 300)
        if self.l2_cache:
            await self.l2_cache.set(key, value, ttl or 1800)
        await self.l3_cache.set(key, value, ttl or 86400)

# ä½¿ç”¨è£…é¥°å™¨
@multi_level_cache(ttl=300)
async def get_account_resources(account: str):
    # è€—æ—¶çš„æŸ¥è¯¢æ“ä½œ
    provider = get_provider(account)
    return await provider.list_all_resources()

# ç¼“å­˜é¢„çƒ­
async def warmup_cache():
    """
    ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­çƒ­ç‚¹æ•°æ®
    """
    hot_accounts = await get_active_accounts()
    for account in hot_accounts:
        await get_account_resources(account)  # è§¦å‘ç¼“å­˜
```

**Redisé…ç½®** (å¯é€‰ï¼Œé™çº§åˆ°L1+L3):
```python
# config/redis.py
REDIS_CONFIG = {
    'host': os.getenv('REDIS_HOST', 'localhost'),
    'port': int(os.getenv('REDIS_PORT', 6379)),
    'db': 0,
    'password': os.getenv('REDIS_PASSWORD'),
    'decode_responses': True,
    'max_connections': 50,
    'socket_keepalive': True,
    'socket_connect_timeout': 5,
    'retry_on_timeout': True
}

# Redisé™çº§ç­–ç•¥
class ResilientRedisCache:
    def __init__(self, config):
        try:
            self.redis = redis.Redis(**config)
            self.redis.ping()
            self.available = True
        except Exception as e:
            logger.warning(f"Redis unavailable: {e}, degrading to L1+L3 cache")
            self.available = False

    async def get(self, key):
        if not self.available:
            return None

        try:
            return await self.redis.get(key)
        except Exception as e:
            logger.error(f"Redis get failed: {e}")
            return None
```

**ç¼“å­˜ç›‘æ§**:
```python
class CacheMetrics:
    def __init__(self):
        self.l1_hits = Counter()
        self.l2_hits = Counter()
        self.l3_hits = Counter()
        self.misses = Counter()

    def record_hit(self, level: str):
        if level == 'l1':
            self.l1_hits.inc()
        elif level == 'l2':
            self.l2_hits.inc()
        elif level == 'l3':
            self.l3_hits.inc()

    def record_miss(self):
        self.misses.inc()

    def get_hit_rate(self):
        total_requests = (
            self.l1_hits._value +
            self.l2_hits._value +
            self.l3_hits._value +
            self.misses._value
        )

        if total_requests == 0:
            return 0

        total_hits = self.l1_hits._value + self.l2_hits._value + self.l3_hits._value
        return (total_hits / total_requests) * 100

    def export_prometheus_metrics(self):
        return f"""
        # HELP cache_hits_total Total cache hits by level
        # TYPE cache_hits_total counter
        cache_hits_total{{level="l1"}} {self.l1_hits._value}
        cache_hits_total{{level="l2"}} {self.l2_hits._value}
        cache_hits_total{{level="l3"}} {self.l3_hits._value}

        # HELP cache_miss_total Total cache misses
        # TYPE cache_miss_total counter
        cache_miss_total {self.misses._value}

        # HELP cache_hit_rate Cache hit rate percentage
        # TYPE cache_hit_rate gauge
        cache_hit_rate {self.get_hit_rate()}
        """
```

---

**2.3 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–** â­â­â­â­â­

**ä¼˜åŒ–æ–¹å‘**:

1. **ç´¢å¼•ä¼˜åŒ–**:
```sql
-- è´¦å•æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_bill_items_account_cycle_product
ON bill_items(account_id, billing_cycle, product_code);

CREATE INDEX idx_bill_items_instance_date
ON bill_items(instance_id, billing_date);

-- æŠ˜æ‰£åˆ†æç´¢å¼•
CREATE INDEX idx_bill_items_discount_rate
ON bill_items(account_id, billing_cycle, discount_rate);

-- è¦†ç›–ç´¢å¼• (é¿å…å›è¡¨)
CREATE INDEX idx_bill_items_cost_covering
ON bill_items(account_id, billing_cycle, product_code, pretax_amount);

-- å‡½æ•°ç´¢å¼• (MySQL 8.0+)
CREATE INDEX idx_bill_items_month
ON bill_items((DATE_FORMAT(billing_date, '%Y-%m')));
```

2. **è¡¨åˆ†åŒº**:
```sql
-- è´¦å•è¡¨æŒ‰æœˆåˆ†åŒº
ALTER TABLE bill_items
PARTITION BY RANGE (YEAR(billing_date) * 100 + MONTH(billing_date)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p202402 VALUES LESS THAN (202403),
    PARTITION p202403 VALUES LESS THAN (202404),
    -- ... è‡ªåŠ¨åˆ›å»ºæœªæ¥åˆ†åŒº
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- åˆ†åŒºç®¡ç†
CREATE EVENT auto_create_partitions
ON SCHEDULE EVERY 1 MONTH
DO
  CALL create_next_month_partition('bill_items');
```

3. **æŸ¥è¯¢ä¼˜åŒ–**:
```python
# æ…¢æŸ¥è¯¢ä¼˜åŒ–å‰
def get_cost_trends_slow(account, start_date, end_date):
    # é—®é¢˜: å…¨è¡¨æ‰«æ, å­æŸ¥è¯¢æ•ˆç‡ä½
    query = """
    SELECT
        DATE(billing_date) as date,
        SUM(pretax_amount) as cost
    FROM bill_items
    WHERE account_id = %s
      AND billing_date BETWEEN %s AND %s
      AND instance_id IN (
          SELECT instance_id FROM resources WHERE status = 'Running'
      )
    GROUP BY DATE(billing_date)
    """
    return db.query(query, (account, start_date, end_date))

# ä¼˜åŒ–å
def get_cost_trends_optimized(account, start_date, end_date):
    # ä¼˜åŒ–: JOINä»£æ›¿å­æŸ¥è¯¢, ä½¿ç”¨ç´¢å¼•
    query = """
    SELECT
        DATE(b.billing_date) as date,
        SUM(b.pretax_amount) as cost
    FROM bill_items b
    INNER JOIN resources r ON b.instance_id = r.instance_id
    WHERE b.account_id = %s
      AND b.billing_date BETWEEN %s AND %s
      AND r.status = 'Running'
    GROUP BY DATE(b.billing_date)
    ORDER BY date
    """
    return db.query(query, (account, start_date, end_date))
```

4. **è¿æ¥æ± è°ƒä¼˜**:
```python
# database.py
DATABASE_POOL_CONFIG = {
    'pool_size': 20,              # è¿æ¥æ± å¤§å°
    'max_overflow': 10,           # æœ€å¤§æº¢å‡ºè¿æ¥
    'pool_timeout': 30,           # è·å–è¿æ¥è¶…æ—¶
    'pool_recycle': 3600,         # è¿æ¥å›æ”¶æ—¶é—´ (1å°æ—¶)
    'pool_pre_ping': True,        # è¿æ¥å¥åº·æ£€æŸ¥
    'echo_pool': 'debug',         # è¿æ¥æ± æ—¥å¿—
}

# æ…¢æŸ¥è¯¢æ—¥å¿—
SLOW_QUERY_THRESHOLD = 1.0  # 1ç§’

@contextmanager
def query_with_logging(query, params):
    start = time.time()
    try:
        yield db.execute(query, params)
    finally:
        duration = time.time() - start
        if duration > SLOW_QUERY_THRESHOLD:
            logger.warning(
                f"Slow query detected: {duration:.2f}s",
                extra={
                    'query': query,
                    'params': params,
                    'duration': duration
                }
            )
```

---

#### Q2 2026: å¯è§‚æµ‹æ€§å»ºè®¾

**2.4 Prometheus Metricsé›†æˆ** â­â­â­â­â­

```python
# metrics.py
from prometheus_client import Counter, Histogram, Gauge, Info

# APIæŒ‡æ ‡
api_requests_total = Counter(
    'api_requests_total',
    'Total API requests',
    ['method', 'endpoint', 'status']
)

api_request_duration_seconds = Histogram(
    'api_request_duration_seconds',
    'API request duration in seconds',
    ['method', 'endpoint'],
    buckets=[0.01, 0.05, 0.1, 0.5, 1.0, 2.0, 5.0, 10.0]
)

# ç¼“å­˜æŒ‡æ ‡
cache_hits_total = Counter(
    'cache_hits_total',
    'Total cache hits',
    ['level']  # l1, l2, l3
)

cache_miss_total = Counter(
    'cache_miss_total',
    'Total cache misses'
)

# æ•°æ®åº“æŒ‡æ ‡
db_query_duration_seconds = Histogram(
    'db_query_duration_seconds',
    'Database query duration',
    ['query_type'],
    buckets=[0.001, 0.01, 0.1, 0.5, 1.0, 5.0]
)

db_connection_pool_size = Gauge(
    'db_connection_pool_size',
    'Current database connection pool size'
)

# ä¸šåŠ¡æŒ‡æ ‡
cost_analysis_total = Counter(
    'cost_analysis_total',
    'Total cost analyses performed',
    ['account', 'analysis_type']
)

security_scans_total = Counter(
    'security_scans_total',
    'Total security scans performed',
    ['account', 'scan_type']
)

# ä¸­é—´ä»¶
from fastapi import Request
import time

@app.middleware("http")
async def prometheus_middleware(request: Request, call_next):
    start_time = time.time()

    response = await call_next(request)

    duration = time.time() - start_time
    api_requests_total.labels(
        method=request.method,
        endpoint=request.url.path,
        status=response.status_code
    ).inc()

    api_request_duration_seconds.labels(
        method=request.method,
        endpoint=request.url.path
    ).observe(duration)

    return response

# Metrics endpoint
from prometheus_client import generate_latest

@app.get("/metrics")
async def metrics():
    return Response(
        content=generate_latest(),
        media_type="text/plain"
    )
```

**Grafana Dashboardé…ç½®**:
```json
{
  "dashboard": {
    "title": "CloudLens Overview",
    "panels": [
      {
        "title": "API Request Rate",
        "targets": [
          {
            "expr": "rate(api_requests_total[5m])",
            "legendFormat": "{{method}} {{endpoint}}"
          }
        ]
      },
      {
        "title": "API Latency (P95)",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P95 latency"
          }
        ]
      },
      {
        "title": "Cache Hit Rate",
        "targets": [
          {
            "expr": "sum(rate(cache_hits_total[5m])) / (sum(rate(cache_hits_total[5m])) + rate(cache_miss_total[5m])) * 100",
            "legendFormat": "Hit Rate %"
          }
        ]
      }
    ]
  }
}
```

---

**2.5 åˆ†å¸ƒå¼è¿½è¸ª (OpenTelemetry)** â­â­â­â­

```python
# tracing.py
from opentelemetry import trace
from opentelemetry.exporter.jaeger import JaegerExporter
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor
from opentelemetry.instrumentation.fastapi import FastAPIInstrumentor

# åˆå§‹åŒ–Tracer
tracer_provider = TracerProvider()
jaeger_exporter = JaegerExporter(
    agent_host_name="localhost",
    agent_port=6831,
)
tracer_provider.add_span_processor(BatchSpanProcessor(jaeger_exporter))
trace.set_tracer_provider(tracer_provider)

# FastAPIè‡ªåŠ¨è¿½è¸ª
FastAPIInstrumentor.instrument_app(app)

# æ‰‹åŠ¨è¿½è¸ª
tracer = trace.get_tracer(__name__)

async def get_cost_analysis(account: str):
    with tracer.start_as_current_span("get_cost_analysis") as span:
        span.set_attribute("account", account)

        # æ•°æ®åº“æŸ¥è¯¢
        with tracer.start_as_current_span("db_query"):
            bills = await db.query_bills(account)

        # æ•°æ®å¤„ç†
        with tracer.start_as_current_span("process_data"):
            result = process_cost_data(bills)

        span.set_attribute("result_size", len(result))
        return result
```

---

**2.6 é”™è¯¯è¿½è¸ª (Sentry)** â­â­â­â­

```python
# error_tracking.py
import sentry_sdk
from sentry_sdk.integrations.fastapi import FastApiIntegration
from sentry_sdk.integrations.sqlalchemy import SqlalchemyIntegration

sentry_sdk.init(
    dsn=os.getenv("SENTRY_DSN"),
    integrations=[
        FastApiIntegration(),
        SqlalchemyIntegration(),
    ],
    traces_sample_rate=0.1,  # 10% tracesé‡‡æ ·
    environment=os.getenv("ENVIRONMENT", "production"),
    release=f"cloudlens@{VERSION}",
    before_send=filter_sensitive_data,  # è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
)

def filter_sensitive_data(event, hint):
    """
    è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
    """
    if 'request' in event:
        # ç§»é™¤access_keyç­‰æ•æ„Ÿå‚æ•°
        if 'data' in event['request']:
            event['request']['data'] = mask_sensitive_fields(
                event['request']['data']
            )
    return event

# è‡ªå®šä¹‰å¼‚å¸¸ä¸ŠæŠ¥
def handle_cost_analysis_error(account: str, error: Exception):
    with sentry_sdk.push_scope() as scope:
        scope.set_tag("account", account)
        scope.set_context("analysis", {
            "account": account,
            "timestamp": datetime.now().isoformat()
        })
        sentry_sdk.capture_exception(error)
```

---

#### Q3 2026: å¾®æœåŠ¡æ‹†åˆ† (å¯é€‰)

**2.7 æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ**

å¦‚æœå›¢é˜Ÿè§„æ¨¡ > 5äººï¼Œå¯è€ƒè™‘å¾®æœåŠ¡æ‹†åˆ†ï¼š

```
æœåŠ¡æ‹†åˆ†ç­–ç•¥
â”œâ”€â”€ API Gateway (Kong/APISIX)
â”‚   â”œâ”€â”€ è·¯ç”±è½¬å‘
â”‚   â”œâ”€â”€ è®¤è¯é‰´æƒ
â”‚   â”œâ”€â”€ é™æµç†”æ–­
â”‚   â””â”€â”€ APIèšåˆ
â”‚
â”œâ”€â”€ Cost Service (æˆæœ¬åˆ†ææœåŠ¡)
â”‚   â”œâ”€â”€ æˆæœ¬è¶‹åŠ¿åˆ†æ
â”‚   â”œâ”€â”€ æˆæœ¬é¢„æµ‹
â”‚   â”œâ”€â”€ æŠ˜æ‰£åˆ†æ
â”‚   â””â”€â”€ é¢„ç®—ç®¡ç†
â”‚
â”œâ”€â”€ Resource Service (èµ„æºç®¡ç†æœåŠ¡)
â”‚   â”œâ”€â”€ èµ„æºæŸ¥è¯¢
â”‚   â”œâ”€â”€ èµ„æºæ ‡ç­¾
â”‚   â”œâ”€â”€ èµ„æºç¼“å­˜
â”‚   â””â”€â”€ é—²ç½®æ£€æµ‹
â”‚
â”œâ”€â”€ Security Service (å®‰å…¨åˆè§„æœåŠ¡)
â”‚   â”œâ”€â”€ CISåˆè§„æ£€æŸ¥
â”‚   â”œâ”€â”€ å®‰å…¨æ‰«æ
â”‚   â”œâ”€â”€ æ¼æ´æ£€æµ‹
â”‚   â””â”€â”€ ä¿®å¤å»ºè®®
â”‚
â”œâ”€â”€ Billing Service (è´¦å•æœåŠ¡)
â”‚   â”œâ”€â”€ è´¦å•è·å–
â”‚   â”œâ”€â”€ è´¦å•è§£æ
â”‚   â”œâ”€â”€ è´¦å•å­˜å‚¨
â”‚   â””â”€â”€ è´¦å•åŒæ­¥
â”‚
â””â”€â”€ Notification Service (é€šçŸ¥æœåŠ¡)
    â”œâ”€â”€ å‘Šè­¦æ¨é€
    â”œâ”€â”€ æŠ¥å‘Šç”Ÿæˆ
    â”œâ”€â”€ Webhookè°ƒç”¨
    â””â”€â”€ é‚®ä»¶å‘é€
```

**æœåŠ¡é—´é€šä¿¡**:
```python
# ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ— (RabbitMQ)
class CostAnalysisService:
    def __init__(self):
        self.mq = RabbitMQClient()

    async def analyze_cost(self, account: str):
        # 1. å‘å¸ƒæˆæœ¬åˆ†æäº‹ä»¶
        await self.mq.publish(
            exchange='cloudlens.events',
            routing_key='cost.analysis.started',
            message={
                'account': account,
                'timestamp': datetime.now().isoformat()
            }
        )

        # 2. æ‰§è¡Œåˆ†æ
        result = await self._perform_analysis(account)

        # 3. å‘å¸ƒç»“æœäº‹ä»¶
        await self.mq.publish(
            exchange='cloudlens.events',
            routing_key='cost.analysis.completed',
            message={
                'account': account,
                'result': result
            }
        )

        return result

# è®¢é˜…äº‹ä»¶
class NotificationService:
    def __init__(self):
        self.mq = RabbitMQClient()
        self.mq.subscribe(
            exchange='cloudlens.events',
            routing_key='cost.analysis.completed',
            callback=self.on_cost_analysis_completed
        )

    async def on_cost_analysis_completed(self, message):
        # å‘é€é€šçŸ¥
        await self.send_notification(message)
```

---

#### Q4 2026: äº‘åŸç”ŸåŒ–æ”¹é€  (å¯é€‰)

**2.8 Kuberneteséƒ¨ç½²**

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloudlens-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: cloudlens-api
  template:
    metadata:
      labels:
        app: cloudlens-api
    spec:
      containers:
      - name: api
        image: cloudlens/api:latest
        ports:
        - containerPort: 8000
        env:
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: cloudlens-secrets
              key: db-host
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
# k8s/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: cloudlens-api
spec:
  selector:
    app: cloudlens-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer

---
# k8s/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: cloudlens-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cloudlens-api
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

### ä¸‰ã€å‰ç«¯æŠ€æœ¯ä¼˜åŒ–

#### 3.1 çŠ¶æ€ç®¡ç†ä¼˜åŒ– â­â­â­â­

**å½“å‰çŠ¶æ€**: ä½¿ç”¨Zustandï¼Œä½†çŠ¶æ€ç®¡ç†ä¸å¤Ÿè§„èŒƒ

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// lib/stores/index.ts - çŠ¶æ€æ‹†åˆ†
export { useAccountStore } from './accountStore'
export { useCostStore } from './costStore'
export { useResourceStore } from './resourceStore'
export { useUIStore } from './uiStore'

// lib/stores/costStore.ts
import { create } from 'zustand'
import { persist, devtools } from 'zustand/middleware'
import { immer } from 'zustand/middleware/immer'

interface CostState {
  // çŠ¶æ€
  costTrends: CostTrend[]
  loading: boolean
  error: string | null

  // è®¡ç®—å±æ€§
  totalCost: number
  averageCost: number

  // åŠ¨ä½œ
  fetchCostTrends: (account: string, range: DateRange) => Promise<void>
  updateCostTrend: (id: string, data: Partial<CostTrend>) => void
  clearError: () => void
}

export const useCostStore = create<CostState>()(
  devtools(
    persist(
      immer((set, get) => ({
        // åˆå§‹çŠ¶æ€
        costTrends: [],
        loading: false,
        error: null,

        // è®¡ç®—å±æ€§
        get totalCost() {
          return get().costTrends.reduce((sum, t) => sum + t.cost, 0)
        },

        get averageCost() {
          const trends = get().costTrends
          return trends.length > 0 ? get().totalCost / trends.length : 0
        },

        // å¼‚æ­¥åŠ¨ä½œ
        fetchCostTrends: async (account, range) => {
          set({ loading: true, error: null })
          try {
            const data = await api.getCostTrends(account, range)
            set({ costTrends: data, loading: false })
          } catch (error) {
            set({ error: error.message, loading: false })
          }
        },

        // åŒæ­¥åŠ¨ä½œ (ä½¿ç”¨immer)
        updateCostTrend: (id, data) => {
          set((state) => {
            const trend = state.costTrends.find(t => t.id === id)
            if (trend) {
              Object.assign(trend, data)
            }
          })
        },

        clearError: () => set({ error: null })
      })),
      { name: 'cost-store' }
    )
  )
)
```

---

#### 3.2 React Queryæ•°æ®ç®¡ç† â­â­â­â­â­

**ç›®æ ‡**: æ›¿ä»£è‡ªå®šä¹‰APIè¯·æ±‚é€»è¾‘ï¼Œç»Ÿä¸€æ•°æ®ç®¡ç†

```typescript
// lib/api/queries.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

// Query Hooks
export function useCostTrends(account: string, range: DateRange) {
  return useQuery({
    queryKey: ['costTrends', account, range],
    queryFn: () => api.getCostTrends(account, range),
    staleTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿå†…æ•°æ®ä¸è¿‡æœŸ
    cacheTime: 30 * 60 * 1000, // ç¼“å­˜30åˆ†é’Ÿ
    retry: 3,
    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
    onError: (error) => {
      toast.error(`è·å–æˆæœ¬è¶‹åŠ¿å¤±è´¥: ${error.message}`)
    }
  })
}

export function useResources(account: string, filters?: ResourceFilters) {
  return useQuery({
    queryKey: ['resources', account, filters],
    queryFn: () => api.getResources(account, filters),
    enabled: !!account,  // åªæœ‰accountå­˜åœ¨æ—¶æ‰æ‰§è¡Œ
    placeholderData: (previousData) => previousData,  // ä¿ç•™æ—§æ•°æ®
  })
}

// Mutation Hooks
export function useUpdateResourceTags() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: (data: { resourceId: string; tags: Record<string, string> }) =>
      api.updateResourceTags(data.resourceId, data.tags),

    onMutate: async (data) => {
      // ä¹è§‚æ›´æ–°
      await queryClient.cancelQueries(['resources'])
      const previousResources = queryClient.getQueryData(['resources'])

      queryClient.setQueryData(['resources'], (old: any) => {
        return old.map((r: Resource) =>
          r.id === data.resourceId ? { ...r, tags: data.tags } : r
        )
      })

      return { previousResources }
    },

    onError: (err, data, context) => {
      // å›æ»š
      queryClient.setQueryData(['resources'], context?.previousResources)
      toast.error('æ›´æ–°æ ‡ç­¾å¤±è´¥')
    },

    onSuccess: () => {
      // åˆ·æ–°æ•°æ®
      queryClient.invalidateQueries(['resources'])
      toast.success('æ ‡ç­¾æ›´æ–°æˆåŠŸ')
    }
  })
}

// ä½¿ç”¨ç¤ºä¾‹
function CostDashboard() {
  const { data: costTrends, isLoading, error, refetch } = useCostTrends(
    currentAccount,
    { start: '2026-01-01', end: '2026-01-31' }
  )

  if (isLoading) return <Spinner />
  if (error) return <ErrorMessage error={error} onRetry={refetch} />

  return <CostChart data={costTrends} />
}
```

---

#### 3.3 æ€§èƒ½ä¼˜åŒ– â­â­â­â­

**3.3.1 è™šæ‹Ÿæ»šåŠ¨ (å·²å®ç°)**:
```typescript
import { FixedSizeList } from 'react-window'

function ResourceTable({ resources }) {
  const Row = ({ index, style }) => (
    <div style={style}>
      <ResourceRow resource={resources[index]} />
    </div>
  )

  return (
    <FixedSizeList
      height={600}
      itemCount={resources.length}
      itemSize={60}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  )
}
```

**3.3.2 ä»£ç åˆ†å‰²**:
```typescript
// è·¯ç”±æ‡’åŠ è½½
import { lazy, Suspense } from 'react'

const Dashboard = lazy(() => import('./pages/Dashboard'))
const CostAnalysis = lazy(() => import('./pages/CostAnalysis'))
const SecurityAudit = lazy(() => import('./pages/SecurityAudit'))

function App() {
  return (
    <Suspense fallback={<PageLoader />}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/cost" element={<CostAnalysis />} />
        <Route path="/security" element={<SecurityAudit />} />
      </Routes>
    </Suspense>
  )
}

// ç»„ä»¶æ‡’åŠ è½½
const HeavyChart = lazy(() => import('./components/HeavyChart'))

function Page() {
  const [showChart, setShowChart] = useState(false)

  return (
    <div>
      <button onClick={() => setShowChart(true)}>æ˜¾ç¤ºå›¾è¡¨</button>
      {showChart && (
        <Suspense fallback={<ChartSkeleton />}>
          <HeavyChart />
        </Suspense>
      )}
    </div>
  )
}
```

**3.3.3 å›¾è¡¨ä¼˜åŒ–**:
```typescript
// å›¾è¡¨æ•°æ®é‡‡æ ·
function sampleData(data: DataPoint[], maxPoints: number = 100): DataPoint[] {
  if (data.length <= maxPoints) return data

  const step = Math.ceil(data.length / maxPoints)
  return data.filter((_, index) => index % step === 0)
}

// å›¾è¡¨æ‡’åŠ è½½
function CostChart({ data }) {
  const [isVisible, setIsVisible] = useState(false)
  const ref = useRef(null)

  useEffect(() => {
    const observer = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) {
        setIsVisible(true)
        observer.disconnect()
      }
    })

    if (ref.current) observer.observe(ref.current)

    return () => observer.disconnect()
  }, [])

  return (
    <div ref={ref}>
      {isVisible ? (
        <RechartsLineChart data={sampleData(data, 100)} />
      ) : (
        <ChartPlaceholder />
      )}
    </div>
  )
}
```

---

### å››ã€æµ‹è¯•ç­–ç•¥

#### 4.1 æµ‹è¯•é‡‘å­—å¡”

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  E2Eæµ‹è¯•  â”‚  (10%) - Playwright
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ é›†æˆæµ‹è¯•   â”‚  (30%) - pytest + httpx
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ å•å…ƒæµ‹è¯•   â”‚  (60%) - pytest + unittest.mock
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4.2 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**:

| æ¨¡å— | å½“å‰è¦†ç›–ç‡ | Q2ç›®æ ‡ | Q4ç›®æ ‡ |
|------|-----------|--------|--------|
| core/ | ~80% | 90% | 95% |
| web/backend/ | ~40% | 75% | 85% |
| resource_modules/ | ~60% | 80% | 90% |
| CLI | ~50% | 70% | 80% |
| å‰ç«¯ | ~20% | 60% | 75% |
| **å…¨å±€** | **~55%** | **75%** | **85%** |

**4.3 å•å…ƒæµ‹è¯•ç¤ºä¾‹**:

```python
# tests/core/test_cost_analyzer.py
import pytest
from datetime import datetime, timedelta
from core.cost_analyzer import CostAnalyzer

@pytest.fixture
def cost_analyzer():
    return CostAnalyzer(account='test-account')

@pytest.fixture
def sample_bills():
    return [
        {'billing_date': '2026-01-01', 'pretax_amount': 100.0, 'instance_id': 'i-001'},
        {'billing_date': '2026-01-02', 'pretax_amount': 150.0, 'instance_id': 'i-001'},
        {'billing_date': '2026-01-03', 'pretax_amount': 120.0, 'instance_id': 'i-002'},
    ]

def test_calculate_total_cost(cost_analyzer, sample_bills):
    total = cost_analyzer.calculate_total_cost(sample_bills)
    assert total == 370.0

def test_detect_cost_spike(cost_analyzer, sample_bills):
    # æ·»åŠ å¼‚å¸¸æ•°æ®
    anomaly_bill = {'billing_date': '2026-01-04', 'pretax_amount': 500.0, 'instance_id': 'i-001'}
    bills = sample_bills + [anomaly_bill]

    spikes = cost_analyzer.detect_cost_spike(bills, threshold=2.0)
    assert len(spikes) == 1
    assert spikes[0]['billing_date'] == '2026-01-04'

@pytest.mark.asyncio
async def test_fetch_cost_trends_with_cache(cost_analyzer, mocker):
    # Mockç¼“å­˜
    mock_cache = mocker.patch('core.cache.get')
    mock_cache.return_value = {'cached': True}

    result = await cost_analyzer.fetch_cost_trends('2026-01', use_cache=True)

    assert result['cached'] is True
    mock_cache.assert_called_once()
```

**4.4 é›†æˆæµ‹è¯•ç¤ºä¾‹**:

```python
# tests/integration/test_api_costs.py
import pytest
from httpx import AsyncClient

@pytest.mark.asyncio
async def test_get_cost_trends_api(client: AsyncClient, test_account):
    response = await client.get(
        "/api/v1/costs/trends",
        params={
            "account": test_account,
            "start_date": "2026-01-01",
            "end_date": "2026-01-31"
        }
    )

    assert response.status_code == 200
    data = response.json()
    assert "trends" in data
    assert len(data["trends"]) > 0
    assert "total_cost" in data

@pytest.mark.asyncio
async def test_cost_prediction_api(client: AsyncClient, test_account):
    response = await client.post(
        "/api/v1/costs/predict",
        json={
            "account": test_account,
            "days": 30
        }
    )

    assert response.status_code == 200
    data = response.json()
    assert "forecast" in data
    assert len(data["forecast"]) == 30
    assert "confidence_score" in data
    assert 0 <= data["confidence_score"] <= 1
```

**4.5 E2Eæµ‹è¯•å¢å¼º**:

```typescript
// tests/e2e/cost-analysis.spec.ts
import { test, expect } from '@playwright/test'

test.describe('æˆæœ¬åˆ†æåŠŸèƒ½', () => {
  test('æŸ¥çœ‹æˆæœ¬è¶‹åŠ¿å›¾', async ({ page }) => {
    await page.goto('http://localhost:3000/cost')

    // é€‰æ‹©è´¦å·
    await page.selectOption('#account-select', 'test-account')

    // ç­‰å¾…å›¾è¡¨åŠ è½½
    await page.waitForSelector('.cost-chart', { state: 'visible' })

    // éªŒè¯å›¾è¡¨å­˜åœ¨
    const chart = await page.locator('.cost-chart')
    await expect(chart).toBeVisible()

    // æˆªå›¾å¯¹æ¯”
    await expect(page).toHaveScreenshot('cost-trends-chart.png')
  })

  test('åˆ‡æ¢å¯¹æ¯”æ¨¡å¼', async ({ page }) => {
    await page.goto('http://localhost:3000/cost')

    // ç‚¹å‡»åŒæ¯”æŒ‰é’®
    await page.click('button:has-text("åŒæ¯”")')

    // éªŒè¯åŒæ¯”æ•°æ®åŠ è½½
    await expect(page.locator('.comparison-badge')).toContainText('%')

    // éªŒè¯APIè°ƒç”¨
    await page.waitForResponse(
      (response) => response.url().includes('/api/v1/costs/trends') &&
                    response.url().includes('comparison=yoy')
    )
  })

  test('å¯¼å‡ºæˆæœ¬æŠ¥å‘Š', async ({ page }) => {
    await page.goto('http://localhost:3000/cost')

    // ç‚¹å‡»å¯¼å‡ºæŒ‰é’®
    const [download] = await Promise.all([
      page.waitForEvent('download'),
      page.click('button:has-text("å¯¼å‡º")')
    ])

    // éªŒè¯æ–‡ä»¶ä¸‹è½½
    expect(download.suggestedFilename()).toMatch(/cost-report-.*\.xlsx/)
  })
})
```

---

### äº”ã€CI/CDæµæ°´çº¿

**5.1 GitHub Actions CI**:

```yaml
# .github/workflows/ci.yml
name: CI Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  backend-test:
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: test_password
          MYSQL_DATABASE: cloudlens_test
        ports:
          - 3306:3306
        options: >-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3

    steps:
      - uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Run linters
        run: |
          black --check .
          ruff check .
          mypy core/ web/backend/

      - name: Run tests
        env:
          DB_TYPE: mysql
          MYSQL_HOST: 127.0.0.1
          MYSQL_PORT: 3306
          MYSQL_USER: root
          MYSQL_PASSWORD: test_password
          MYSQL_DATABASE: cloudlens_test
        run: |
          pytest tests/ -v --cov --cov-report=xml --cov-report=term

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.xml
          flags: backend

      - name: Security scan
        run: |
          bandit -r core/ web/backend/ -ll

  frontend-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: web/frontend/package-lock.json

      - name: Install dependencies
        working-directory: web/frontend
        run: npm ci

      - name: Run linters
        working-directory: web/frontend
        run: |
          npm run lint
          npm run type-check

      - name: Run tests
        working-directory: web/frontend
        run: npm test -- --coverage

      - name: Build
        working-directory: web/frontend
        run: npm run build

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./web/frontend/coverage/coverage-final.json
          flags: frontend

  e2e-test:
    runs-on: ubuntu-latest
    needs: [backend-test, frontend-test]

    steps:
      - uses: actions/checkout@v3

      - name: Setup Python & Node.js
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          cd web/frontend && npm ci
          npx playwright install --with-deps

      - name: Start services
        run: |
          # å¯åŠ¨åç«¯
          python web/backend/main.py &

          # å¯åŠ¨å‰ç«¯
          cd web/frontend && npm run dev &

          # ç­‰å¾…æœåŠ¡å¯åŠ¨
          npx wait-on http://localhost:8000/health http://localhost:3000

      - name: Run E2E tests
        run: |
          cd web/frontend
          npx playwright test

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: web/frontend/playwright-report/
          retention-days: 7
```

**5.2 Pre-commit Hooks**:

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-added-large-files
        args: ['--maxkb=1000']

  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3.10

  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.0.270
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.3.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]

  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: ['-ll', '-r', 'core/', 'web/backend/']
```

---

## ğŸ“… å®æ–½è·¯çº¿å›¾

### Q1 2026 (Jan-Mar): åŸºç¡€ä¼˜åŒ–ä¸ç”¨æˆ·ä½“éªŒæå‡

| å‘¨æ¬¡ | é‡Œç¨‹ç¢‘ | å…³é”®ä»»åŠ¡ | é¢„æœŸäº§å‡º |
|-----|--------|---------|----------|
| **W1-2** | APIæ¨¡å—åŒ–é‡æ„ | - åˆ›å»ºæ¨¡å—åŒ–ç›®å½•ç»“æ„<br>- è¿ç§»æ ¸å¿ƒç«¯ç‚¹<br>- Serviceå±‚é‡æ„ | - æ–°APIç»“æ„<br>- 10+ä¸ªæ¨¡å—æ–‡ä»¶<br>- æµ‹è¯•è¦†ç›–70% |
| **W3-4** | å¤šçº§ç¼“å­˜å®ç° | - Redisé›†æˆ(å¯é€‰)<br>- L1/L2/L3ç¼“å­˜å±‚<br>- ç¼“å­˜ç›‘æ§ | - ç¼“å­˜å‘½ä¸­ç‡>80%<br>- APIå“åº”æ—¶é—´â†“50% |
| **W5-6** | æ•°æ®åº“ä¼˜åŒ– | - ç´¢å¼•ä¼˜åŒ–<br>- æŸ¥è¯¢ä¼˜åŒ–<br>- è¡¨åˆ†åŒº | - æ…¢æŸ¥è¯¢â†“70%<br>- æ•°æ®åº“è´Ÿè½½â†“40% |
| **W7-8** | å®æ—¶æ•°æ®åˆ·æ–° | - WebSocketå®ç°<br>- å‰ç«¯å®æ—¶æ›´æ–°<br>- å¢é‡æ¨é€ | - å®æ—¶åˆ·æ–°åŠŸèƒ½<br>- ç”¨æˆ·ä½“éªŒâ†‘40% |
| **W9-10** | æˆæœ¬è¶‹åŠ¿å¢å¼º | - åŒæ¯”/ç¯æ¯”åŠŸèƒ½<br>- å¤šè´¦å·å¯¹æ¯”<br>- æ•°æ®é’»å– | - å¯¹æ¯”åˆ†æåŠŸèƒ½<br>- æ™ºèƒ½æ´å¯Ÿé¢æ¿ |
| **W11-12** | ç§»åŠ¨ç«¯ä¼˜åŒ– | - å“åº”å¼å¸ƒå±€<br>- è§¦æ‘¸ä¼˜åŒ–<br>- æ€§èƒ½ä¼˜åŒ– | - ç§»åŠ¨ç«¯é€‚é…å®Œæˆ<br>- ç§»åŠ¨ç«¯ä½¿ç”¨ç‡â†‘60% |

**Q1é‡Œç¨‹ç¢‘**:
- âœ… APIæ¨¡å—åŒ–å®Œæˆ
- âœ… å¤šçº§ç¼“å­˜ä¸Šçº¿
- âœ… æ•°æ®åº“æ€§èƒ½æå‡50%
- âœ… å®æ—¶æ•°æ®åˆ·æ–°å¯ç”¨
- âœ… ç§»åŠ¨ç«¯ä½“éªŒå¤§å¹…æ”¹å–„

---

### Q2 2026 (Apr-Jun): å¯è§‚æµ‹æ€§ä¸æ•°æ®åˆ†ææ·±åŒ–

| å‘¨æ¬¡ | é‡Œç¨‹ç¢‘ | å…³é”®ä»»åŠ¡ | é¢„æœŸäº§å‡º |
|-----|--------|---------|----------|
| **W13-14** | ç›‘æ§ç³»ç»Ÿ | - Prometheusé›†æˆ<br>- Grafana Dashboard<br>- å‘Šè­¦è§„åˆ™ | - ç›‘æ§å¤§ç›˜ä¸Šçº¿<br>- å…³é”®æŒ‡æ ‡å¯è§†åŒ– |
| **W15-16** | é”™è¯¯è¿½è¸ª | - Sentryé›†æˆ<br>- åˆ†å¸ƒå¼è¿½è¸ª<br>- é”™è¯¯èšåˆ | - é”™è¯¯è¿½è¸ªç³»ç»Ÿ<br>- é—®é¢˜å®šä½æ—¶é—´â†“70% |
| **W17-18** | å¤šç»´åº¦åˆ†æ | - æˆæœ¬åˆ†é…å¼•æ“<br>- å¤šç»´åº¦èšåˆ<br>- å½’å› åˆ†æ | - æˆæœ¬åˆ†é…åŠŸèƒ½<br>- å¤šç»´åº¦æŠ¥å‘Š |
| **W19-20** | å¼‚å¸¸æ£€æµ‹ | - å¤šç®—æ³•æ£€æµ‹<br>- æ™ºèƒ½å‘Šè­¦<br>- å‘Šè­¦è·¯ç”± | - å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿ<br>- å‘Šè­¦å‡†ç¡®ç‡>90% |
| **W21-22** | AIé¢„æµ‹å¢å¼º | - å¤šæ¨¡å‹å¯¹æ¯”<br>- åœºæ™¯é¢„æµ‹<br>- ç½®ä¿¡åŒºé—´ | - å¢å¼ºé¢„æµ‹åŠŸèƒ½<br>- é¢„æµ‹å‡†ç¡®ç‡>85% |
| **W23-24** | æµ‹è¯•è¦†ç›–æå‡ | - å•å…ƒæµ‹è¯•è¡¥å……<br>- é›†æˆæµ‹è¯•<br>- E2Eæµ‹è¯• | - æµ‹è¯•è¦†ç›–ç‡è¾¾75%<br>- CI/CDæµæ°´çº¿å®Œå–„ |

**Q2é‡Œç¨‹ç¢‘**:
- âœ… ç›‘æ§å‘Šè­¦ç³»ç»Ÿå®Œæ•´
- âœ… å¤šç»´åº¦æˆæœ¬åˆ†æå¯ç”¨
- âœ… å¼‚å¸¸æ£€æµ‹å‡†ç¡®ç‡>90%
- âœ… AIé¢„æµ‹èƒ½åŠ›å¢å¼º
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾75%

---

### Q3 2026 (Jul-Sep): åä½œä¸é›†æˆèƒ½åŠ›å»ºè®¾

| å‘¨æ¬¡ | é‡Œç¨‹ç¢‘ | å…³é”®ä»»åŠ¡ | é¢„æœŸäº§å‡º |
|-----|--------|---------|----------|
| **W25-27** | å¤šç”¨æˆ·ç³»ç»Ÿ | - ç”¨æˆ·è®¤è¯<br>- MFAæ”¯æŒ<br>- RBACæƒé™ | - å¤šç”¨æˆ·ç™»å½•<br>- æƒé™ç®¡ç†ç³»ç»Ÿ |
| **W28-30** | å®¡è®¡æ—¥å¿— | - æ“ä½œå®¡è®¡<br>- æ—¥å¿—æŸ¥è¯¢<br>- åˆè§„æŠ¥å‘Š | - å®¡è®¡æ—¥å¿—ç³»ç»Ÿ<br>- åˆè§„æŠ¥å‘Šç”Ÿæˆ |
| **W31-33** | é€šçŸ¥é›†æˆ | - Slack/é’‰é’‰<br>- ä¼ä¸šå¾®ä¿¡<br>- é‚®ä»¶æ¨é€ | - å¤šæ¸ é“é€šçŸ¥<br>- Webhookæ”¯æŒ |
| **W34-36** | APIå¼€æ”¾ | - OpenAPIæ–‡æ¡£<br>- APIå¯†é’¥<br>- é™æµé…é¢ | - å®Œæ•´APIæ–‡æ¡£<br>- APIç®¡ç†å¹³å° |
| **W37-39** | å·¥ä½œæµå¼•æ“ | - å·¥ä½œæµç¼–æ’<br>- å®¡æ‰¹æµç¨‹<br>- å®šæ—¶ä»»åŠ¡ | - è‡ªåŠ¨åŒ–å·¥ä½œæµ<br>- å®¡æ‰¹ç³»ç»Ÿ |

**Q3é‡Œç¨‹ç¢‘**:
- âœ… å¤šç”¨æˆ·åä½œå¯ç”¨
- âœ… å…¨é¢å®¡è®¡èƒ½åŠ›
- âœ… ç¬¬ä¸‰æ–¹é›†æˆå®Œæˆ
- âœ… APIå¹³å°ä¸Šçº¿
- âœ… å·¥ä½œæµè‡ªåŠ¨åŒ–

---

### Q4 2026 (Oct-Dec): AIèƒ½åŠ›ä¸æ¶æ„å‡çº§

| å‘¨æ¬¡ | é‡Œç¨‹ç¢‘ | å…³é”®ä»»åŠ¡ | é¢„æœŸäº§å‡º |
|-----|--------|---------|----------|
| **W40-42** | NL2SQLå¼•æ“ | - è‡ªç„¶è¯­è¨€æŸ¥è¯¢<br>- æ„å›¾è¯†åˆ«<br>- SQLç”Ÿæˆ | - NLæŸ¥è¯¢åŠŸèƒ½<br>- æŸ¥è¯¢å‡†ç¡®ç‡>85% |
| **W43-45** | æ™ºèƒ½é—®ç­” | - RAGç³»ç»Ÿ<br>- å‘é‡æ•°æ®åº“<br>- ä¸Šä¸‹æ–‡å¯¹è¯ | - AIåŠ©æ‰‹ä¸Šçº¿<br>- é—®ç­”å‡†ç¡®ç‡>90% |
| **W46-48** | å¾®æœåŠ¡æ‹†åˆ†(å¯é€‰) | - æœåŠ¡æ‹†åˆ†<br>- API Gateway<br>- æ¶ˆæ¯é˜Ÿåˆ— | - å¾®æœåŠ¡æ¶æ„<br>- æœåŠ¡ç‹¬ç«‹éƒ¨ç½² |
| **W49-52** | äº‘åŸç”ŸåŒ–(å¯é€‰) | - Kuberneteséƒ¨ç½²<br>- Service Mesh<br>- è‡ªåŠ¨æ‰©ç¼©å®¹ | - K8séƒ¨ç½²æ–¹æ¡ˆ<br>- äº‘åŸç”Ÿæ¶æ„ |

**Q4é‡Œç¨‹ç¢‘**:
- âœ… AIèƒ½åŠ›æ˜¾è‘—æå‡
- âœ… è‡ªç„¶è¯­è¨€äº¤äº’å¯ç”¨
- âœ… æ¶æ„ç°ä»£åŒ–(å¯é€‰)
- âœ… äº‘åŸç”Ÿéƒ¨ç½²(å¯é€‰)

---

## ğŸ’° èµ„æºæŠ•å…¥ä¸é£é™©è¯„ä¼°

### ä¸€ã€äººåŠ›èµ„æºéœ€æ±‚

| è§’è‰² | Q1 | Q2 | Q3 | Q4 | èŒè´£ |
|------|----|----|----|----|------|
| **åç«¯å·¥ç¨‹å¸ˆ** | 2äºº | 2äºº | 2äºº | 3äºº | APIå¼€å‘ã€æ€§èƒ½ä¼˜åŒ–ã€å¾®æœåŠ¡ |
| **å‰ç«¯å·¥ç¨‹å¸ˆ** | 1äºº | 1äºº | 2äºº | 2äºº | UIå¼€å‘ã€æ€§èƒ½ä¼˜åŒ–ã€ç§»åŠ¨ç«¯ |
| **æµ‹è¯•å·¥ç¨‹å¸ˆ** | 0.5äºº | 1äºº | 1äºº | 1äºº | æµ‹è¯•ç”¨ä¾‹ã€è‡ªåŠ¨åŒ–æµ‹è¯• |
| **DevOpså·¥ç¨‹å¸ˆ** | 0.5äºº | 1äºº | 1äºº | 1äºº | CI/CDã€ç›‘æ§ã€å®¹å™¨åŒ– |
| **AIå·¥ç¨‹å¸ˆ** | - | 0.5äºº | 0.5äºº | 1äºº | å¼‚å¸¸æ£€æµ‹ã€NL2SQLã€é—®ç­”ç³»ç»Ÿ |
| **äº§å“ç»ç†** | 0.5äºº | 0.5äºº | 1äºº | 1äºº | éœ€æ±‚ç®¡ç†ã€ç”¨æˆ·è°ƒç ” |
| **åˆè®¡** | **4.5äºº** | **6äºº** | **7.5äºº** | **9äºº** | - |

### äºŒã€æŠ€æœ¯æˆæœ¬ä¼°ç®— (å¹´)

| æˆæœ¬é¡¹ | Q1-Q2 | Q3-Q4 | å¹´åº¦æ€»è®¡ | å¤‡æ³¨ |
|--------|-------|-------|----------|------|
| **äº‘æœåŠ¡å™¨** | Â¥6,000 | Â¥12,000 | Â¥18,000 | æŒ‰éœ€æ‰©å®¹ |
| **æ•°æ®åº“** | Â¥3,000 | Â¥6,000 | Â¥9,000 | MySQL/Redis |
| **ç›‘æ§å‘Šè­¦** | Â¥2,000 | Â¥4,000 | Â¥6,000 | Prometheus/Grafana |
| **ç¬¬ä¸‰æ–¹æœåŠ¡** | Â¥3,000 | Â¥6,000 | Â¥9,000 | Sentry/OpenAI API |
| **CDN/å­˜å‚¨** | Â¥1,000 | Â¥2,000 | Â¥3,000 | OSS/CDN |
| **å¼€å‘å·¥å…·** | Â¥5,000 | Â¥5,000 | Â¥10,000 | IDE/CI/CD |
| **åˆè®¡** | **Â¥20,000** | **Â¥35,000** | **Â¥55,000** | - |

### ä¸‰ã€é£é™©è¯„ä¼°ä¸åº”å¯¹

| é£é™©ç±»å‹ | é£é™©æè¿° | å½±å“ | æ¦‚ç‡ | åº”å¯¹ç­–ç•¥ |
|----------|----------|------|------|----------|
| **æŠ€æœ¯é£é™©** | APIé‡æ„å¼•å…¥Bug | é«˜ | ä¸­ | ç°åº¦å‘å¸ƒã€A/Bæµ‹è¯•ã€å¿«é€Ÿå›æ»š |
| **æ€§èƒ½é£é™©** | å¤šçº§ç¼“å­˜å¤æ‚åº¦é«˜ | ä¸­ | ä¸­ | æ¸è¿›å¼å®æ–½ã€é™çº§æ–¹æ¡ˆ |
| **äººåŠ›é£é™©** | å…³é”®äººå‘˜ç¦»èŒ | é«˜ | ä½ | æ–‡æ¡£å®Œå–„ã€ä»£ç å®¡æŸ¥ã€çŸ¥è¯†åˆ†äº« |
| **å®‰å…¨é£é™©** | å¤šç”¨æˆ·æƒé™æ¼æ´ | é«˜ | ä½ | å®‰å…¨æµ‹è¯•ã€æ¸—é€æµ‹è¯•ã€å®¡è®¡æ—¥å¿— |
| **å…¼å®¹é£é™©** | æ–°åŠŸèƒ½å½±å“è€åŠŸèƒ½ | ä¸­ | ä¸­ | å›å½’æµ‹è¯•ã€ç‰ˆæœ¬æ§åˆ¶ã€å…¼å®¹å±‚ |
| **ä¾èµ–é£é™©** | ç¬¬ä¸‰æ–¹æœåŠ¡ä¸ç¨³å®š | ä¸­ | ä¸­ | é™çº§æ–¹æ¡ˆã€å¤šä¾›åº”å•†ã€è‡ªå»ºæœåŠ¡ |
| **æˆæœ¬é£é™©** | äº‘æœåŠ¡è¶…é¢„ç®— | ä½ | ä¸­ | æˆæœ¬ç›‘æ§ã€æŒ‰éœ€æ‰©å®¹ã€èµ„æºä¼˜åŒ– |

---

## ğŸ“ˆ æˆåŠŸåº¦é‡æŒ‡æ ‡

### ä¸€ã€æŠ€æœ¯æŒ‡æ ‡ (Tech Metrics)

| æŒ‡æ ‡ | å½“å‰ | Q2ç›®æ ‡ | Q4ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|--------|--------|----------|
| **APIå“åº”æ—¶é—´(P95)** | 500ms | <200ms | <150ms | Prometheus |
| **APIé”™è¯¯ç‡** | æœªçŸ¥ | <0.5% | <0.1% | Sentry |
| **ç¼“å­˜å‘½ä¸­ç‡** | æœªçŸ¥ | >80% | >85% | Prometheus |
| **æµ‹è¯•è¦†ç›–ç‡** | 55% | 75% | 85% | Coverage.py |
| **ä»£ç é‡å¤ç‡** | æœªçŸ¥ | <5% | <3% | SonarQube |
| **éƒ¨ç½²é¢‘ç‡** | æ‰‹åŠ¨ | æ¯å‘¨ | æ¯å¤© | CI/CD |
| **ç³»ç»Ÿå¯ç”¨æ€§** | æœªçŸ¥ | >99.5% | >99.9% | ç›‘æ§ç³»ç»Ÿ |
| **æ•°æ®åº“æ…¢æŸ¥è¯¢** | æœªçŸ¥ | <10ä¸ª/å¤© | <5ä¸ª/å¤© | MySQLæ…¢æ—¥å¿— |

### äºŒã€äº§å“æŒ‡æ ‡ (Product Metrics)

| æŒ‡æ ‡ | å½“å‰ | Q2ç›®æ ‡ | Q4ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|--------|--------|----------|
| **å‘¨æ´»è·ƒç”¨æˆ·(WAU)** | - | 100 | 500 | Google Analytics |
| **æœˆæ´»è·ƒç”¨æˆ·(MAU)** | - | 300 | 1500 | Google Analytics |
| **æ—¥å‡æŠ¥å‘Šç”Ÿæˆ** | - | 30 | 150 | åç«¯åŸ‹ç‚¹ |
| **ç”¨æˆ·ç•™å­˜ç‡(D7)** | - | >60% | >70% | Mixpanel |
| **åŠŸèƒ½ä½¿ç”¨ç‡** | - | >50% | >70% | åç«¯åŸ‹ç‚¹ |
| **å¹³å‡ä¼šè¯æ—¶é•¿** | - | >10åˆ†é’Ÿ | >15åˆ†é’Ÿ | Google Analytics |
| **ç”¨æˆ·æ»¡æ„åº¦(NPS)** | - | >40 | >60 | ç”¨æˆ·è°ƒç ” |

### ä¸‰ã€ä¸šåŠ¡æŒ‡æ ‡ (Business Metrics)

| æŒ‡æ ‡ | å½“å‰ | Q2ç›®æ ‡ | Q4ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|--------|--------|----------|
| **æœˆå‡æˆæœ¬èŠ‚çœ** | - | Â¥50,000 | Â¥200,000 | æˆæœ¬åˆ†æå¼•æ“ |
| **å®‰å…¨é£é™©å‘ç°** | - | 100ä¸ª/æœˆ | 500ä¸ª/æœˆ | å®‰å…¨æ‰«æç³»ç»Ÿ |
| **åˆè§„æ£€æŸ¥é€šè¿‡ç‡** | - | >80% | >90% | CIS Benchmark |
| **é—²ç½®èµ„æºè¯†åˆ«** | - | 50ä¸ª/æœˆ | 200ä¸ª/æœˆ | é—²ç½®æ£€æµ‹å¼•æ“ |
| **è‡ªåŠ¨åŒ–ä¿®å¤ç‡** | - | >30% | >50% | ä¿®å¤å¼•æ“ç»Ÿè®¡ |
| **å‘Šè­¦å‡†ç¡®ç‡** | - | >85% | >92% | ç”¨æˆ·åé¦ˆ |

### å››ã€å›¢é˜ŸæŒ‡æ ‡ (Team Metrics)

| æŒ‡æ ‡ | å½“å‰ | Q2ç›®æ ‡ | Q4ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|--------|--------|----------|
| **ä»£ç å®¡æŸ¥å“åº”æ—¶é—´** | - | <4h | <2h | GitHub |
| **PRåˆå¹¶æ—¶é—´** | - | <1å¤© | <0.5å¤© | GitHub |
| **Bugä¿®å¤æ—¶é—´** | - | <24h | <12h | Jira |
| **æ–‡æ¡£å®Œæ•´åº¦** | 60% | 80% | 95% | äººå·¥è¯„ä¼° |
| **æŠ€æœ¯å€ºåŠ¡** | é«˜ | ä¸­ | ä½ | SonarQube |

---

## ğŸ¯ å…³é”®æˆåŠŸå› ç´  (CSF)

### 1. æŠ€æœ¯æ‰§è¡ŒåŠ›
- **å…³é”®**: æŒ‰æ—¶å®ŒæˆQ1-Q2æ ¸å¿ƒä¼˜åŒ–
- **ä¾èµ–**: å›¢é˜ŸæŠ€æœ¯èƒ½åŠ›ã€ä»£ç è´¨é‡
- **é£é™©**: æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯ã€äººå‘˜æµå¤±

### 2. ç”¨æˆ·ä½“éªŒæ”¹å–„
- **å…³é”®**: å®æ—¶åˆ·æ–°ã€ç§»åŠ¨ç«¯ä½“éªŒæå‡
- **ä¾èµ–**: å‰ç«¯æ€§èƒ½ä¼˜åŒ–ã€UI/UXè®¾è®¡
- **é£é™©**: åŠŸèƒ½è¿‡äºå¤æ‚ã€æ€§èƒ½ä¸‹é™

### 3. æ•°æ®åˆ†ææ·±åº¦
- **å…³é”®**: å¤šç»´åº¦åˆ†æã€å¼‚å¸¸æ£€æµ‹å‡†ç¡®ç‡
- **ä¾èµ–**: æ•°æ®è´¨é‡ã€ç®—æ³•ä¼˜åŒ–
- **é£é™©**: æ•°æ®ä¸ä¸€è‡´ã€ç®—æ³•è¯¯æŠ¥

### 4. AIèƒ½åŠ›è½åœ°
- **å…³é”®**: NL2SQLã€æ™ºèƒ½é—®ç­”å®ç”¨æ€§
- **ä¾èµ–**: LLM APIæˆæœ¬ã€æ¨¡å‹å‡†ç¡®ç‡
- **é£é™©**: æˆæœ¬è¿‡é«˜ã€å‡†ç¡®ç‡ä¸è¶³

### 5. å›¢é˜Ÿåä½œæ•ˆç‡
- **å…³é”®**: CI/CDæµç¨‹ã€ä»£ç è´¨é‡
- **ä¾èµ–**: å·¥å…·é“¾å®Œå–„ã€æµç¨‹è§„èŒƒ
- **é£é™©**: æ²Ÿé€šæˆæœ¬é«˜ã€äº¤ä»˜å»¶æœŸ

---

## ğŸ“š é™„å½•

### A. æŠ€æœ¯é€‰å‹å¯¹æ¯”

#### A.1 ç¼“å­˜æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **MySQLç¼“å­˜è¡¨** | ç®€å•ã€æ— é¢å¤–ä¾èµ– | æ€§èƒ½ä¸€èˆ¬ã€ä¸æ”¯æŒè¿‡æœŸ | å°è§„æ¨¡ã€ä½é¢‘è®¿é—® |
| **Redis** | é«˜æ€§èƒ½ã€åŠŸèƒ½ä¸°å¯Œ | éœ€é¢å¤–éƒ¨ç½²ã€æˆæœ¬å¢åŠ  | é«˜å¹¶å‘ã€å®æ—¶æ€§è¦æ±‚é«˜ |
| **Memcached** | æ€§èƒ½å¥½ã€ç®€å• | åŠŸèƒ½å°‘ã€æ— æŒä¹…åŒ– | çº¯ç¼“å­˜åœºæ™¯ |
| **è¿›ç¨‹å†…ç¼“å­˜** | é›¶å»¶è¿Ÿã€æ— ç½‘ç»œå¼€é”€ | ä¸å…±äº«ã€å®¹é‡æœ‰é™ | çƒ­ç‚¹æ•°æ® |

**æ¨è**: **å¤šçº§ç¼“å­˜ (L1è¿›ç¨‹+L2Redis+L3MySQL)**

#### A.2 ç›‘æ§æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æˆæœ¬ |
|------|------|------|------|
| **Prometheus+Grafana** | å¼€æºã€åŠŸèƒ½å¼ºå¤§ | éœ€è‡ªå»ºã€è¿ç»´æˆæœ¬ | ä½ |
| **Datadog** | åŠŸèƒ½å…¨ã€æ‰˜ç®¡ | æˆæœ¬é«˜ | é«˜ |
| **New Relic** | APMå¼ºå¤§ | æˆæœ¬é«˜ | é«˜ |
| **é˜¿é‡Œäº‘ARMS** | é›†æˆç®€å• | åŠŸèƒ½æœ‰é™ | ä¸­ |

**æ¨è**: **Prometheus+Grafana (å¼€æºè‡ªå»º)**

#### A.3 æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”

| æ–¹æ¡ˆ | ååé‡ | å»¶è¿Ÿ | å¯é æ€§ | å¤æ‚åº¦ |
|------|--------|------|--------|--------|
| **RabbitMQ** | ä¸­ | ä½ | é«˜ | ä½ |
| **Kafka** | æé«˜ | ä¸­ | é«˜ | é«˜ |
| **Redis Pub/Sub** | é«˜ | æä½ | ä¸­ | æä½ |
| **NATS** | é«˜ | æä½ | ä¸­ | ä½ |

**æ¨è**: **RabbitMQ (å¾®æœåŠ¡åœºæ™¯)** æˆ– **Redis Pub/Sub (ç®€å•åœºæ™¯)**

---

### B. å‚è€ƒèµ„æ–™

#### B.1 å®˜æ–¹æ–‡æ¡£
- FastAPI: https://fastapi.tiangolo.com/
- Next.js: https://nextjs.org/docs
- React Query: https://tanstack.com/query/latest
- Prometheus: https://prometheus.io/docs/
- OpenTelemetry: https://opentelemetry.io/docs/

#### B.2 æœ€ä½³å®è·µ
- [Google SRE Book](https://sre.google/books/)
- [12 Factor App](https://12factor.net/)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Martin Fowler - Microservices](https://martinfowler.com/articles/microservices.html)

#### B.3 å†…éƒ¨æ–‡æ¡£
- [ä¼˜åŒ–è·¯çº¿å›¾ v2.0](OPTIMIZATION_ROADMAP_V2.md)
- [é¡¹ç›®æ·±åº¦åˆ†æ](PROJECT_COMPREHENSIVE_ANALYSIS.md)
- [äº§å“èƒ½åŠ›æ€»è§ˆ](PRODUCT_CAPABILITIES.md)
- [æŠ€æœ¯æ¶æ„æ–‡æ¡£](TECHNICAL_ARCHITECTURE.md)

---

## ğŸ”„ è¿­ä»£ä¸åé¦ˆ

### ç‰ˆæœ¬å†å²
- **v3.0.0** (2026-01-08): ç»¼åˆè§„åˆ’ï¼Œæ•´åˆäº§å“+æŠ€æœ¯åŒè§†è§’
- **v2.1.0** (2026-01-07): ç³»ç»Ÿæ¢³ç†ä¸æœªæ¥è§„åˆ’
- **v2.0.0** (2025-12): ä¼˜åŒ–è·¯çº¿å›¾v2.0

### æ›´æ–°å‘¨æœŸ
- **å­£åº¦å›é¡¾**: æ¯å­£åº¦æœ«è¯„ä¼°è¿›å±•ï¼Œè°ƒæ•´è§„åˆ’
- **æœˆåº¦æ›´æ–°**: æ¯æœˆæ›´æ–°é‡Œç¨‹ç¢‘å®Œæˆåº¦
- **å‘¨åº¦åŒæ­¥**: æ¯å‘¨å›¢é˜ŸåŒæ­¥ï¼Œè°ƒæ•´ä¼˜å…ˆçº§

### åé¦ˆæ¸ é“
- **å›¢é˜Ÿä¼šè®®**: å‘¨ä¼šè®¨è®ºè¿›å±•å’Œé—®é¢˜
- **ç”¨æˆ·è°ƒç ”**: å­£åº¦ç”¨æˆ·è®¿è°ˆ
- **æ•°æ®é©±åŠ¨**: ç›‘æ§æŒ‡æ ‡æŒç»­ä¼˜åŒ–

---

**æ–‡æ¡£ç»´æŠ¤è€…**: CloudLens Team
**æœ€åæ›´æ–°**: 2026-01-08
**ä¸‹æ¬¡è¯„å®¡**: 2026-04-01 (Q1ç»“æŸ)

---

**æ„¿æ™¯**: æ‰“é€ ä¸–ç•Œä¸€æµçš„å¤šäº‘èµ„æºæ²»ç†ä¸æˆæœ¬ä¼˜åŒ–å¹³å° ğŸš€
