# APIæ¨¡å—åŒ–é‡æ„è¯„ä¼°æŠ¥å‘Š

**è¯„ä¼°æ—¥æœŸ**: 2026-01-08  
**è¯„ä¼°äºº**: AI Assistant

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### 1. APIç«¯ç‚¹ç»Ÿè®¡

#### api.py (Legacyæ–‡ä»¶)
- **æ€»è¡Œæ•°**: 3922è¡Œ
- **è·¯ç”±ç«¯ç‚¹æ•°é‡**: 34ä¸ª
- **çŠ¶æ€**: ä½œä¸ºåå¤‡ä¿ç•™ï¼Œä¼˜å…ˆçº§æœ€ä½

#### å·²æ¨¡å—åŒ–æ–‡ä»¶ç»Ÿè®¡

| æ¨¡å—æ–‡ä»¶ | ç«¯ç‚¹æ•°é‡ | åŠŸèƒ½åŸŸ |
|---------|---------|--------|
| api_config.py | 11 | é…ç½®å’Œè´¦å·ç®¡ç† |
| api_cost.py | 4 | æˆæœ¬åˆ†æ |
| api_billing.py | 3 | è´¦å•æŸ¥è¯¢ |
| api_discounts.py | 15 | æŠ˜æ‰£åˆ†æ |
| api_resources.py | 4 | èµ„æºç®¡ç† |
| api_budgets.py | 7 | é¢„ç®—ç®¡ç† |
| api_tags.py | 8 | è™šæ‹Ÿæ ‡ç­¾ |
| api_dashboards.py | 8 | ä»ªè¡¨ç›˜ |
| api_security.py | 4 | å®‰å…¨æ£€æŸ¥ |
| api_optimization.py | 1 | ä¼˜åŒ–å»ºè®® |
| api_reports.py | 2 | æŠ¥å‘Šç”Ÿæˆ |
| api_alerts.py | 9 | å‘Šè­¦ç®¡ç† |
| api_cost_allocation.py | 8 | æˆæœ¬åˆ†é… |
| api_ai_optimizer.py | 3 | AIä¼˜åŒ– |
| api_auth.py | 7 | è®¤è¯æˆæƒ |
| api_backup.py | 4 | å¤‡ä»½æ¢å¤ |
| **æ€»è®¡** | **98** | - |

### 2. api.pyä¸­çš„ç«¯ç‚¹åˆ†æ

api.pyä¸­å‰©ä½™çš„34ä¸ªç«¯ç‚¹ï¼š

1. `/api/accounts` - è´¦å·åˆ—è¡¨
2. `/api/config/rules` - è§„åˆ™é…ç½®ï¼ˆGET/POSTï¼‰
3. `/api/config/notifications` - é€šçŸ¥é…ç½®ï¼ˆGET/POSTï¼‰
4. `/api/analyze/trigger` - è§¦å‘åˆ†æ
5. `/api/dashboard/summary` - ä»ªè¡¨ç›˜æ‘˜è¦
6. `/api/dashboard/trend` - ä»ªè¡¨ç›˜è¶‹åŠ¿
7. `/api/dashboard/idle` - é—²ç½®èµ„æº
8. `/api/resources` - èµ„æºåˆ—è¡¨
9. `/api/resources/{resource_id}` - èµ„æºè¯¦æƒ…
10. `/api/resources/{resource_id}/metrics` - èµ„æºæŒ‡æ ‡
11. `/api/settings/accounts` - è´¦å·è®¾ç½®ï¼ˆGET/POST/PUT/DELETEï¼‰
12. `/api/cost/overview` - æˆæœ¬æ¦‚è§ˆ
13. `/api/cost/breakdown` - æˆæœ¬åˆ†è§£
14. `/api/security/overview` - å®‰å…¨æ¦‚è§ˆ
15. `/api/security/checks` - å®‰å…¨æ£€æŸ¥
16. `/api/optimization/suggestions` - ä¼˜åŒ–å»ºè®®
17. `/api/reports/generate` - æŠ¥å‘Šç”Ÿæˆ
18. `/api/cost/budget` - é¢„ç®—ï¼ˆGET/POSTï¼‰
19. `/api/billing/overview` - è´¦å•æ¦‚è§ˆ
20. `/api/billing/instance-bill` - å®ä¾‹è´¦å•
21. `/api/discounts/trend` - æŠ˜æ‰£è¶‹åŠ¿
22. `/api/discounts/products` - æŠ˜æ‰£äº§å“
23. `/api/billing/discounts` - è´¦å•æŠ˜æ‰£
24. `/api/security/cis` - CISæ£€æŸ¥
25. `/api/reports` - æŠ¥å‘Šåˆ—è¡¨
26. `/api/discounts/quarterly` - å­£åº¦æŠ˜æ‰£
27. `/api/discounts/yearly` - å¹´åº¦æŠ˜æ‰£
28. `/api/discounts/product-trends` - äº§å“æŠ˜æ‰£è¶‹åŠ¿

### 3. ç«¯ç‚¹æ˜ å°„åˆ†æ

#### å·²è¿ç§»çš„ç«¯ç‚¹ï¼ˆå¯èƒ½åœ¨æ¨¡å—åŒ–æ–‡ä»¶ä¸­ï¼‰

é€šè¿‡åˆ†æï¼Œä»¥ä¸‹ç«¯ç‚¹å¯èƒ½å·²ç»åœ¨æ¨¡å—åŒ–æ–‡ä»¶ä¸­ï¼š
- è´¦å·ç®¡ç†ç›¸å…³ â†’ `api_config.py`
- æˆæœ¬åˆ†æç›¸å…³ â†’ `api_cost.py`
- è´¦å•ç›¸å…³ â†’ `api_billing.py`
- æŠ˜æ‰£ç›¸å…³ â†’ `api_discounts.py`
- èµ„æºç›¸å…³ â†’ `api_resources.py`
- é¢„ç®—ç›¸å…³ â†’ `api_budgets.py`
- å®‰å…¨ç›¸å…³ â†’ `api_security.py`
- æŠ¥å‘Šç›¸å…³ â†’ `api_reports.py`
- ä¼˜åŒ–ç›¸å…³ â†’ `api_optimization.py`
- ä»ªè¡¨ç›˜ç›¸å…³ â†’ `api_dashboards.py`

#### éœ€è¦è¿ç§»çš„ç«¯ç‚¹

api.pyä¸­çš„ç«¯ç‚¹å¯èƒ½ï¼š
1. **é‡å¤å®šä¹‰** - å·²åœ¨æ¨¡å—åŒ–æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œä½†api.pyä¸­ä»æœ‰å®šä¹‰
2. **æœªè¿ç§»** - ç¡®å®è¿˜æœªè¿ç§»åˆ°æ¨¡å—åŒ–æ–‡ä»¶
3. **éœ€è¦åˆå¹¶** - åŠŸèƒ½ç›¸ä¼¼ä½†å®ç°ä¸åŒ

---

## ğŸ¯ é‡æ„ç­–ç•¥

### ç­–ç•¥1: ç«¯ç‚¹å»é‡å’Œè¿ç§»

1. **æ£€æŸ¥é‡å¤**: å¯¹æ¯”api.pyå’Œæ¨¡å—åŒ–æ–‡ä»¶ï¼Œæ‰¾å‡ºé‡å¤ç«¯ç‚¹
2. **è¿ç§»æœªè¿ç§»ç«¯ç‚¹**: å°†api.pyä¸­ç‹¬æœ‰çš„ç«¯ç‚¹è¿ç§»åˆ°å¯¹åº”æ¨¡å—
3. **ç§»é™¤api.py**: æ‰€æœ‰ç«¯ç‚¹è¿ç§»å®Œæˆåï¼Œç§»é™¤api.py

### ç­–ç•¥2: åˆ›å»ºæ–°ç›®å½•ç»“æ„

æŒ‰ç…§è§„åˆ’æ–‡æ¡£ï¼Œåˆ›å»ºæ–°çš„ç›®å½•ç»“æ„ï¼š
```
web/backend/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”œâ”€â”€ middleware.py
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ accounts.py
â”‚       â”œâ”€â”€ resources.py
â”‚       â”œâ”€â”€ costs.py
â”‚       â”œâ”€â”€ discounts.py
â”‚       â”œâ”€â”€ security.py
â”‚       â”œâ”€â”€ budgets.py
â”‚       â”œâ”€â”€ alerts.py
â”‚       â”œâ”€â”€ reports.py
â”‚       â”œâ”€â”€ tags.py
â”‚       â”œâ”€â”€ dashboards.py
â”‚       â”œâ”€â”€ optimization.py
â”‚       â”œâ”€â”€ cost_allocation.py
â”‚       â””â”€â”€ ai.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ requests.py
â”‚   â”œâ”€â”€ responses.py
â”‚   â””â”€â”€ schemas.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ account_service.py
â”‚   â”œâ”€â”€ cost_service.py
â”‚   â”œâ”€â”€ security_service.py
â”‚   â””â”€â”€ ...
â””â”€â”€ repositories/
    â”œâ”€â”€ account_repository.py
    â”œâ”€â”€ bill_repository.py
    â””â”€â”€ ...
```

### ç­–ç•¥3: æ¸è¿›å¼è¿ç§»

1. **Phase 1**: åˆ›å»ºæ–°ç›®å½•ç»“æ„ï¼Œä¿æŒç°æœ‰api_*.pyæ–‡ä»¶
2. **Phase 2**: å°†api_*.pyè¿ç§»åˆ°api/v1/ç›®å½•
3. **Phase 3**: æå–Serviceå±‚
4. **Phase 4**: æå–Repositoryå±‚
5. **Phase 5**: ç§»é™¤api.pyå’Œæ—§api_*.pyæ–‡ä»¶

---

## ğŸ“‹ è¡ŒåŠ¨è®¡åˆ’

### Step 1: è¯¦ç»†ç«¯ç‚¹å¯¹æ¯”ï¼ˆå½“å‰ä»»åŠ¡ï¼‰

éœ€è¦è¯¦ç»†å¯¹æ¯”api.pyå’Œå„ä¸ªæ¨¡å—åŒ–æ–‡ä»¶ï¼Œç¡®å®šï¼š
- å“ªäº›ç«¯ç‚¹å·²è¿ç§»
- å“ªäº›ç«¯ç‚¹é‡å¤
- å“ªäº›ç«¯ç‚¹éœ€è¦è¿ç§»

### Step 2: åˆ›å»ºæ–°ç›®å½•ç»“æ„

æŒ‰ç…§è§„åˆ’åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„

### Step 3: è¿ç§»ç°æœ‰æ¨¡å—åŒ–æ–‡ä»¶

å°†ç°æœ‰çš„api_*.pyæ–‡ä»¶è¿ç§»åˆ°api/v1/ç›®å½•

### Step 4: è¿ç§»api.pyä¸­çš„å‰©ä½™ç«¯ç‚¹

å°†api.pyä¸­æœªè¿ç§»çš„ç«¯ç‚¹è¿ç§»åˆ°å¯¹åº”æ¨¡å—

### Step 5: Serviceå±‚é‡æ„

æå–ä¸šåŠ¡é€»è¾‘åˆ°Serviceå±‚

### Step 6: Repositoryå±‚æå–

æå–æ•°æ®è®¿é—®é€»è¾‘åˆ°Repositoryå±‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: è¿ç§»è¿‡ç¨‹ä¸­ä¿æŒAPIè·¯å¾„ä¸å˜
2. **æµ‹è¯•è¦†ç›–**: æ¯ä¸ªè¿ç§»æ­¥éª¤éƒ½è¦è¿è¡Œå®Œæ•´æµ‹è¯•
3. **æ¸è¿›å¼**: ä¸è¦ä¸€æ¬¡æ€§å¤§æ”¹ï¼Œåˆ†é˜¶æ®µè¿›è¡Œ
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°APIæ–‡æ¡£

---

**ä¸‹ä¸€æ­¥**: å¼€å§‹è¯¦ç»†ç«¯ç‚¹å¯¹æ¯”ï¼Œç¡®å®šå…·ä½“è¿ç§»æ¸…å•
