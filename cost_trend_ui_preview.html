<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆæœ¬è¶‹åŠ¿ UI è®¾è®¡é¢„è§ˆ - CloudLens</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #f1f5f9;
        }

        .header p {
            color: #94a3b8;
            font-size: 14px;
        }

        .controls {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .control-group {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 500;
            min-width: 80px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #334155;
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #334155;
            border-color: #475569;
        }

        .btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: #fff;
        }

        .chart-container {
            background: #1e293b;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            position: relative;
            min-height: 400px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #f1f5f9;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .summary-card-label {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .summary-card-value {
            font-size: 24px;
            font-weight: 600;
            color: #f1f5f9;
        }

        .summary-card-trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .summary-card-trend.up {
            color: #ef4444;
        }

        .summary-card-trend.down {
            color: #10b981;
        }

        .legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #94a3b8;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .actions .btn {
            background: #334155;
        }

        .actions .btn:hover {
            background: #475569;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .control-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .btn-group {
                width: 100%;
            }

            .btn {
                flex: 1;
            }

            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* éšè—/æ˜¾ç¤ºåˆ‡æ¢ */
        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“Š æˆæœ¬è¶‹åŠ¿åˆ†æ</h1>
            <p>æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰äº‘èµ„æºçš„æˆæœ¬è¶‹åŠ¿</p>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls">
            <div class="control-group">
                <label>æ—¶é—´èŒƒå›´:</label>
                <div class="btn-group">
                    <button class="btn" data-range="7">7å¤©</button>
                    <button class="btn active" data-range="30">30å¤©</button>
                    <button class="btn" data-range="90">90å¤©</button>
                    <button class="btn" data-range="all">å…¨éƒ¨</button>
                    <button class="btn" data-range="monthly">æŒ‰æœˆ</button>
                </div>
            </div>
            <div class="control-group">
                <label>è§†å›¾åˆ‡æ¢:</label>
                <div class="btn-group">
                    <button class="btn active" data-view="daily">ğŸ“ˆ æŒ‰å¤©</button>
                    <button class="btn" data-view="monthly">ğŸ“Š æŒ‰æœˆ</button>
                </div>
            </div>
            <div class="control-group">
                <label>å›¾è¡¨ç±»å‹:</label>
                <div class="btn-group" id="chartTypeGroup">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- æŒ‰å¤©è§†å›¾ -->
        <div class="view-section active" id="dailyView">
            <div class="chart-container">
                <div class="chart-title">æˆæœ¬è¶‹åŠ¿ - æŒ‰å¤©è§†å›¾ (æœ€è¿‘30å¤©)</div>
                <canvas id="dailyChart"></canvas>
                <div class="legend" id="dailyLegend"></div>
            </div>
        </div>

        <!-- æŒ‰æœˆè§†å›¾ -->
        <div class="view-section" id="monthlyView">
            <div class="chart-container">
                <div class="chart-title">æˆæœ¬è¶‹åŠ¿ - æŒ‰æœˆè§†å›¾ (ä»æœ‰æ•°æ®ä»¥æ¥)</div>
                <canvas id="monthlyChart"></canvas>
                <div class="legend" id="monthlyLegend"></div>
            </div>
        </div>

        <!-- ç»Ÿè®¡æ‘˜è¦ -->
        <div class="summary-cards" id="summaryCards">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="controls">
            <div class="actions">
                <button class="btn">å¯¼å‡ºCSV</button>
                <button class="btn">å¯¼å‡ºExcel</button>
                <button class="btn">å¯¼å‡ºå›¾ç‰‡</button>
                <button class="btn">åˆ·æ–°æ•°æ®</button>
            </div>
        </div>
    </div>

    <script>
        // èµ„æºç±»å‹é¢œè‰²é…ç½®
        const resourceColors = {
            'ECS': '#3b82f6',
            'RDS': '#10b981',
            'Redis': '#f59e0b',
            'OSS': '#ef4444',
            'SLB': '#8b5cf6',
            'EIP': '#06b6d4',
            'NAT': '#f97316',
            'Disk': '#84cc16',
            'MongoDB': '#ec4899',
            'ACK': '#6366f1',
            'å…¶ä»–': '#6b7280'
        };

        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        function generateDailyData(days = 30) {
            const data = [];
            const today = new Date();
            const labels = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                
                // æ¨¡æ‹Ÿæˆæœ¬æ•°æ®ï¼ˆå¸¦ä¸€äº›éšæœºæ³¢åŠ¨ï¼‰
                const baseCost = 1200;
                const variation = (Math.random() - 0.5) * 200;
                const totalCost = baseCost + variation;
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    total: Math.max(800, totalCost),
                    ecs: Math.max(500, totalCost * 0.65 + (Math.random() - 0.5) * 50),
                    rds: Math.max(200, totalCost * 0.24 + (Math.random() - 0.5) * 30),
                    redis: Math.max(80, totalCost * 0.08 + (Math.random() - 0.5) * 20),
                    oss: Math.max(20, totalCost * 0.03 + (Math.random() - 0.5) * 10)
                });
            }
            
            return { labels, data };
        }

        function generateMonthlyData(months = 12) {
            const data = [];
            const labels = [];
            const today = new Date();
            
            for (let i = months - 1; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                labels.push(date.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit' }));
                
                const baseCost = 35000;
                const variation = (Math.random() - 0.5) * 5000;
                const totalCost = baseCost + variation;
                
                data.push({
                    month: date.toISOString().slice(0, 7),
                    total: Math.max(30000, totalCost),
                    avgDaily: Math.max(1000, totalCost / 30),
                    ecs: Math.max(20000, totalCost * 0.65),
                    rds: Math.max(8000, totalCost * 0.24),
                    redis: Math.max(3000, totalCost * 0.08),
                    oss: Math.max(1000, totalCost * 0.03)
                });
            }
            
            return { labels, data };
        }

        // åˆå§‹åŒ–å›¾è¡¨
        let dailyChart = null;
        let monthlyChart = null;
        let currentView = 'daily';
        let currentChartType = 'area';

        function initDailyChart() {
            const ctx = document.getElementById('dailyChart');
            if (dailyChart) {
                dailyChart.destroy();
            }

            const { labels, data } = generateDailyData(30);
            const datasets = [];

            if (currentChartType === 'area' || currentChartType === 'stacked') {
                // å †å é¢ç§¯å›¾
                datasets.push(
                    {
                        label: 'ECS',
                        data: data.map(d => d.ecs),
                        backgroundColor: resourceColors.ECS + '80',
                        borderColor: resourceColors.ECS,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'RDS',
                        data: data.map(d => d.rds),
                        backgroundColor: resourceColors.RDS + '80',
                        borderColor: resourceColors.RDS,
                        borderWidth: 2,
                        fill: currentChartType === 'stacked' ? '+1' : true,
                        tension: 0.4
                    },
                    {
                        label: 'Redis',
                        data: data.map(d => d.redis),
                        backgroundColor: resourceColors.Redis + '80',
                        borderColor: resourceColors.Redis,
                        borderWidth: 2,
                        fill: currentChartType === 'stacked' ? '+1' : true,
                        tension: 0.4
                    },
                    {
                        label: 'OSS',
                        data: data.map(d => d.oss),
                        backgroundColor: resourceColors.OSS + '80',
                        borderColor: resourceColors.OSS,
                        borderWidth: 2,
                        fill: currentChartType === 'stacked' ? '+1' : true,
                        tension: 0.4
                    }
                );
            } else {
                // æŠ˜çº¿å›¾
                datasets.push({
                    label: 'æ€»æˆæœ¬',
                    data: data.map(d => d.total),
                    backgroundColor: resourceColors.ECS + '20',
                    borderColor: resourceColors.ECS,
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                });
            }

            dailyChart = new Chart(ctx, {
                type: currentChartType === 'line' ? 'line' : 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: currentChartType === 'stacked' ? 'index' : 'nearest',
                            intersect: false,
                            backgroundColor: 'rgba(30, 41, 59, 0.95)',
                            titleColor: '#f1f5f9',
                            bodyColor: '#e2e8f0',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Â¥' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#334155',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 0
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#334155',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return 'Â¥' + value.toFixed(0);
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });

            // æ›´æ–°å›¾ä¾‹
            updateLegend('dailyLegend', datasets);
        }

        function initMonthlyChart() {
            const ctx = document.getElementById('monthlyChart');
            if (monthlyChart) {
                monthlyChart.destroy();
            }

            const { labels, data } = generateMonthlyData(12);
            const datasets = [];

            if (currentChartType === 'bar' || currentChartType === 'stacked') {
                // æŸ±çŠ¶å›¾
                datasets.push(
                    {
                        label: 'ECS',
                        data: data.map(d => d.ecs),
                        backgroundColor: resourceColors.ECS,
                        borderColor: resourceColors.ECS,
                        borderWidth: 1
                    },
                    {
                        label: 'RDS',
                        data: data.map(d => d.rds),
                        backgroundColor: resourceColors.RDS,
                        borderColor: resourceColors.RDS,
                        borderWidth: 1
                    },
                    {
                        label: 'Redis',
                        data: data.map(d => d.redis),
                        backgroundColor: resourceColors.Redis,
                        borderColor: resourceColors.Redis,
                        borderWidth: 1
                    },
                    {
                        label: 'OSS',
                        data: data.map(d => d.oss),
                        backgroundColor: resourceColors.OSS,
                        borderColor: resourceColors.OSS,
                        borderWidth: 1
                    }
                );
            } else {
                // æŠ˜çº¿å›¾
                datasets.push({
                    label: 'æœˆåº¦æ€»æˆæœ¬',
                    data: data.map(d => d.total),
                    backgroundColor: resourceColors.ECS + '20',
                    borderColor: resourceColors.ECS,
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
            }

            monthlyChart = new Chart(ctx, {
                type: currentChartType === 'line' ? 'line' : 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: currentChartType === 'stacked' ? 'index' : 'nearest',
                            intersect: false,
                            backgroundColor: 'rgba(30, 41, 59, 0.95)',
                            titleColor: '#f1f5f9',
                            bodyColor: '#e2e8f0',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Â¥' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#334155',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            stacked: currentChartType === 'stacked'
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#334155',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return 'Â¥' + value.toFixed(0);
                                }
                            },
                            stacked: currentChartType === 'stacked'
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });

            // æ›´æ–°å›¾ä¾‹
            updateLegend('monthlyLegend', datasets);
        }

        function updateLegend(legendId, datasets) {
            const legendEl = document.getElementById(legendId);
            legendEl.innerHTML = datasets.map(dataset => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${dataset.borderColor || dataset.backgroundColor}"></div>
                    <span>${dataset.label}</span>
                </div>
            `).join('');
        }

        function updateSummaryCards() {
            const { data } = currentView === 'daily' ? generateDailyData(30) : generateMonthlyData(12);
            const costs = data.map(d => d.total);
            const total = costs.reduce((a, b) => a + b, 0);
            const avg = total / costs.length;
            const max = Math.max(...costs);
            const min = Math.min(...costs);
            const trend = costs.length > 1 ? ((costs[costs.length - 1] - costs[costs.length - 2]) / costs[costs.length - 2] * 100).toFixed(1) : 0;
            const trendClass = trend > 0 ? 'up' : trend < 0 ? 'down' : '';

            document.getElementById('summaryCards').innerHTML = `
                <div class="summary-card">
                    <div class="summary-card-label">${currentView === 'daily' ? 'æ€»æˆæœ¬' : 'æ€»æˆæœ¬'}</div>
                    <div class="summary-card-value">Â¥${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-label">${currentView === 'daily' ? 'æ—¥å‡æˆæœ¬' : 'æœˆå‡æˆæœ¬'}</div>
                    <div class="summary-card-value">Â¥${avg.toFixed(2)}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-label">${currentView === 'daily' ? 'æœ€é«˜æ—¥æˆæœ¬' : 'æœ€é«˜æœˆæˆæœ¬'}</div>
                    <div class="summary-card-value">Â¥${max.toFixed(2)}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-label">${currentView === 'daily' ? 'æœ€ä½æ—¥æˆæœ¬' : 'æœ€ä½æœˆæˆæœ¬'}</div>
                    <div class="summary-card-value">Â¥${min.toFixed(2)}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-label">è¶‹åŠ¿</div>
                    <div class="summary-card-value">${trend > 0 ? 'â†‘' : trend < 0 ? 'â†“' : 'â†’'} ${Math.abs(trend)}%</div>
                    <div class="summary-card-trend ${trendClass}">${trend > 0 ? 'ä¸Šå‡' : trend < 0 ? 'ä¸‹é™' : 'å¹³ç¨³'}</div>
                </div>
            `;
        }

        function updateChartTypeButtons() {
            const group = document.getElementById('chartTypeGroup');
            const types = currentView === 'daily' 
                ? [
                    { key: 'area', label: 'é¢ç§¯å›¾' },
                    { key: 'line', label: 'æŠ˜çº¿å›¾' },
                    { key: 'stacked', label: 'å †å ' }
                ]
                : [
                    { key: 'bar', label: 'æŸ±çŠ¶å›¾' },
                    { key: 'line', label: 'æŠ˜çº¿å›¾' },
                    { key: 'stacked', label: 'å †å ' },
                    { key: 'combo', label: 'ç»„åˆå›¾' }
                ];
            
            group.innerHTML = types.map(type => `
                <button class="btn ${currentChartType === type.key ? 'active' : ''}" 
                        data-chart-type="${type.key}">${type.label}</button>
            `).join('');
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('click', function(e) {
            // æ—¶é—´èŒƒå›´åˆ‡æ¢
            if (e.target.dataset.range) {
                document.querySelectorAll('[data-range]').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                // é‡æ–°ç”Ÿæˆæ•°æ®
                if (currentView === 'daily') {
                    initDailyChart();
                } else {
                    initMonthlyChart();
                }
                updateSummaryCards();
            }

            // è§†å›¾åˆ‡æ¢
            if (e.target.dataset.view) {
                currentView = e.target.dataset.view;
                document.querySelectorAll('[data-view]').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                document.getElementById('dailyView').classList.toggle('active', currentView === 'daily');
                document.getElementById('monthlyView').classList.toggle('active', currentView === 'monthly');
                
                currentChartType = currentView === 'daily' ? 'area' : 'bar';
                updateChartTypeButtons();
                
                if (currentView === 'daily') {
                    initDailyChart();
                } else {
                    initMonthlyChart();
                }
                updateSummaryCards();
            }

            // å›¾è¡¨ç±»å‹åˆ‡æ¢
            if (e.target.dataset.chartType) {
                currentChartType = e.target.dataset.chartType;
                document.querySelectorAll('[data-chart-type]').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                if (currentView === 'daily') {
                    initDailyChart();
                } else {
                    initMonthlyChart();
                }
            }
        });

        // åˆå§‹åŒ–
        updateChartTypeButtons();
        initDailyChart();
        updateSummaryCards();
    </script>
</body>
</html>

