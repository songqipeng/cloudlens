# CloudLens 产品能力总览

## 产品定位

**CloudLens** 是一款企业级多云资源治理与分析平台，提供 **CLI 命令行工具** 和 **Web 可视化界面** 两种使用方式，帮助企业在多云环境下实现统一管理、成本优化、安全合规和运营效率提升。

### 核心价值主张

> **统一视图 · 智能分析 · 安全合规 · 降本增效**

---

## 功能模块总览

### 一、CLI 命令行工具

#### 1. 配置管理 (`config`)
- 账号管理：添加、删除、列出云账号
- 凭证管理：Keyring 安全存储
- 规则配置：闲置检测规则、阈值配置
- 通知配置：邮件、Webhook、短信通知

#### 2. 资源查询 (`query`)
- 多资源类型：ECS、RDS、Redis、VPC、EIP、SLB 等
- 多格式输出：Table、JSON、CSV
- 智能缓存：自动缓存查询结果，提升速度
- 并发查询：多账号并发，速度提升 3-5 倍
- 高级筛选：支持 SQL-like 语法和 JMESPath

#### 3. 分析功能 (`analyze`)
- **闲置资源分析** (`idle`)：基于监控数据识别低使用率资源
- **成本分析** (`cost`)：成本快照、趋势分析、环比/同比
- **成本预测** (`forecast`)：基于 Prophet ML 模型预测未来成本
- **折扣分析** (`discount`)：分析账单折扣趋势，支持产品/合同/实例维度
- **安全合规** (`security`)：公网暴露检测、CIS Benchmark 检查
- **标签治理** (`tags`)：检测无标签资源、标签覆盖率统计
- **续费提醒** (`renewal`)：提前预警即将到期的包年包月资源

#### 4. 账单管理 (`bill`)
- **自动获取** (`fetch`)：通过 BSS OpenAPI 自动获取账单数据
- **测试连接** (`test`)：测试账单 API 连接
- **定时任务**：支持 cron 定时自动获取账单

#### 5. 自动修复 (`remediate`)
- **标签修复** (`tags`)：批量打标签，支持干运行模式
- **修复历史** (`history`)：查看修复操作历史
- **安全组修复** (`security`)：修复安全组规则（开发中）

#### 6. 缓存管理 (`cache`)
- 缓存状态查看
- 条件清理（按资源类型、账号、区域）
- 自动过期清理

#### 7. 其他工具
- **Dashboard** (`dashboard`)：TUI 全屏监控界面
- **REPL** (`repl`)：交互式命令行界面
- **Scheduler** (`scheduler`)：任务调度器

---

### 二、Web 可视化界面

#### 1. Dashboard 仪表盘
- 成本概览：本月/上月成本、环比/同比增长
- 资源统计：总资源数、闲置资源数、标签覆盖率
- 成本趋势图：30 天成本趋势可视化
- 闲置资源表：实时展示闲置资源列表
- 一键扫描：触发资源分析任务

#### 2. 资源管理 (`/resources`)
- 多资源类型查询：ECS、RDS、Redis、VPC 等
- 高级筛选：按状态、区域、标签筛选
- 资源详情：查看单个资源的详细信息
- 导出功能：支持 JSON/CSV 导出

#### 3. 成本分析 (`/cost`)
- 成本概览卡片：本月/上月成本、环比/同比增长
- 成本趋势图：30 天成本趋势可视化
- 成本构成饼图：按服务类型展示成本分布
- 时间范围选择：支持自定义时间范围

#### 4. 折扣分析 (`/discounts`)
- 折扣趋势：最近 6 个月折扣变化趋势
- 产品分析：按产品维度分析折扣
- 合同分析：按合同维度分析折扣
- TOP 实例：折扣最高的实例列表
- 高级分析：季度/年度对比、异常检测、优化建议

#### 5. 预算管理 (`/budgets`)
- 预算创建：支持月度/季度/年度预算
- 预算类型：总预算、按标签预算、按服务预算
- 告警规则：支持多级告警阈值
- 预算状态：实时显示预算执行情况
- 支出趋势：预算支出趋势可视化

#### 6. 虚拟标签 (`/virtual-tags`)
- 标签创建：基于规则创建虚拟标签
- 规则引擎：支持多条件组合（AND/OR）
- 标签预览：预览标签匹配的资源
- 成本分析：按虚拟标签分析成本

#### 7. 告警管理 (`/alerts`)
- 告警规则：创建和管理告警规则
- 告警历史：查看告警触发历史
- 通知配置：邮件、Webhook、短信通知
- 告警状态：已触发、已确认、已解决

#### 8. 成本分配 (`/cost-allocation`)
- 分配规则：创建成本分配规则
- 分配方法：平均分配、按权重分配、按使用量分配
- 分配结果：查看成本分配结果
- 规则管理：启用/禁用、编辑、删除规则

#### 9. AI 优化 (`/ai-optimizer`)
- 优化建议：AI 生成的资源优化建议
- 成本预测：基于 ML 模型的成本预测
- 优先级排序：按潜在节省金额排序
- 执行建议：提供具体的优化操作建议

#### 10. 安全合规 (`/security`)
- 安全概览：安全评分、风险统计
- CIS 合规检查：10+ 安全基线检查
- 公网暴露检测：识别暴露在公网的资源
- 权限审计：检查账号权限风险

#### 11. 优化建议 (`/optimization`)
- 闲置资源：识别可优化的资源
- 配置优化：推荐更合适的资源配置
- 成本优化：识别成本优化机会
- 优化报告：生成优化建议报告

#### 12. 报告生成 (`/reports`)
- 报告类型：综合报告、资源报告、成本报告、安全报告
- 报告格式：Excel、HTML、PDF
- 报告历史：查看历史生成的报告
- 一键下载：快速下载报告文件

#### 13. 设置 (`/settings`)
- 账号管理：添加、编辑、删除云账号
- 通知配置：SMTP、Webhook、短信配置
- 系统设置：语言切换、主题设置

---

### 三、核心能力模块

#### 1. 多云统一管理
- **支持的云平台**：阿里云、腾讯云（可扩展 AWS、火山引擎）
- **统一资源模型**：UnifiedResource 统一所有云资源
- **多账号管理**：支持多账号、多区域管理
- **Provider 抽象层**：BaseProvider 接口，易于扩展

#### 2. 智能成本分析
- **成本快照**：自动记录成本快照
- **趋势分析**：环比/同比增长分析
- **AI 预测**：基于 Prophet ML 模型预测未来成本
- **折扣分析**：分析账单折扣趋势
- **成本分配**：支持多维度成本分配

#### 3. 安全合规检查
- **CIS Benchmark**：10+ 安全基线检查
- **公网暴露检测**：识别暴露在公网的资源
- **权限审计**：检查账号权限风险
- **安全组审计**：分析安全组规则风险

#### 4. 自动化修复
- **标签修复**：批量打标签
- **安全组修复**：修复安全组规则（开发中）
- **干运行模式**：默认干运行，安全可靠
- **修复历史**：完整的修复操作审计日志

#### 5. 数据存储
- **MySQL 数据库**：主数据库，存储所有业务数据
- **智能缓存**：MySQL 缓存表，24 小时 TTL
- **账单存储**：存储账单明细数据
- **配置管理**：Keyring 安全存储凭证

#### 6. 报告生成
- **Excel 报告**：多 Sheet 格式，包含资源清单、闲置分析、成本分析
- **HTML 报告**：精美样式，适合在线分享
- **JSON/CSV 导出**：机器可读，集成到其他系统

---

## 技术架构

### 前端技术栈
- **框架**：Next.js 16.0.8 (React 19.2.1)
- **语言**：TypeScript
- **UI 组件**：自定义组件库（基于 Shadcn UI）
- **图表库**：Recharts
- **国际化**：自定义 i18n 系统（支持中英文）

### 后端技术栈
- **框架**：FastAPI (Python 3.8+)
- **数据库**：MySQL（主数据库）
- **ORM**：数据库抽象层（支持 MySQL/SQLite）
- **云 SDK**：阿里云 SDK、腾讯云 SDK
- **其他**：pandas, openpyxl, keyring, prophet

### 数据存储
- **MySQL**：所有业务数据存储在 MySQL
- **缓存**：MySQL 缓存表，24 小时 TTL
- **配置**：`~/.cloudlens/config.json` + Keyring

---

## 支持的资源类型

### 阿里云
- ECS（云服务器）
- RDS（云数据库）
- Redis（云数据库 Redis）
- OSS（对象存储）
- NAS（文件存储）
- VPC（专有网络）
- EIP（弹性公网 IP）
- SLB（负载均衡）
- MongoDB、ACK、ClickHouse、PolarDB、ECI、Disk 等

### 腾讯云
- CVM（云服务器）
- CDB（云数据库）
- Redis（云数据库 Redis）
- COS（对象存储）
- VPC（专有网络）

---

## 典型应用场景

### 场景 1：每周成本优化会议
- **需求**：CTO 要求每周汇报成本优化进展
- **使用 CloudLens**：
  ```bash
  # CLI 方式
  cl report generate --account prod --format excel --include-idle
  
  # Web 方式
  # 访问 /reports 页面，一键生成报告
  ```
- **效果**：节省 95% 时间，数据更准确

### 场景 2：安全合规审计
- **需求**：信息安全部门要求每月提交安全检查报告
- **使用 CloudLens**：
  ```bash
  # CLI 方式
  cl analyze security --account prod --cis
  
  # Web 方式
  # 访问 /security 页面，查看 CIS 合规检查结果
  ```
- **效果**：系统化、可追溯、自动化

### 场景 3：资源盘点
- **需求**：季度末需要盘点所有云资源
- **使用 CloudLens**：
  ```bash
  # CLI 方式
  cl query ecs --concurrent --format csv > all_ecs.csv
  
  # Web 方式
  # 访问 /resources 页面，筛选并导出
  ```
- **效果**：完整、快速、可视化

---

## 产品优势

1. **100% 只读，零风险**：代码层面无任何 Write/Delete API
2. **开箱即用**：CLI 工具轻量级，Web 界面现代化
3. **扩展性强**：插件化架构，易于添加新功能
4. **完全免费**：开源工具，无 License 费用
5. **双模式支持**：CLI + Web，满足不同使用场景
